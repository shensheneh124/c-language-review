<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C语言复习系统 - 大一上学期</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://cdn.jsdelivr.net/npm/remixicon@4.2.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;700&display=swap');
        
        * { scroll-behavior: smooth; }
        
        .code-font { font-family: 'JetBrains Mono', monospace; }
        
        .gradient-bg {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
        }
        
        .card-gradient {
            background: linear-gradient(145deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
            backdrop-filter: blur(10px);
        }
        
        .glow-effect {
            box-shadow: 0 0 30px rgba(99, 102, 241, 0.3);
        }
        
        .glow-green {
            box-shadow: 0 0 20px rgba(34, 197, 94, 0.4);
        }
        
        .glow-red {
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
        }
        
        .code-editor {
            background: #1e1e1e;
            border: 1px solid #3c3c3c;
        }
        
        .line-numbers {
            background: #252526;
            color: #858585;
            user-select: none;
            overflow: hidden;
            text-align: right;
            padding-right: 12px;
            border-right: 1px solid #3c3c3c;
        }
        
        .line-numbers div {
            height: 24px;
            line-height: 24px;
        }
        
        /* 代码编辑器容器 */
        .code-container {
            position: relative;
            flex: 1;
        }
        
        /* 语法高亮层 */
        .syntax-highlight {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 16px;
            pointer-events: none;
            white-space: pre-wrap;
            word-wrap: break-word;
            overflow: hidden;
            line-height: 24px;
            font-size: 14px;
            color: transparent;
        }
        
        textarea.code-input {
            background: transparent;
            resize: none;
            outline: none;
            caret-color: #fff;
            tab-size: 4;
            -moz-tab-size: 4;
            line-height: 24px;
            color: #d4d4d4;
            position: relative;
            z-index: 1;
        }
        
        /* VS Code 风格语法高亮颜色 */
        .hl-keyword { color: #ff3366; font-weight: bold; } /* 亮玫红：强调控制流 */
        .hl-type { color: #00ffff; }      /* 青色/蓝绿色：区分类型 */
        .hl-function { color: #ffff00; }  /* 纯亮黄：突出函数调用 */
        .hl-string { color: #ff9900; }    /* 亮橙色：使文本内容明显 */
        .hl-number { color: #cc66ff; }    /* 亮紫色：区分数字与文本 */
        .hl-comment { color: #76e081; font-style: italic; } /* 浅绿/薄荷绿：清晰可见的注释 */
        .hl-preprocessor { color: #ff00ff; } /* 亮洋红：突出预处理指令 */
        .hl-operator { color: #ffffff; }  /* 纯白：利用最高亮度分隔代码块 */
        .hl-bracket { color: #ffd700; }   /* 金色：括号匹配清晰 */
        .hl-variable { color: #33ccff; }  /* 天蓝色：区分变量名 */
        .hl-constant { color: #ff5555; }  /* 亮红/珊瑚色：突出常量 */
        
        .autocomplete-item {
            transition: all 0.1s ease;
            border-left: 3px solid transparent;
        }
        
        .autocomplete-item:hover {
            background: rgba(99, 102, 241, 0.25);
            border-left-color: #6366f1;
        }
        
        .autocomplete-item.selected {
            background: rgba(99, 102, 241, 0.35);
            border-left-color: #818cf8;
        }
        
        #autocompleteMenu {
            box-shadow: 0 10px 40px rgba(0,0,0,0.6);
            border: 1px solid rgba(99, 102, 241, 0.4);
            backdrop-filter: blur(10px);
        }
        
        #autocompleteMenu::-webkit-scrollbar {
            width: 6px;
        }
        
        #autocompleteMenu::-webkit-scrollbar-thumb {
            background: rgba(99, 102, 241, 0.5);
            border-radius: 3px;
        }
        
        kbd {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
        }
        
        /* 错误日志样式 */
        .error-log {
            background: #2d1b1b;
            border-left: 3px solid #ef4444;
        }
        
        .warning-log {
            background: #2d2a1b;
            border-left: 3px solid #eab308;
        }
        
        .success-log {
            background: #1b2d1b;
            border-left: 3px solid #22c55e;
        }
        
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .typing-indicator span {
            animation: typing 1.4s infinite;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }
            30% { opacity: 1; transform: translateY(-4px); }
        }
        
        .page { display: none; }
        .page.active { display: block; }
        
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a2e; }
        ::-webkit-scrollbar-thumb { background: #4f46e5; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #6366f1; }
        
        /* 编译状态动画 */
        .compiling {
            animation: pulse 1s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="gradient-bg min-h-screen text-white">
    <!-- 导航栏 -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-black/30 backdrop-blur-xl border-b border-white/10">
        <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                    <i class="ri-code-s-slash-line text-xl"></i>
                </div>
                <span class="text-xl font-bold bg-gradient-to-r from-indigo-400 to-purple-400 bg-clip-text text-transparent">C语言复习系统</span>
            </div>
            <div class="flex items-center gap-2">
                <button id="nav-home" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition bg-white/10">
                    <i class="ri-home-4-line mr-1"></i>首页
                </button>
                <button id="nav-choice" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-checkbox-circle-line mr-1"></i>选择题
                </button>
                <button id="nav-fill" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-edit-box-line mr-1"></i>程序填空题
                </button>
                <button id="nav-blank" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-edit-2-line mr-1"></i>填空题
                </button>
                <button id="nav-program" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-terminal-box-line mr-1"></i>编程题
                </button>
                <button id="nav-reading" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-file-code-line mr-1"></i>程序阅读
                </button>
                <button id="nav-simulator" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-computer-line mr-1"></i>模拟器
                </button>
                <button id="nav-favorites" class="nav-btn px-4 py-2 rounded-lg hover:bg-white/10 transition">
                    <i class="ri-star-line mr-1"></i>我的收藏
                </button>
            </div>
            <div class="flex items-center gap-3">
                <div class="text-sm text-gray-400">
                    <span>得分: </span><span id="totalScore" class="text-green-400 font-bold">0</span>
                </div>
                <button id="openQAModalBtn" class="p-2 rounded-lg bg-white/10 hover:bg-white/20 transition">
                    <i class="ri-robot-2-line"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 主页 -->
    <div id="page-home" class="page active pt-20 min-h-screen">
        <div class="max-w-7xl mx-auto px-4 py-12">
            <div class="text-center mb-16">
                <div class="inline-block animate-float mb-6">
                    <div class="w-24 h-24 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-3xl flex items-center justify-center glow-effect">
                        <i class="ri-code-s-slash-line text-5xl"></i>
                    </div>
                </div>
                <h1 class="text-5xl font-bold mb-4 bg-gradient-to-r from-white via-indigo-200 to-purple-200 bg-clip-text text-transparent">
                    C语言复习系统
                </h1>
                <p class="text-xl text-gray-400 mb-8">大一上学期 · 完整知识点覆盖 · AI智能辅导</p>
                <div class="flex justify-center gap-4 flex-wrap">
                <button id="startPracticeBtn" class="px-8 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl font-semibold hover:opacity-90 transition glow-effect">
                    <i class="ri-play-fill mr-2"></i>开始练习
                </button>
                <button id="openSimulatorBtn" class="px-8 py-3 bg-white/10 rounded-xl font-semibold hover:bg-white/20 transition border border-white/20">
                    <i class="ri-terminal-box-line mr-2"></i>代码模拟器
                </button>
                <button id="openQAModalBtnHome" class="px-8 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl font-semibold hover:opacity-90 transition glow-green">
                    <i class="ri-robot-2-line mr-2"></i>AI智能问答
                </button>
            </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-5 gap-6 mb-12">
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-blue-500/20 rounded-xl flex items-center justify-center">
                            <i class="ri-checkbox-circle-line text-2xl text-blue-400"></i>
                        </div>
                        <span class="text-3xl font-bold" id="choiceCount">30</span>
                    </div>
                    <p class="text-gray-400">选择题</p>
                </div>
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-green-500/20 rounded-xl flex items-center justify-center">
                            <i class="ri-edit-box-line text-2xl text-green-400"></i>
                        </div>
                        <span class="text-3xl font-bold" id="fillCount">20</span>
                    </div>
                    <p class="text-gray-400">程序填空题</p>
                </div>
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-cyan-500/20 rounded-xl flex items-center justify-center">
                            <i class="ri-edit-2-line text-2xl text-cyan-400"></i>
                        </div>
                        <span class="text-3xl font-bold" id="blankCount">0</span>
                    </div>
                    <p class="text-gray-400">填空题</p>
                </div>
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-purple-500/20 rounded-xl flex items-center justify-center">
                            <i class="ri-terminal-box-line text-2xl text-purple-400"></i>
                        </div>
                        <span class="text-3xl font-bold" id="programCount">15</span>
                    </div>
                    <p class="text-gray-400">编程题</p>
                </div>
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-pink-500/20 rounded-xl flex items-center justify-center">
                            <i class="ri-file-code-line text-2xl text-pink-400"></i>
                        </div>
                        <span class="text-3xl font-bold" id="readingCount">28</span>
                    </div>
                    <p class="text-gray-400">程序阅读</p>
                </div>
            </div>

            <h2 class="text-2xl font-bold mb-6"><i class="ri-book-2-line mr-2 text-indigo-400"></i>知识点覆盖</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-12">
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-database-2-line text-2xl text-indigo-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">数据类型</h3>
                    <p class="text-sm text-gray-400">int, float, char, double</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-calculator-line text-2xl text-green-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">运算符</h3>
                    <p class="text-sm text-gray-400">算术、关系、逻辑运算</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-git-branch-line text-2xl text-yellow-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">控制结构</h3>
                    <p class="text-sm text-gray-400">if, switch, for, while</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-function-line text-2xl text-purple-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">函数</h3>
                    <p class="text-sm text-gray-400">定义、调用、参数传递</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-grid-line text-2xl text-red-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">数组</h3>
                    <p class="text-sm text-gray-400">一维、二维数组操作</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-cursor-line text-2xl text-cyan-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">指针</h3>
                    <p class="text-sm text-gray-400">指针基础与应用</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-text text-2xl text-pink-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">字符串</h3>
                    <p class="text-sm text-gray-400">字符串处理函数</p>
                </div>
                <div class="card-gradient rounded-xl p-4 border border-white/10 hover:border-indigo-500/50 transition cursor-pointer">
                    <i class="ri-structure-line text-2xl text-orange-400 mb-2"></i>
                    <h3 class="font-semibold mb-1">结构体</h3>
                    <p class="text-sm text-gray-400">自定义数据类型</p>
                </div>
            </div>

            <div class="card-gradient rounded-2xl p-8 border border-white/10 mb-12">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <h2 class="text-2xl font-bold mb-2"><i class="ri-terminal-box-fill mr-2 text-green-400"></i>C语言在线编程模拟器</h2>
                        <p class="text-gray-400 mb-4">内置代码编辑器，VS Code风格语法高亮，AI模拟编译运行，快速验证代码逻辑</p>
                        <div class="flex gap-3 flex-wrap">
                            <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-full text-sm">语法高亮</span>
                            <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-full text-sm">AI编译运行</span>
                            <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-full text-sm">错误检测</span>
                            <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-full text-sm">智能补全</span>
                        </div>
                    </div>
                    <button id="openSimulatorBtn2" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl font-semibold hover:opacity-90 transition glow-green">
                        <i class="ri-play-circle-line mr-2"></i>打开模拟器
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- 选择题页面 -->
    <div id="page-choice" class="page pt-20 min-h-screen">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold"><i class="ri-checkbox-circle-line mr-2 text-blue-400"></i>选择题练习</h1>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">题目 <span id="choiceCurrentNum" class="text-white font-bold">1</span> / <span id="choiceTotalNum">30</span></span>
                    <button id="favoriteChoiceBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-star-line mr-1"></i>收藏
                    </button>
                    <button id="randomChoiceBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-shuffle-line mr-1"></i>随机
                    </button>
                </div>
            </div>

            <div class="w-full h-2 bg-white/10 rounded-full mb-8 overflow-hidden">
                <div id="choiceProgress" class="h-full bg-gradient-to-r from-blue-500 to-indigo-500 rounded-full transition-all duration-300" style="width: 3.33%"></div>
            </div>

            <div id="choiceQuestionCard" class="card-gradient rounded-2xl p-8 border border-white/10 mb-6">
                <div class="flex items-start gap-4 mb-6">
                    <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg text-sm font-medium" id="choiceCategory">基础知识</span>
                    <span class="px-3 py-1 bg-yellow-500/20 text-yellow-400 rounded-lg text-sm font-medium" id="choiceDifficulty">简单</span>
                </div>
                <h2 id="choiceQuestionText" class="text-xl mb-8 leading-relaxed"></h2>
                <div id="choiceOptions" class="space-y-4"></div>
            </div>

            <div id="choiceResult" class="card-gradient rounded-2xl p-6 border border-white/10 mb-6" style="display:none;">
                <div id="choiceResultHeader" class="flex items-center gap-3 mb-4"></div>
                <div id="choiceExplanation" class="text-gray-300"></div>
            </div>

            <div id="choiceAiSection" class="card-gradient rounded-2xl p-6 border border-indigo-500/30 mb-6" style="display:none;">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="ri-robot-line"></i>
                    </div>
                    <span class="font-semibold">AI 智能讲解</span>
                </div>
                <div id="choiceAiContent" class="text-gray-300 whitespace-pre-wrap"></div>
            </div>

            <div class="flex justify-between items-center">
                <button id="prevChoiceBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    <i class="ri-arrow-left-line mr-2"></i>上一题
                </button>
                <div class="flex gap-3">
                    <button id="aiExplainChoiceBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-robot-line mr-2"></i>AI讲解
                    </button>
                    <button id="submitChoiceBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-check-line mr-2"></i>提交答案
                    </button>
                </div>
                <button id="nextChoiceBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    下一题<i class="ri-arrow-right-line ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 填空题页面 -->
    <div id="page-fill" class="page pt-20 min-h-screen">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold"><i class="ri-edit-box-line mr-2 text-green-400"></i>程序填空题</h1>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">题目 <span id="fillCurrentNum" class="text-white font-bold">1</span> / <span id="fillTotalNum">20</span></span>
                    <button id="favoriteFillBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-star-line mr-1"></i>收藏
                    </button>
                    <button id="randomFillBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-shuffle-line mr-1"></i>随机
                    </button>
                </div>
            </div>

            <div class="w-full h-2 bg-white/10 rounded-full mb-8 overflow-hidden">
                <div id="fillProgress" class="h-full bg-gradient-to-r from-green-500 to-emerald-500 rounded-full transition-all duration-300" style="width: 5%"></div>
            </div>

            <div class="card-gradient rounded-2xl p-8 border border-white/10 mb-6">
                <div class="flex items-start gap-4 mb-6">
                    <span class="px-3 py-1 bg-green-500/20 text-green-400 rounded-lg text-sm font-medium" id="fillCategory">循环结构</span>
                </div>
                <h2 id="fillQuestionText" class="text-lg mb-6"></h2>
                <div class="code-editor rounded-xl overflow-hidden mb-6">
                    <div class="flex items-center justify-between px-4 py-2 bg-[#323233] border-b border-[#3c3c3c]">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-red-500"></span>
                            <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                            <span class="w-3 h-3 rounded-full bg-green-500"></span>
                        </div>
                        <span class="text-gray-400 text-sm code-font">main.c</span>
                    </div>
                    <pre id="fillCode" class="p-4 code-font text-sm leading-relaxed overflow-x-auto"></pre>
                </div>
                <div id="fillInputs" class="space-y-4"></div>
            </div>

            <div id="fillResult" class="card-gradient rounded-2xl p-6 border border-white/10 mb-6" style="display:none;">
                <div id="fillResultHeader" class="flex items-center gap-3 mb-4"></div>
                <div id="fillExplanation" class="text-gray-300"></div>
            </div>

            <div id="fillAiSection" class="card-gradient rounded-2xl p-6 border border-indigo-500/30 mb-6" style="display:none;">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="ri-robot-line"></i>
                    </div>
                    <span class="font-semibold">AI 智能讲解</span>
                </div>
                <div id="fillAiContent" class="text-gray-300 whitespace-pre-wrap"></div>
            </div>

            <div class="flex justify-between items-center">
                <button id="prevFillBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    <i class="ri-arrow-left-line mr-2"></i>上一题
                </button>
                <div class="flex gap-3">
                    <button id="aiExplainFillBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-robot-line mr-2"></i>AI讲解
                    </button>
                    <button id="submitFillBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-check-line mr-2"></i>提交答案
                    </button>
                </div>
                <button id="nextFillBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    下一题<i class="ri-arrow-right-line ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 编程题页面 -->
    <div id="page-program" class="page pt-20 min-h-screen">
        <div class="max-w-6xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold"><i class="ri-terminal-box-line mr-2 text-purple-400"></i>程序设计题</h1>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">题目 <span id="programCurrentNum" class="text-white font-bold">1</span> / <span id="programTotalNum">15</span></span>
                    <button id="favoriteProgramBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-star-line mr-1"></i>收藏
                    </button>
                    <button id="randomProgramBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-shuffle-line mr-1"></i>随机
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="space-y-6">
                    <div class="card-gradient rounded-2xl p-6 border border-white/10">
                        <div class="flex items-start gap-4 mb-4">
                            <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-lg text-sm font-medium" id="programCategory">数组</span>
                            <span class="px-3 py-1 bg-orange-500/20 text-orange-400 rounded-lg text-sm font-medium" id="programDifficulty">中等</span>
                        </div>
                        <h2 id="programTitle" class="text-xl font-bold mb-4"></h2>
                        <div id="programDescription" class="text-gray-300 mb-6"></div>
                        <div class="bg-black/30 rounded-xl p-4">
                            <h3 class="text-sm text-gray-400 mb-2">示例输入输出：</h3>
                            <pre id="programExample" class="code-font text-sm text-green-400"></pre>
                        </div>
                    </div>

                    <div id="programAiSection" class="card-gradient rounded-2xl p-6 border border-indigo-500/30" style="display:none;">
                        <div class="flex items-center gap-2 mb-4">
                            <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                                <i class="ri-robot-line"></i>
                            </div>
                            <span class="font-semibold">AI 代码分析</span>
                        </div>
                        <div id="programAiContent" class="text-gray-300 whitespace-pre-wrap"></div>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="code-editor rounded-xl overflow-hidden">
                        <div class="flex items-center justify-between px-4 py-2 bg-[#323233] border-b border-[#3c3c3c]">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                            </div>
                            <span class="text-gray-400 text-sm code-font">solution.c</span>
                        </div>
                        <div class="flex">
                            <div class="line-numbers p-4 code-font text-sm min-w-[50px]" id="programLineNumbers">1</div>
                            <textarea id="programCodeInput" class="code-input flex-1 p-4 code-font text-sm text-gray-100 min-h-[400px]" spellcheck="false" placeholder="在此编写你的C语言代码..."></textarea>
                        </div>
                    </div>

                    <div class="mb-4">
                        <label for="programInput" class="block text-sm text-gray-400 mb-2">程序输入 (stdin)：</label>
                        <textarea id="programInput" class="w-full px-4 py-3 bg-black/30 rounded-xl border border-white/10 focus:border-green-500 focus:outline-none code-font text-sm resize-none" placeholder="输入数据，每行一个..." rows="3"></textarea>
                    </div>

                    <div class="flex gap-3">
                        <button id="runProgramBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl hover:opacity-90 transition">
                            <i class="ri-play-fill mr-2"></i>运行代码
                        </button>
                        <button id="aiAnalyzeProgramBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                            <i class="ri-robot-line mr-2"></i>AI分析
                        </button>
                        <button id="showAnswerBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                            <i class="ri-check-line mr-2"></i>AI判断
                        </button>
                    </div>

                    <div id="programOutput" class="code-editor rounded-xl p-4" style="display:none;">
                        <div class="flex items-center gap-2 mb-2 text-gray-400">
                            <i class="ri-terminal-line"></i>
                            <span class="text-sm">输出结果</span>
                        </div>
                        <pre id="programOutputContent" class="code-font text-sm text-green-400"></pre>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center mt-8">
                <button id="prevProgramBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    <i class="ri-arrow-left-line mr-2"></i>上一题
                </button>
                <button id="nextProgramBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    下一题<i class="ri-arrow-right-line ml-2"></i>
                </button>
            </div>
        </div>
</div>

    <!-- 程序阅读题页面 -->
    <div id="page-reading" class="page pt-20 min-h-screen">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold"><i class="ri-file-code-line mr-2 text-purple-400"></i>程序阅读题</h1>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">题目 <span id="readingCurrentNum" class="text-white font-bold">1</span> / <span id="readingTotalNum">28</span></span>
                    <button id="favoriteReadingBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-star-line mr-1"></i>收藏
                    </button>
                    <button id="randomReadingBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-shuffle-line mr-1"></i>随机
                    </button>
                </div>
            </div>

            <div class="w-full h-2 bg-white/10 rounded-full mb-8 overflow-hidden">
                <div id="readingProgress" class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full transition-all duration-300" style="width: 3.57%"></div>
            </div>

            <div class="card-gradient rounded-2xl p-8 border border-white/10 mb-6">
                <div class="flex items-start gap-4 mb-6">
                    <span class="px-3 py-1 bg-purple-500/20 text-purple-400 rounded-lg text-sm font-medium">程序阅读</span>
                </div>
                <h2 id="readingQuestionText" class="text-xl mb-6"></h2>
                <div class="code-editor rounded-xl overflow-hidden mb-6">
                    <div class="flex items-center justify-between px-4 py-2 bg-[#323233] border-b border-[#3c3c3c]">
                        <div class="flex items-center gap-2">
                            <span class="w-3 h-3 rounded-full bg-red-500"></span>
                            <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                            <span class="w-3 h-3 rounded-full bg-green-500"></span>
                        </div>
                        <span class="text-gray-400 text-sm code-font">main.c</span>
                    </div>
                    <pre id="readingCode" class="p-4 code-font text-sm leading-relaxed overflow-x-auto whitespace-pre-wrap"></pre>
                </div>
                <div>
                    <label for="readingAnswer" class="block text-sm text-gray-400 mb-2">答案：</label>
                    <input type="text" id="readingAnswer" class="w-full px-4 py-3 bg-black/30 rounded-xl border border-white/10 focus:border-purple-500 focus:outline-none code-font" placeholder="在此输入答案">
                </div>
            </div>

            <div id="readingResult" class="card-gradient rounded-2xl p-6 border border-white/10 mb-6" style="display:none;">
                <div id="readingResultHeader" class="flex items-center gap-3 mb-4"></div>
                <div id="readingExplanation" class="text-gray-300"></div>
            </div>

            <div id="readingAiSection" class="card-gradient rounded-2xl p-6 border border-indigo-500/30 mb-6" style="display:none;">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="ri-robot-line"></i>
                    </div>
                    <span class="font-semibold">AI 智能讲解</span>
                </div>
                <div id="readingAiContent" class="text-gray-300 whitespace-pre-wrap"></div>
            </div>

            <div class="flex justify-between items-center">
                <button id="prevReadingBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    <i class="ri-arrow-left-line mr-2"></i>上一题
                </button>
                <div class="flex gap-3">
                    <button id="aiExplainReadingBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-robot-line mr-2"></i>AI讲解
                    </button>
                    <button id="submitReadingBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-check-line mr-2"></i>提交答案
                    </button>
                </div>
                <button id="nextReadingBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    下一题<i class="ri-arrow-right-line ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 填空题页面 -->
    <div id="page-blank" class="page pt-20 min-h-screen">
        <div class="max-w-4xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-8">
                <h1 class="text-3xl font-bold"><i class="ri-edit-2-line mr-2 text-blue-400"></i>填空题练习</h1>
                <div class="flex items-center gap-4">
                    <span class="text-gray-400">题目 <span id="blankCurrentNum" class="text-white font-bold">1</span> / <span id="blankTotalNum"></span></span>
                    <button id="favoriteBlankBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-star-line mr-1"></i>收藏
                    </button>
                    <button id="randomBlankBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-shuffle-line mr-1"></i>随机
                    </button>
                </div>
            </div>

            <div class="w-full h-2 bg-white/10 rounded-full mb-8 overflow-hidden">
                <div id="blankProgress" class="h-full bg-gradient-to-r from-blue-500 to-cyan-500 rounded-full transition-all duration-300" style="width: 0%"></div>
            </div>

            <div class="card-gradient rounded-2xl p-8 border border-white/10 mb-6">
                <div class="flex items-start gap-4 mb-6">
                    <span class="px-3 py-1 bg-blue-500/20 text-blue-400 rounded-lg text-sm font-medium" id="blankCategory">基础概念</span>
                </div>
                <h2 id="blankQuestionText" class="text-xl mb-6"></h2>
                <div id="blankInputs" class="space-y-4"></div>
            </div>

            <div id="blankResult" class="card-gradient rounded-2xl p-6 border border-white/10 mb-6" style="display:none;">
                <div id="blankResultHeader" class="flex items-center gap-3 mb-4"></div>
                <div id="blankExplanation" class="text-gray-300"></div>
            </div>

            <div id="blankAiSection" class="card-gradient rounded-2xl p-6 border border-indigo-500/30 mb-6" style="display:none;">
                <div class="flex items-center gap-2 mb-4">
                    <div class="w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <i class="ri-robot-line"></i>
                    </div>
                    <span class="font-semibold">AI 智能讲解</span>
                </div>
                <div id="blankAiContent" class="text-gray-300 whitespace-pre-wrap"></div>
            </div>

            <div class="flex justify-between items-center">
                <button id="prevBlankBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    <i class="ri-arrow-left-line mr-2"></i>上一题
                </button>
                <div class="flex gap-3">
                    <button id="aiExplainBlankBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-robot-line mr-2"></i>AI讲解
                    </button>
                    <button id="submitBlankBtn" class="px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl hover:opacity-90 transition">
                        <i class="ri-check-line mr-2"></i>提交答案
                    </button>
                </div>
                <button id="nextBlankBtn" class="px-6 py-3 bg-white/10 rounded-xl hover:bg-white/20 transition">
                    下一题<i class="ri-arrow-right-line ml-2"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- 收藏页面 -->
    <div id="page-favorites" class="page pt-20 min-h-screen">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="mb-8">
                <h1 class="text-3xl font-bold mb-4"><i class="ri-star-line mr-2 text-yellow-400"></i>我的收藏</h1>
                <p class="text-gray-400">这里展示你收藏的所有题目，点击题目可以直接跳转到对应的练习页面。</p>
            </div>
            
            <!-- 收藏题目列表 -->
            <div id="favoritesContainer" class="space-y-8">
                <!-- 选择题收藏 -->
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-blue-500/30 rounded-lg flex items-center justify-center">
                            <i class="ri-checkbox-circle-line text-blue-400"></i>
                        </div>
                        <h2 class="text-xl font-bold">选择题收藏</h2>
                        <span id="choiceFavoritesCount" class="text-sm text-gray-400">(0题)</span>
                    </div>
                    <div id="choiceFavoritesList" class="space-y-3"></div>
                </div>
                
                <!-- 程序填空题收藏 -->
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-green-500/30 rounded-lg flex items-center justify-center">
                            <i class="ri-edit-box-line text-green-400"></i>
                        </div>
                        <h2 class="text-xl font-bold">程序填空题收藏</h2>
                        <span id="fillFavoritesCount" class="text-sm text-gray-400">(0题)</span>
                    </div>
                    <div id="fillFavoritesList" class="space-y-3"></div>
                </div>
                
                <!-- 填空题收藏 -->
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-blue-500/30 rounded-lg flex items-center justify-center">
                            <i class="ri-edit-2-line text-blue-400"></i>
                        </div>
                        <h2 class="text-xl font-bold">填空题收藏</h2>
                        <span id="blankFavoritesCount" class="text-sm text-gray-400">(0题)</span>
                    </div>
                    <div id="blankFavoritesList" class="space-y-3"></div>
                </div>
                
                <!-- 编程题收藏 -->
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-purple-500/30 rounded-lg flex items-center justify-center">
                            <i class="ri-terminal-box-line text-purple-400"></i>
                        </div>
                        <h2 class="text-xl font-bold">编程题收藏</h2>
                        <span id="programFavoritesCount" class="text-sm text-gray-400">(0题)</span>
                    </div>
                    <div id="programFavoritesList" class="space-y-3"></div>
                </div>
                
                <!-- 程序阅读题收藏 -->
                <div class="card-gradient rounded-2xl p-6 border border-white/10">
                    <div class="flex items-center gap-2 mb-4">
                        <div class="w-8 h-8 bg-purple-500/30 rounded-lg flex items-center justify-center">
                            <i class="ri-file-code-line text-purple-400"></i>
                        </div>
                        <h2 class="text-xl font-bold">程序阅读题收藏</h2>
                        <span id="readingFavoritesCount" class="text-sm text-gray-400">(0题)</span>
                    </div>
                    <div id="readingFavoritesList" class="space-y-3"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 模拟器页面 -->
    <div id="page-simulator" class="page pt-20 min-h-screen">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex items-center justify-between mb-6 flex-wrap gap-4">
                <h1 class="text-3xl font-bold"><i class="ri-computer-line mr-2 text-green-400"></i>C语言编程模拟器</h1>
                <div class="flex items-center gap-3 flex-wrap">
                    <select id="codeTemplate" class="px-4 py-2 bg-white/10 rounded-lg border border-white/20 text-white">
                        <option value="">选择模板...</option>
                        <option value="hello">Hello World</option>
                        <option value="input">输入输出</option>
                        <option value="loop">循环示例</option>
                        <option value="array">数组操作</option>
                        <option value="function">函数定义</option>
                        <option value="pointer">指针基础</option>
                        <option value="struct">结构体</option>
                        <option value="string">字符串处理</option>
                        <option value="file">文件操作</option>
                    </select>
                    <button id="clearSimBtn" class="px-4 py-2 bg-white/10 rounded-lg hover:bg-white/20 transition">
                        <i class="ri-delete-bin-line mr-1"></i>清空
                    </button>
                </div>
            </div>

            <div class="mb-4 flex flex-wrap gap-2 text-xs">
                <span class="px-2 py-1 bg-white/10 rounded text-gray-400"><kbd class="bg-white/20 px-1 rounded">Tab</kbd> 代码补全</span>
                <span class="px-2 py-1 bg-white/10 rounded text-gray-400"><kbd class="bg-white/20 px-1 rounded">Shift+Tab</kbd> AI智能预测</span>
                <span class="px-2 py-1 bg-white/10 rounded text-gray-400"><kbd class="bg-white/20 px-1 rounded">Enter</kbd> 自动缩进</span>
                <span class="px-2 py-1 bg-white/10 rounded text-gray-400"><kbd class="bg-white/20 px-1 rounded">Ctrl+/</kbd> 注释</span>
                <span class="px-2 py-1 bg-white/10 rounded text-gray-400"><kbd class="bg-white/20 px-1 rounded">Ctrl+Enter</kbd> 编译运行</span>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-4">
                    <div class="code-editor rounded-xl overflow-hidden relative">
                        <div class="flex items-center justify-between px-4 py-2 bg-[#323233] border-b border-[#3c3c3c]">
                            <div class="flex items-center gap-2">
                                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                                <span class="w-3 h-3 rounded-full bg-green-500"></span>
                            </div>
                            <div class="flex items-center gap-3">
                                <span id="compileStatus" class="text-xs text-gray-500"></span>
                                <span class="text-gray-400 text-sm code-font">main.c</span>
                            </div>
                        </div>
                        <div class="flex relative">
                            <div class="line-numbers p-4 text-right code-font text-sm select-none leading-6 min-w-[50px]" id="simLineNumbers">1</div>
                            <div class="code-container flex-1 relative">
                                <!-- 语法高亮层 -->
                                <div id="syntaxHighlight" class="syntax-highlight code-font"></div>
                                <!-- 代码输入层 -->
                                <textarea id="simCodeInput" class="code-input w-full p-4 code-font text-sm min-h-[500px] leading-6" spellcheck="false" placeholder="在此编写C语言代码..."></textarea>
                                <!-- AI补全提示框 -->
                                <div id="aiSuggestionBox" class="absolute hidden bg-[#2d2d2d] border border-indigo-500/50 rounded-lg shadow-xl z-10 max-w-md">
                                    <div class="px-3 py-2 border-b border-white/10 flex items-center gap-2">
                                        <i class="ri-robot-line text-indigo-400"></i>
                                        <span class="text-xs text-gray-400">AI 建议 (按 Tab 接受)</span>
                                    </div>
                                    <div id="aiSuggestionContent" class="p-3 code-font text-sm text-green-400 max-h-48 overflow-auto"></div>
                                </div>
                                <!-- 代码补全菜单 -->
                                <div id="autocompleteMenu" class="absolute hidden bg-[#2d2d2d] border border-white/20 rounded-lg shadow-xl z-20 min-w-[280px] max-h-64 overflow-auto">
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-3 flex-wrap">
                        <button id="runSimBtn" class="flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl font-semibold hover:opacity-90 transition glow-green">
                            <i class="ri-play-fill mr-2"></i>编译并运行 (AI)
                        </button>
                        <button id="analyzeSimBtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition">
                            <i class="ri-bug-line mr-2"></i>检查错误
                        </button>
                    </div>
                </div>

                <div class="space-y-4">
                    <!-- AI对话生成代码框 -->
                    <div class="card-gradient rounded-xl p-4 border border-purple-500/30">
                        <h3 class="text-sm text-purple-400 mb-2 flex items-center gap-2">
                            <i class="ri-magic-line"></i>AI 代码生成助手
                        </h3>
                        <textarea id="aiPromptInput" class="w-full h-20 bg-black/30 rounded-lg p-3 text-sm text-white resize-none border border-white/10 focus:border-purple-500 focus:outline-none" placeholder="描述你需要的程序，例如：&#10;写一个计算1到100素数的程序"></textarea>
                        <button id="generateCodeBtn" class="w-full mt-2 py-2 bg-gradient-to-r from-purple-500 to-pink-500 rounded-lg text-sm font-semibold hover:opacity-90 transition">
                            <i class="ri-sparkling-line mr-1"></i>生成代码
                        </button>
                    </div>

                    <div class="card-gradient rounded-xl p-4 border border-white/10">
                        <h3 class="text-sm text-gray-400 mb-2 flex items-center gap-2">
                            <i class="ri-input-method-line"></i>程序输入 (stdin)
                        </h3>
                        <textarea id="simInput" class="w-full h-24 bg-black/30 rounded-lg p-3 code-font text-sm text-white resize-none border border-white/10 focus:border-indigo-500 focus:outline-none" placeholder="输入数据，每行一个..."></textarea>
                    </div>

                    <div class="card-gradient rounded-xl p-4 border border-white/10">
                        <div class="flex items-center justify-between mb-2">
                            <h3 class="text-sm text-gray-400 flex items-center gap-2">
                                <i class="ri-terminal-line"></i>程序输出 (stdout)
                            </h3>
                            <span id="outputStatus" class="text-xs"></span>
                        </div>
                        <div id="simOutput" class="w-full min-h-[200px] bg-black/50 rounded-lg p-3 code-font text-sm overflow-auto">
                            <span class="text-gray-500">// 点击"编译并运行"查看输出...</span>
                        </div>
                    </div>

                    <div id="simAiSection" class="card-gradient rounded-xl p-4 border border-indigo-500/30" style="display:none;">
                        <div class="flex items-center gap-2 mb-3">
                            <div class="w-6 h-6 bg-gradient-to-br from-indigo-500 to-purple-600 rounded flex items-center justify-center">
                                <i class="ri-robot-line text-xs"></i>
                            </div>
                            <span class="text-sm font-semibold">AI 代码分析</span>
                        </div>
                        <div id="simAiContent" class="text-sm text-gray-300 whitespace-pre-wrap max-h-64 overflow-auto"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    
    <!-- AI问答弹窗 -->
    <div id="qaModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" style="display:none;">
        <div class="card-gradient rounded-2xl border border-white/10 w-full max-w-3xl mx-4 max-h-[80vh] flex flex-col">
            <div class="flex items-center justify-between p-6 border-b border-white/10">
                <h2 class="text-xl font-bold"><i class="ri-robot-2-line mr-2 text-indigo-400"></i>AI 智能问答</h2>
                <div class="flex items-center gap-3">
                    <button id="clearChatBtn" class="text-gray-400 hover:text-white">
                        <i class="ri-delete-bin-line text-xl"></i>
                    </button>
                    <button id="closeQAModalBtn" class="text-gray-400 hover:text-white">
                        <i class="ri-close-line text-2xl"></i>
                    </button>
                </div>
            </div>
            
            <!-- 对话内容区域 -->
            <div id="qaChatArea" class="flex-1 overflow-y-auto p-6 space-y-6">
                <!-- 系统欢迎消息 -->
                <div class="flex gap-4">
                    <div class="w-10 h-10 bg-indigo-500/30 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="ri-robot-line text-indigo-400"></i>
                    </div>
                    <div class="flex-1">
                        <div class="card-gradient p-4 rounded-xl">
                            <p class="text-gray-300">你好！我是你的C语言学习助手，有什么问题可以问我。</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 常见问题区域 -->
            <div class="p-6 border-t border-white/10 bg-black/20">
                <h3 class="text-sm text-gray-400 mb-3 flex items-center gap-2">
                    <i class="ri-question-line"></i>
                    常见问题
                </h3>
                <div id="qaCommonQuestions" class="flex flex-wrap gap-2">
                    <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">什么是变量？</button>
                    <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">如何声明数组？</button>
                    <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">指针是什么？</button>
                    <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">如何定义函数？</button>
                </div>
            </div>
            
            <!-- 输入区域 -->
            <div class="p-6 border-t border-white/10">
                <div class="flex gap-3">
                    <textarea id="qaInput" class="flex-1 min-h-[100px] px-4 py-3 bg-black/30 rounded-xl border border-white/10 focus:border-indigo-500 focus:outline-none resize-y" placeholder="输入你的问题...可以粘贴代码"></textarea>
                    <button id="sendQABtn" class="px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-xl hover:opacity-90 transition self-end">
                        <i class="ri-send-plane-line"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading弹窗 -->
    <div id="loadingModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center" style="display:none;">
        <div class="card-gradient rounded-2xl p-8 border border-white/10 text-center">
            <div class="typing-indicator flex justify-center gap-1 mb-4">
                <span class="w-3 h-3 bg-indigo-500 rounded-full"></span>
                <span class="w-3 h-3 bg-indigo-500 rounded-full"></span>
                <span class="w-3 h-3 bg-indigo-500 rounded-full"></span>
            </div>
            <p id="loadingText" class="text-gray-300">AI 正在处理中...</p>
        </div>
    </div>

    <script>
        // ==================== 题库数据 ====================
        const choiceQuestions = [
            { category: "数据类型", difficulty: "简单", question: "在C语言中，int类型在32位系统中通常占用多少字节？", options: ["1字节", "2字节", "4字节", "8字节"], answer: 2, explanation: "在32位系统中，int类型通常占用4个字节（32位）。" },
            { category: "数据类型", difficulty: "简单", question: "以下哪个是C语言中用于表示单个字符的数据类型？", options: ["string", "char", "character", "text"], answer: 1, explanation: "char是C语言中用于存储单个字符的数据类型，占用1个字节。" },
            { category: "数据类型", difficulty: "中等", question: "float类型和double类型的主要区别是什么？", options: ["float只能存储整数", "double精度更高，占用更多内存", "它们完全相同", "float占用更多内存"], answer: 1, explanation: "float是单精度浮点数，占4字节；double是双精度浮点数，占8字节。" },
            { category: "运算符", difficulty: "简单", question: "表达式 5 % 3 的结果是多少？", options: ["1", "2", "1.67", "0"], answer: 1, explanation: "% 是取模运算符，返回除法的余数。5 ÷ 3 = 1 余 2。" },
            { category: "运算符", difficulty: "简单", question: "在C语言中，逻辑与运算符是什么？", options: ["&", "&&", "and", "|"], answer: 1, explanation: "&& 是逻辑与运算符，当两个操作数都为真时返回真。" },
            { category: "运算符", difficulty: "中等", question: "表达式 a++ 和 ++a 的区别是什么？", options: ["没有区别", "a++先使用后自增，++a先自增后使用", "a++是加2，++a是加1", "a++只能用于循环"], answer: 1, explanation: "a++是后缀自增，先返回a的值再自增；++a是前缀自增，先自增再返回新值。" },
            { category: "控制结构", difficulty: "简单", question: "for循环的三个表达式分别是什么？", options: ["条件、循环体、结束", "初始化、条件、更新", "开始、执行、结束", "定义、赋值、输出"], answer: 1, explanation: "for(初始化; 条件; 更新) 三部分分别是初始化、条件判断、更新表达式。" },
            { category: "控制结构", difficulty: "简单", question: "以下哪个关键字用于跳出循环？", options: ["continue", "break", "exit", "return"], answer: 1, explanation: "break用于立即跳出当前循环或switch语句。" },
            { category: "控制结构", difficulty: "中等", question: "switch语句中，如果没有break会发生什么？", options: ["语法错误", "case穿透，继续执行下一个case", "直接跳到default", "程序崩溃"], answer: 1, explanation: "如果case后没有break，程序会继续执行下一个case的语句，这称为'case穿透'。" },
            { category: "函数", difficulty: "简单", question: "在C语言中，main函数的返回类型通常是什么？", options: ["void", "int", "char", "float"], answer: 1, explanation: "main函数通常返回int类型，返回0表示程序正常结束。" },
            { category: "函数", difficulty: "中等", question: "C语言中函数参数传递默认是什么方式？", options: ["引用传递", "值传递", "指针传递", "地址传递"], answer: 1, explanation: "C语言默认使用值传递，函数接收的是实参的副本。" },
            { category: "函数", difficulty: "困难", question: "递归函数必须具备的两个条件是什么？", options: ["必须有返回值和参数", "必须调用自己和必须有终止条件", "必须是void类型", "必须使用全局变量"], answer: 1, explanation: "递归函数需要：1）调用自身；2）有终止条件。" },
            { category: "数组", difficulty: "简单", question: "声明一个包含10个整数的数组，正确的语法是？", options: ["int arr(10);", "int arr[10];", "array int arr[10];", "int[10] arr;"], answer: 1, explanation: "C语言中声明数组的语法是：类型 数组名[大小];" },
            { category: "数组", difficulty: "简单", question: "数组下标从什么开始？", options: ["0", "1", "-1", "可以自定义"], answer: 0, explanation: "C语言数组下标从0开始。" },
            { category: "数组", difficulty: "中等", question: "二维数组 int a[3][4] 共有多少个元素？", options: ["7", "12", "34", "3"], answer: 1, explanation: "二维数组的元素个数 = 行数 × 列数 = 3 × 4 = 12个元素。" },
            { category: "指针", difficulty: "简单", question: "指针变量存储的是什么？", options: ["整数", "字符", "内存地址", "浮点数"], answer: 2, explanation: "指针变量存储的是另一个变量的内存地址。" },
            { category: "指针", difficulty: "中等", question: "int *p; 中 *p 表示什么？", options: ["p的地址", "p指向的值", "指针p", "乘法运算"], answer: 1, explanation: "*p 是解引用操作，表示访问p所指向的内存地址中的值。" },
            { category: "指针", difficulty: "中等", question: "&a 运算符的作用是什么？", options: ["取a的值", "取a的地址", "按位与运算", "逻辑与运算"], answer: 1, explanation: "& 在变量前是取地址运算符，返回变量的内存地址。" },
            { category: "字符串", difficulty: "简单", question: "C语言中字符串以什么字符结尾？", options: ["'\\n'", "'\\0'", "'\\t'", "' '"], answer: 1, explanation: "'\\0' 是空字符，用于标记字符串的结束。" },
            { category: "字符串", difficulty: "中等", question: "strlen(\"Hello\") 的返回值是？", options: ["5", "6", "4", "7"], answer: 0, explanation: "strlen函数返回字符串的长度，不包括结尾的'\\0'。" },
            { category: "字符串", difficulty: "中等", question: "以下哪个函数用于复制字符串？", options: ["strcat", "strcmp", "strcpy", "strlen"], answer: 2, explanation: "strcpy(dest, src) 将src字符串复制到dest。" },
            { category: "输入输出", difficulty: "简单", question: "printf函数中，%d用于输出什么类型的数据？", options: ["浮点数", "字符", "整数", "字符串"], answer: 2, explanation: "%d是整数的格式说明符。" },
            { category: "输入输出", difficulty: "简单", question: "scanf函数读取整数时，变量前需要加什么符号？", options: ["*", "&", "#", "$"], answer: 1, explanation: "scanf需要传入变量的地址，所以要用&取地址符。" },
            { category: "输入输出", difficulty: "中等", question: "printf(\"%.2f\", 3.14159) 的输出是？", options: ["3.14159", "3.14", "3.1", "3"], answer: 1, explanation: ".2表示保留2位小数。" },
            { category: "运算符", difficulty: "中等", question: "表达式 (3 > 2) && (5 < 4) 的结果是？", options: ["1", "0", "true", "false"], answer: 1, explanation: "3>2为真(1)，5<4为假(0)。逻辑与要求两边都为真，所以结果是0。" },
            { category: "控制结构", difficulty: "中等", question: "do-while循环和while循环的主要区别是什么？", options: ["没有区别", "do-while至少执行一次循环体", "while效率更高", "do-while不能用break"], answer: 1, explanation: "do-while循环先执行循环体，再判断条件，所以至少执行一次。" },
            { category: "数组", difficulty: "中等", question: "以下数组初始化正确的是？", options: ["int arr[] = {1, 2, 3};", "int arr[3] = {1, 2, 3, 4};", "int arr[];", "int[] arr = {1, 2, 3};"], answer: 0, explanation: "可以用花括号初始化数组，不指定大小时编译器会自动确定。" },
            { category: "函数", difficulty: "中等", question: "以下哪个是函数声明的正确形式？", options: ["int add(int a, int b) { return a+b; }", "int add(int, int);", "add(int a, int b)", "int add;"], answer: 1, explanation: "函数声明只需要指定返回类型、函数名和参数类型。" },
            { category: "指针", difficulty: "困难", question: "对于 int arr[5]; arr 和 &arr 有什么区别？", options: ["完全相同", "arr是首元素地址，&arr是整个数组的地址", "arr是数组，&arr是指针", "没有区别"], answer: 1, explanation: "arr等价于&arr[0]，是int*类型；&arr是整个数组的地址，是int(*)[5]类型。" },
            { category: "预处理", difficulty: "简单", question: "#include <stdio.h> 的作用是？", options: ["定义变量", "包含标准输入输出头文件", "创建函数", "声明数组"], answer: 1, explanation: "#include是预处理指令，用于包含头文件。stdio.h包含printf、scanf等函数声明。" },
            { category: "数据类型", difficulty: "简单", question: "1. 在C语言中，不正确的int类型的常数是（   ）", options: ["32768", "0", "037", "0xAF"], answer: 0, explanation: "在16位系统中，int范围是-32768到32767，32768超出了范围。" },
            { category: "运算符", difficulty: "简单", question: "2. 在以下一组运算符中，优先级最高的运算符是（）", options: ["<=", "=", "%", "&&"], answer: 2, explanation: "优先级顺序：算术运算符(%) > 关系运算符(<=) > 逻辑运算符(&&) > 赋值运算符(=)。" },
            { category: "表达式", difficulty: "简单", question: "3. 表示关系x<=y<=z的c语言表达式为（    ）。", options: ["(X<=Y)&&(Y<=Z)", "(X<=Y)AND(Y<=Z)", "(X<=Y<=Z)", "(X<=Y)&(Y<=Z)"], answer: 0, explanation: "C语言中不能连写比较关系，需要使用逻辑与(&&)连接。" },
            { category: "算法", difficulty: "中等", question: "4. 设x和y均为int型变量，则以下语句：x+=y；y=x-y；x-=y；的功能是（    ）", options: ["把x和y按从大到小排列", "把x和y按从小到大排列", "无确定结果", "交换x和y中的值"], answer: 3, explanation: "这是经典的在不使用临时变量的情况下交换两个变量值的算法。" },
            { category: "表达式", difficulty: "简单", question: "5. 在下列选项中，不正确的赋值表达式是（   ）", options: ["a=b+c=1", "n1=(n2=(n3=0))", "k=i==j", "++t"], answer: 0, explanation: "赋值运算符左边必须是变量（左值），b+c是表达式（右值），不能被赋值。" },
            { category: "标识符", difficulty: "简单", question: "6. 以下选项中合法的用户标识符是（   ）。", options: ["long", "_2Test", "3Dmax", "A.dat"], answer: 1, explanation: "标识符由字母、数字、下划线组成，不能以数字开头，不能包含点号，long是关键字。" },
            { category: "数据类型", difficulty: "简单", question: "7. 以下选项中属于C语言的数据类型是（    ）", options: ["复数型", "逻辑型", "双精度型", "集合型"], answer: 2, explanation: "C语言基本数据类型包括整型、浮点型（单精度/双精度）、字符型等。" },
            { category: "输入输出", difficulty: "简单", question: "8. 以下程序的输出结果是（    ）\nmain( )\n{\n int k=17;\n printf(\"%d,%o,%x \\n\",k,k,k); \n}", options: ["17,021,0x11", "17,17,17", "17,0x11,021", "17,21,11"], answer: 3, explanation: "%d是十进制(17)，%o是八进制(21)，%x是十六进制(11)。" },
            { category: "逻辑运算", difficulty: "中等", question: "9. 已有定义：int x=3,y=4,z=5;，则表达式!(x+y)+z-1&&y+z/2的值是（    ）。", options: ["6", "0", "2", "1"], answer: 3, explanation: "!(7)为0，0+5-1=4，y+z/2=6，4&&6结果为1。" },
            { category: "输入输出", difficulty: "简单", question: "10. 设有定义：long x=-123456L;，则以下能够正确输出变量x值的语句是（    ）。", options: ["printf(\"x=%d\\n\",x);", "printf(\"x=%ld\\n\",x);", "printf(\"x=%8dL\\n\",x);", "printf(\"x=%LD\\n\",x);"], answer: 1, explanation: "long类型输出需要使用%ld格式控制符。" },
            { category: "表达式", difficulty: "中等", question: "11. 设x、y、z和k都是int型变量，则执行表达式x=(y=4,z=16,k=32)后，x的值为（   ）", options: ["4", "16", "32", "52"], answer: 2, explanation: "逗号表达式的值取最后一个表达式的值，即32。" },
            { category: "数据类型", difficulty: "简单", question: "12. 设a和b均为double型常量，且a=5.5、b=2.5，则表达式(int)a+b/b的值是（    ）。", options: ["6.500000", "6", "5.500000", "6.000000"], answer: 3, explanation: "(int)5.5变成5，2.5/2.5=1.0，5+1.0=6.0（double型）。" },
            { category: "字符运算", difficulty: "简单", question: "13. 若有以下定义和语句\nchar c1='b',c2='e';\nprintf(\"%d,%c\\n\",c2-c1,c2-'a'+'A');\n则输出结果是（    ）", options: ["2,M", "3,E", "2,E", "输出结果不确定"], answer: 1, explanation: "'e'-'b'=3，'e'-'a'+'A'='E'。" },
            { category: "逻辑运算", difficulty: "中等", question: "14. 有以下程序\nmain()\n{ int a,b,c=246;\na=c/100%9;\nb=(-1)&&(-1);\nprintf(\"%d,%d\\n\",a,b);}\n输出结果是（    ）", options: ["2,1", "3,2", "4,3", "2,-1"], answer: 0, explanation: "a=246/100=2, 2%9=2；b=(-1)&&(-1)=1（真）。" },
            { category: "函数", difficulty: "简单", question: "15. 下列说法中正确的是（    ）。", options: ["程序总是从第一个定义的函数开始执行", "要调用的函数必须在main()函数中定义", "程序总是从main()函数开始执行", "main()函数必须放在程序的开始部分"], answer: 2, explanation: "C程序总是从main()函数开始执行。" },
            { category: "基本语法", difficulty: "简单", question: "16. 下列叙述中错误的是（    ）。", options: ["C语句必须以分号结束", "复合语句在语法上被看作一条语句", "空语句出现在任何位置都不会影响程序运行", "赋值表达式末尾加分号就构成赋值语句"], answer: 2, explanation: "空语句在循环体等位置可能会改变程序逻辑（例如造成死循环），所以C错。" },
            { category: "循环", difficulty: "中等", question: "17. 有如下程序,该程序的执行结果是（    ）\nmain()\n{ int i,sum;\nfor(i=1;i<=3;sum++) sum+=i;\nprintf(\"%d\\n\",sum);}", options: ["6", "3", "死循环", "0"], answer: 2, explanation: "for循环中没有更新i的值，i始终为1，导致死循环。" },
            { category: "循环", difficulty: "中等", question: "18. 有以下程序, 程序运行后的输出结果是（   ）\nmain()\n{ int k=4,n=0;\nfor( ; n<k;)\n{ n++;\nif(n%3!=0) continue;\nk--;}\nprintf(\"%d,%d\\n\",k,n);}", options: ["1,1", "2,2", "3,3", "4,4"], answer: 2, explanation: "n=1,2(continue),3(k--变3), n=3不小于k(3)循环结束，输出3,3。" },
            { category: "循环", difficulty: "简单", question: "19. 有以下程序,程序执行后的输出结果是（   ）\nmain( )\n{  int i,s=0;\n  for(i=1;i<10;i+=2)  s+=i+1;\n  printf(\"%d\\n\",s);}", options: ["自然数1～9的累加和", "自然数1～10的累加和", "自然数1～9中的奇数之和", "自然数1～10中的偶数之和"], answer: 3, explanation: "i取1,3,5,7,9；s累加i+1即2,4,6,8,10，为偶数和。" },
            { category: "算法", difficulty: "中等", question: "20. 运行以下程序后，如果从键盘上输入65 14<回车>，则输出结果为（    ）\nmain( )\n{int m，n;\nscanf(\"%d%d\"，&m，&n);\nwhile(m!=n)\n{ while(m>n) m-=n;\nwhile(n>m)   n-=m;}\nprintf(“m=%d\\n”，m);}", options: ["m=3", "m=2", "m=1", "m=0"], answer: 2, explanation: "这是求最大公约数的更相减损术，65和14互质，结果为1。" },
            { category: "循环嵌套", difficulty: "中等", question: "21. 有下列程序：\nmain( )\n{ int i,j,x=0;\nfor(i=0;i<2;i++)\n{ x++;\nfor(j=0;j<=3;j++)\n{ if(j%2) continue;\nx++;}\nx++;}\nprintf(\"x=%d\\n\",x);}\n程序执行后的输出结果是（    ）。", options: ["x=4", "x=8", "x=6", "x=12"], answer: 1, explanation: "外循环2次，内循环每次加2，外循环每次加2，总共2*(1+2+1)=8。" },
            { category: "运算符", difficulty: "简单", question: "22. 若执行以下程序时从键盘上输入9，则输出结果是（    ）\nmain()\n{ int n;\nscanf(\"%d\",&n);\nif(n++<10)\nprintf(\"%d\\n\",n);\nelse\nprintf(\"%d\\n\",n--);}", options: ["11", "10", "9", "8"], answer: 1, explanation: "n=9, n++<10为真，n变为10，输出n(10)。" },
            { category: "循环", difficulty: "简单", question: "23. 有以下程序\nmain()\n{int a=1,b=2;\nwhile(a<6)\n{b+=2;a+=2;b%=10;}\nprintf(\"%d,%d\",a,b);}\n程序运行后的输出结果是（    ）", options: ["5,11", "7,8", "7,11", "6,1"], answer: 1, explanation: "循环执行3次：(3,4)->(5,6)->(7,8)，a=7退出循环。" },
            { category: "循环", difficulty: "中等", question: "24. 以下程序的输出结果是（   ）\nmain()\n{ int a, b;\nfor(a=1, b=1; a<=100; a++)\n{ if(b>=10) break;\nif (b%3==1)\n{ b+=3; continue; }}\nprintf(\"%d\\n\",a);\n}", options: ["101", "6", "5", "4"], answer: 3, explanation: "b的变化：1->4->7->10(break)，此时a=4。" },
            { category: "逻辑运算", difficulty: "中等", question: "25. 有以下程序\nmain()\n{ int n=2,k=0;\n while(k++&&n++>2);\n printf(\"%d %d\\n\",k,n);}\n程序运行后的输出结果是（    ）", options: ["0 2", "1 3", "5 7", "1 2"], answer: 3, explanation: "k++先取值0，逻辑与短路，n++不执行；k变1，循环结束，n保持2。" },
            { category: "数组", difficulty: "简单", question: "26. 若有定义语句：int m[]={5,4,3,2,1},i=4;，则下面对m 数组元素的引用中错误的是（    ）。", options: ["m[--i]", "m[2*2]", "m[m[0]]", "m[m[i]]"], answer: 2, explanation: "m[0]是5，m[5]越界。" },
            { category: "数组", difficulty: "简单", question: "27. 若有定义：int a[2][3];， 以下选项中对a 数组元素正确引用的是（    ）。", options: ["a[2][!1]", "a[2][3]", "a[0][3]", "a[1>2][!1]"], answer: 3, explanation: "D选项即a[0][0]合法，其他选项存在越界。" },
            { category: "数组", difficulty: "简单", question: "28. 设有以下定义语句:\n char str[4][12]={\"aaa\",\"bbbb\",\"ccccc\",\"dddddd\"};\n下面对字符串的引用正确的是（    ）。", options: ["str[0][3]", "str[4]", "str[1]", "str[1][4]"], answer: 2, explanation: "str[1]是二维数组的一行，代表一个字符串首地址。" },
            { category: "数组", difficulty: "中等", question: "29. 已知数组a的赋值情况如下所示,则执行语句a[2]++;后a[1]和a[2]的值分别是（   ）。\n a[0]=10, a[1]=20, a[2]=30...", options: ["20和30", "20和31", "21和30", "21和31"], answer: 1, explanation: "a[2]++是对元素值自增，30变为31，a[1]不受影响。" },
            { category: "字符串", difficulty: "简单", question: "30. 当执行下面的程序时，如果输入ABC，则输出结果是（    ）\nmain( )\n{ \nchar ss[10]=\"1,2,3,4,5\";\ngets(ss);strcat(ss,\"6789\");printf(\"%s\\n\",ss);\n}", options: ["ABC6789", "ABC67", "12345ABC6", "ABC456789"], answer: 0, explanation: "gets会覆盖原内容，strcat追加在末尾。" },
            { category: "数组", difficulty: "困难", question: "31. 以下程序的输出结果是（    ）\nmain( )\n{ int b[3][3]={0,1,2,0,1,2,0,1,2},i,j,t=1;\n for(i=0;i<3;i++)\n   for(j=i;j<=i;j++) \n     t=t+b[i][b[j][j]];\n printf(\"%d\\n\",t);\n}", options: ["3", "4", "1", "9"], answer: 1, explanation: "累加对角线元素作为索引的值，最终t=1+0+1+2=4。" },
            { category: "数组", difficulty: "中等", question: "32. 有如下程序\nmain( )\n{ int a[3][3]={{1,2},{3,4},{5,6}},i,j,s=0;\n for(i=1;i<3;i++)\n for(j=0;j<=i;j++) s+=a[i][j];\n printf(\"%d\\n\",s);\n}\n该程序的输出结果是（    ）", options: ["18", "19", "20", "21"], answer: 0, explanation: "累加a[1][0], a[1][1], a[2][0], a[2][1], a[2][2](为0)，即3+4+5+6=18。" },
            { category: "数组", difficulty: "困难", question: "33. 以下程序的输出结果是（    ）\nmain( )\n{ int i,k,a[10],p[3]; k=5;\n for (i=0;i<10;i++) a[i]=i;\n for (i=0;i<3;i++) p[i]=a[i*(i+1)];\n for (i=0;i<3;i++) k+=p[i]*2;\n printf(\"%d\\n\",k);\n}", options: ["20", "21", "22", "23"], answer: 1, explanation: "计算k=5 + 2*(a[0]+a[2]+a[6]) = 5 + 2*(0+2+6) = 21。" },
            { category: "算法", difficulty: "中等", question: "34. 以下程序功能是计算平均分并输出低于平均分的成绩。划线处应填入（    ）。\nwhile(a>=0.0 && n<1000) { sum+=______; ... } ave=________;", options: ["a和sum/n", "x[n]和sum/n", "a和sum/I", "a和sum/1000"], answer: 0, explanation: "累加当前成绩a，计算平均值sum/n。" },
            { category: "字符串", difficulty: "简单", question: "35. 有以下程序\nmain(){char x[]=\"STRING\";x[0]=0;x[1]='\\0';x[2]='0';\nprintf(\"%d %d\\n\",sizeof(x),strlen(x));}\n程序运行后的输出结果是（    ）。", options: ["6 1", "7 0", "6 3", "7 1"], answer: 1, explanation: "sizeof包括结尾空字符共7，x[0]被置为0，strlen为0。" },
            { category: "字符串", difficulty: "简单", question: "36. 有以下程序，执行后输出结果是（    ）。\nmain( ){ char a[]=\"abcdefg\",b[10]=\"abcdefg\";\nprintf(\"%d%d\\n\",sizeof(a),sizeof(b));}", options: ["7 7", "8 8", "8 10", "10 10"], answer: 2, explanation: "a自动计算长度包含\\0为8，b固定长度10。" },
            { category: "字符串", difficulty: "中等", question: "37. 有如下程序，将字符数组转换为数值，输出结果是（    ）。\n(代码逻辑：拼接\"6937\"和\"8254\"转为长整型)", options: ["69825", "693825", "6385", "69378254"], answer: 3, explanation: "逻辑上是按顺序将所有数字字符合成一个数。" },
            { category: "Switch", difficulty: "中等", question: "38. 运行以下程序后，输入china#，输出结果为（   ）\n(switch语句中v1,v2计数，无break)", options: ["2，0", "5，0", "5，5", "2，5"], answer: 2, explanation: "switch贯穿执行，所有字符都触发default，v1和v2都增加5次。" },
            { category: "变量", difficulty: "简单", question: "39. 以下叙述中，不正确的是（    ）。", options: ["不同函数中可以使用同名变量", "在main函数体内定义的变量是全局变量", "形参是局部变量", "同名时全局变量被屏蔽"], answer: 1, explanation: "main函数内定义的变量是局部变量。" },
            { category: "程序结构", difficulty: "简单", question: "40. C语言中，任意一个程序总是首先执行（    ）。", options: ["主过程", "主函数", "子程序", "主程序"], answer: 1, explanation: "即main函数。" },
            { category: "函数", difficulty: "简单", question: "41. C语言中，定义函数时未给出函数的返回类型，则缺省返回类型是（    ）。", options: ["float", "int", "void", "double"], answer: 1, explanation: "C89标准默认为int。" },
            { category: "存储类型", difficulty: "简单", question: "42. C语言中,凡未指定存储类别的局部变量的隐含存储类别是:（    ）。", options: ["自动(auto)", "静态(static)", "外部(extern)", "寄存器(register)"], answer: 0, explanation: "局部变量默认为auto。" },
            { category: "函数", difficulty: "简单", question: "43. 程序中对fun函数有说明void fun( void); 此说明的含义是（   ）。", options: ["fun函数无返回值", "返回值任意", "返回指针", "指向函数的指针"], answer: 0, explanation: "void表示无返回值。" },
            { category: "函数", difficulty: "简单", question: "44. 有如下函数调用语句 func(rec1，rec2+rec3，(rec4，rec5))；实参个数是（    ）。", options: ["3", "4", "5", "语法错"], answer: 0, explanation: "逗号表达式(rec4,rec5)算一个参数，共3个。" },
            { category: "数组", difficulty: "简单", question: "45. 若使用数组名作为函数调用的实参，则传递给形参的是：（    ）。", options: ["数组的首地址", "第一个元素的值", "全部元素的值", "元素个数"], answer: 0, explanation: "数组名衰退为首地址。" },
            { category: "函数", difficulty: "简单", question: "46. c语言规定，函数返回值的类型是由（    ）。", options: ["系统临时决定", "定义函数时指定的类型决定", "return语句决定", "主调函数决定"], answer: 1, explanation: "以函数定义时的类型为准。" },
            { category: "指针", difficulty: "中等", question: "47. 有下列程序：void change(int k[]){k[0]=k[5];} ... main(){...change(&x[n])...}\n输出结果是（    ）。", options: ["6 7 8 9 10", "1 3 5 7 9", "1 2 3 4 5", "6 2 3 4 5"], answer: 0, explanation: "循环修改了数组前5个元素的值，使其等于后5个元素的值。" },
            { category: "指针", difficulty: "中等", question: "48. 有下列程序：统计首字符为'T'的字符串个数。输出结果是（    ）。", options: ["1", "2", "3", "0"], answer: 1, explanation: "Tue和Thu符合条件，共2个。" },
            { category: "函数", difficulty: "简单", question: "49. 在函数调用中，以下说法正确的是（    ）。", options: ["实参与形参各占独立存储单元", "实参与形参共占同一单元", "同名时才共占", "形参不占单元"], answer: 0, explanation: "C语言是值传递，形参有独立内存。" },
            { category: "算法", difficulty: "中等", question: "50. 以下函数返回a数组中最小值所在的下标，划线处填入（    ）。\nfor(i=j;i<n;i++) if(a[i]<a[p])________;", options: ["i=p", "a[p]=a[i]", "p=j", "p=i"], answer: 3, explanation: "更新最小值下标p=i。" },
            { category: "指针", difficulty: "困难", question: "51. 有下列程序：对数组部分排序。fun(c+4,6)... 输出结果是（    ）。", options: ["1,2,3,4,5,6,7,8,9,0", "0,9,8,7,6,5,1,2,3,4", "0,9,8,7,6,5,4,3,2,1", "1,2,3,4,9,8,7,6,5,0"], answer: 3, explanation: "只对后6个元素进行了降序排序，前4个保持不变。" },
            { category: "指针", difficulty: "简单", question: "52. 已知：int i=0,j=1,*p=&i,*q=&j;错误语句是（    ）。", options: ["i=*&q", "i=*&j", "p=&*&i", "j=*p++"], answer: 0, explanation: "q是指针，&q是指针的地址，*&q还是指针，不能赋给int变量i。" },
            { category: "指针", difficulty: "简单", question: "53. 若有定义 int a,b,*p; float c,*q;，以下赋值正确的是（   ）。", options: ["p=&c", "q=p", "p=NULL", "q=new int"], answer: 2, explanation: "类型必须匹配，p=NULL是合法的。" },
            { category: "指针", difficulty: "简单", question: "54. 设有定义... *p=&n2,*q=&n1;，与n2=n1等价的是（   ）。", options: ["*p=*q", "p=q", "*p=&n1", "p=*q"], answer: 0, explanation: "*p代表n2，*q代表n1。" },
            { category: "指针", difficulty: "简单", question: "55. 有定义double a[10],*s=a;，以下能够代表数组元素a[3]的是（    ）。", options: ["(*s)[3]", "*(s+3)", "*s[3]", "*s+3"], answer: 1, explanation: "*(s+3)等价于a[3]。" },
            { category: "指针", difficulty: "中等", question: "56. 执行以下程序段后,m的值为（    ）。\nm=(*p)*(*(p+2))*(*(p+4)); (p指向a[0][0]=1)", options: ["15", "14", "13", "12"], answer: 0, explanation: "计算1*3*5=15。" },
            { category: "指针", difficulty: "中等", question: "57. 有以下程序... --p; y=*p; (p初值指向a[3]=4) 输出y的值（   ）。", options: ["y=0", "y=1", "y=2", "y=3"], answer: 3, explanation: "p前移一位指向a[2]=3。" },
            { category: "指针", difficulty: "困难", question: "58. 有下列程序：字符串排序。输出p[1]长度。（    ）。", options: ["2", "3", "6", "4"], answer: 3, explanation: "排序后p[1]为abbd，长度4。" },
            { category: "指针", difficulty: "中等", question: "59. 下列程序的运行结果是（    ）。(fun交换指针指向) fun(x,y); printf...", options: ["6 3", "3 6", "编译出错", "0 0"], answer: 1, explanation: "函数内交换局部指针变量，不影响实参值。" },
            { category: "指针", difficulty: "简单", question: "60. 有以下程序 *p =*p1*(*p2); (1*3) 输出c（    ）。", options: ["1", "2", "3", "4"], answer: 2, explanation: "c被赋值为3。" },
            { category: "结构体", difficulty: "简单", question: "61. typedef struct { ... } PER; PER是（    ）。", options: ["变量名", "类型名", "结构体类型", "结构体名"], answer: 1, explanation: "typedef定义了类型别名。" },
            { category: "结构体", difficulty: "中等", question: "62. 以下对结构体类型变量的定义中,不正确的是（    ）。", options: ["typedef struct aa ...", "#define AA struct aa ...", "struct ...", "struct { ... } td1;"], answer: 2, explanation: "C选项语法结构不完整。" },
            { category: "结构体", difficulty: "中等", question: "63. 有如下定义...能输出字母M的语句是（    ）。", options: ["class[3].mane", "class[3].name[1]", "class[2].name[1]", "class[2].name[0]"], answer: 3, explanation: "class[2]为Mary，name[0]为M。" },
            { category: "联合体", difficulty: "中等", question: "64. 变量a所占内存字节数是（    ）。(包含int c和Union u(long l))", options: ["4", "5", "6", "8"], answer: 3, explanation: "Union取最大成员4字节，结构体4+4=8字节。" },
            { category: "结构体", difficulty: "中等", question: "65. 以下程序的输出结果是（    ）。((h[0].p)->x 即 h[1].x)", options: ["1 2", "2 3", "1 4", "3 2"], answer: 3, explanation: "相互指向，输出对方的坐标值。" },
            { category: "结构体", difficulty: "中等", question: "66. 有下列程序：f(s[0]) (值传递)... 输出结果（    ）。", options: ["20045 537", "20044 550", "20042 580", "20041 703"], answer: 3, explanation: "值传递修改不影响原数据。" },
            { category: "结构体", difficulty: "困难", question: "67. 设有以下说明和定义... sizeof(struct date)+sizeof(max) (max是Union)", options: ["26", "52", "18", "8"], answer: 1, explanation: "结构体约32字节，联合体20字节，合计52。" },
            { category: "结构体", difficulty: "简单", question: "68. 有以下程序 fun(students+2) 输出name... （    ）。", options: ["Zhang", "Zhao", "Wang", "18"], answer: 1, explanation: "指向第3个学生Zhao。" },
            { category: "文件", difficulty: "简单", question: "69. 下列叙述中正确的是（    ）。", options: ["流式文件只能顺序存取", "写操作必覆盖", "写后必须关闭再开才能读", "操作完成后必须关闭"], answer: 3, explanation: "文件操作完成后必须关闭以防止数据丢失。" },
            { category: "文件", difficulty: "简单", question: "70. 下列关于C语言文件的叙述中正确的是（    ）。", options: ["只能二进制", "二进制或文本", "数据序列", "只能文本"], answer: 2, explanation: "C语言文件由数据序列组成，可存为二进制或文本。" },
        ];

        const fillQuestions = [
            { category: "循环结构", question: "补充代码，计算1到100的和", code: "#include <stdio.h>\nint main() {\n    int sum = 0;\n    for(int i = 1; i <= 100; ___①___) {\n        sum ___②___ i;\n    }\n    printf(\"Sum = %d\\n\", sum);\n    return 0;\n}", blanks: ["i++", "+="], explanation: "for循环的更新表达式使用i++实现自增，sum += i实现累加。" },
            { category: "条件判断", question: "补充代码，判断一个数是否为偶数", code: "#include <stdio.h>\nint main() {\n    int n;\n    scanf(\"%d\", &n);\n    if(n ___①___ 2 == 0) {\n        printf(\"偶数\\n\");\n    } ___②___ {\n        printf(\"奇数\\n\");\n    }\n    return 0;\n}", blanks: ["%", "else"], explanation: "n % 2 取余运算，如果余数为0则是偶数。else处理条件不满足的情况。" },
            { category: "数组操作", question: "补充代码，找出数组中的最大值", code: "#include <stdio.h>\nint main() {\n    int arr[5] = {3, 7, 2, 9, 5};\n    int max = ___①___;\n    for(int i = 1; i < 5; i++) {\n        if(arr[i] ___②___ max) {\n            max = arr[i];\n        }\n    }\n    printf(\"Max = %d\\n\", max);\n    return 0;\n}", blanks: ["arr[0]", ">"], explanation: "先假设第一个元素为最大值，然后遍历比较。" },
            { category: "函数", question: "补充代码，定义一个计算阶乘的函数", code: "#include <stdio.h>\n___①___ factorial(int n) {\n    if(n <= 1) ___②___ 1;\n    return n * factorial(n - 1);\n}\nint main() {\n    printf(\"%d\\n\", factorial(5));\n    return 0;\n}", blanks: ["int", "return"], explanation: "函数返回类型为int，return语句返回递归基准值1。" },
            { category: "指针", question: "补充代码，使用指针交换两个变量的值", code: "#include <stdio.h>\nvoid swap(int *a, int *b) {\n    int temp = ___①___;\n    *a = *b;\n    ___②___ = temp;\n}\nint main() {\n    int x = 5, y = 10;\n    swap(&x, &y);\n    printf(\"x=%d, y=%d\\n\", x, y);\n    return 0;\n}", blanks: ["*a", "*b"], explanation: "*a和*b分别访问指针a和b指向的值。" },
            { category: "字符串", question: "补充代码，计算字符串长度", code: "#include <stdio.h>\nint myStrlen(char *s) {\n    int len = 0;\n    while(___①___ != '\\0') {\n        len++;\n        ___②___;\n    }\n    return len;\n}", blanks: ["*s", "s++"], explanation: "*s访问当前字符，s++移动指针到下一个字符。" },
            { category: "数组操作", question: "补充代码，实现冒泡排序", code: "#include <stdio.h>\nint main() {\n    int arr[5] = {5, 2, 8, 1, 9};\n    for(int i = 0; i < 4; i++) {\n        for(int j = 0; j < 4 - i; j++) {\n            if(arr[j] ___①___ arr[j+1]) {\n                int temp = arr[j];\n                arr[j] = arr[j+1];\n                ___②___ = temp;\n            }\n        }\n    }\n    return 0;\n}", blanks: [">", "arr[j+1]"], explanation: "冒泡排序通过相邻元素比较交换。" },
            { category: "函数", question: "补充代码，判断一个数是否为素数", code: "#include <stdio.h>\nint isPrime(int n) {\n    if(n < 2) return 0;\n    for(int i = 2; i * i ___①___ n; i++) {\n        if(n ___②___ i == 0) return 0;\n    }\n    return 1;\n}", blanks: ["<=", "%"], explanation: "只需检查到√n即可，n % i == 0表示能被整除。" },
            { category: "指针", question: "补充代码，使用指针遍历数组", code: "#include <stdio.h>\nint main() {\n    int arr[5] = {1, 2, 3, 4, 5};\n    int ___①___ = arr;\n    for(int i = 0; i < 5; i++) {\n        printf(\"%d \", ___②___);\n        p++;\n    }\n    return 0;\n}", blanks: ["*p", "*p"], explanation: "int *p = arr; 声明指针p指向数组首元素。" },
            { category: "循环结构", question: "补充代码，计算斐波那契数列第n项", code: "#include <stdio.h>\nint main() {\n    int n = 10, a = 0, b = 1;\n    for(int i = 2; i <= n; i++) {\n        int c = ___①___;\n        a = b;\n        ___②___ = c;\n    }\n    printf(\"%d\\n\", b);\n    return 0;\n}", blanks: ["a + b", "b"], explanation: "斐波那契数列：每项等于前两项之和。" },
            { category: "数组与统计", question: "以下程序的功能是输入了20个数存放在一个数组中,并且输出其中最大者与最小者,20个数的和及它们的平均值。请填空。", code: "main( )\n{\n\tint array[20];\n\tint max,min,average,sum;\n\tint i;\n\tfor(i=0;i<=___①___;i++)\n\t\tscanf(\"%d\", &array[i]);       \n\tmax=min=array[0];\n\tfor(i=0,sum=0;i<20;i++)\n\t{\n\t\tif(max___②___array[i])\n\t\t\tmax=array[i];\n\t\tif(min>array[i])\n\t\t\tmin=array[i];\n\t\tsum=___③___;        \n\t} \n\taverage = sum/20;\n\tprintf(\"20个数中最大值是%d,\",max);\n\tprintf(\"最小值是%d,\",min);\n\tprintf(\"和是%d,\",sum);\n\tprintf(\"平均值是%d.\\n\",average);    \n}", blanks: ["19", "<", "sum+array[i]"], explanation: "1. 数组下标从0开始，20个元素下标范围是0-19，所以循环条件是 i<=19。<br>2. 求最大值时，如果当前 max 小于数组元素(max < array[i])，则更新 max。<br>3. sum 用于累加数组元素的和。" },
            { category: "数学计算", question: "函数pi的功能是根据以下近似公式求π值：(π*π)/6=1+1/(2*2)+1/(3*3)+..+1/(n*n)。请填空。", code: "#include \"math.h\"\ndouble pi(long n)\n{\ndouble s=0.0; long i;\nfor(i=1;i<=n;i++)s=s+___①___;\nreturn(sqrt(6*s));\n}", blanks: ["1.0/(i*i)"], explanation: "公式中每一项是 1/(n*n)，在循环中变量是 i。为了保证进行浮点数运算而不是整数除法，分子需要写成 1.0。" },
            { category: "循环与阶乘", question: "以下函数的功能是计算s=1+1/2!+1/3!+……+1/n!，请填空。", code: "double fun(int n)\n{double s=0.0,fac=1.0; int i;\nfor(i=1;i<=n;i++)\n{fac=fac___①___;\n\ts=s+fac;\n}\nreturn s;\n}", blanks: ["*(1.0/i)"], explanation: "阶乘倒数的递推公式。第 i 项的倒数 1/i! 等于上一项 1/(i-1)! 乘以 1/i。因此 fac = fac * (1.0/i)。" },
            { category: "函数声明", question: "请在以下程序第一行的下划线处填写适当内容，使程序能正确运行。", code: "___①___ ( double, double);\nmain()\n{ double x,y;\nscanf(\"%lf%lf\",&x,&y);\nprintf(\"%lf\\n\",max(x ,y));\n}\ndouble max(double a,double b)\n{ return(a>b ? a:b); }", blanks: ["double max"], explanation: "这是函数的原型声明。根据后面定义的 max 函数，其返回类型为 double，函数名为 max。" },
            { category: "指针与字符串", question: "以下程序的功能是用来计算字符串的长度。请填空。", code: "int strLength(char *str)\n{\nchar *p=str;\nint i=0;\nwhile(*p++!='___①___')    \n    ___②___;\n    return i;\n}\nmain( )\n{\nchar *s=\"asdfghj\";\nprintf(\"%d\\n\",strLength(___③___));\n}", blanks: ["\\0", "i++", "s"], explanation: "1. 字符串结束标志是 '\\0'。<br>2. 统计长度，每遇到一个非结束符字符，计数器 i 自增。<br>3. 调用函数时传入字符串的首地址 s。" },
            { category: "指针运算", question: "以下程序的功能是使用指针变量指向元素的方法，求出数组中最大值与最小值，以及他们之间的距离。请填空。", code: "main( )\n{\n\tint a[10]={1,4,3,6,8,0,3,2,9,8},i;\nint *p,*pMax,*pMin;\n\t___①___;\nfor(p=a;p<___②___;p++)\n{\n\tif(*p<*pMin)     pMin=p;\n    if(*p>*pMax)     pMax=p;\n}\n\ti=abs(___③___);  //函数abs为绝对值函数\nprintf(\"\\n最大值为%d, 最小值为%d.它们相距%d个元素\\n\",*pMax,*pMin,i);\n}", blanks: ["pMax=pMin=a", "a+10", "pMax-pMin"], explanation: "1. 初始化最大值和最小值指针指向数组首地址 a。<br>2. 指针遍历数组，循环终止条件是 p 指向数组末尾之后（a+10）。<br>3. 两个指针相减得到的是它们之间的元素个数距离。" },
            { category: "素数算法", question: "以下程序的功能是判断整数m（m≥3）是否为素数。请填空。", code: "#include <stdio.h>\n#include <math.h>\nmain( ) \n{\n\tint i,m,k;\nprintf(\"请输入一个正整数 m:\");\nscanf(\"%d\",&m);\nk=sqrt(___①___);\nfor(i=2;i<=___②___;i++)\n{\n\tif (m%i==0)  break;\n\t}\nif(i___③___k)      \n    printf(\"%d 是一个素数.\\n\",m);\n\telse \n\tprintf(\"%d 不是一个素数.\\n\",m);\n}", blanks: ["m", "k", ">"], explanation: "1. 判断素数只需循环到 m 的平方根 k=sqrt(m)。<br>2. 循环变量 i 从 2 到 k。<br>3. 如果循环正常结束（即 i > k），说明没有找到能整除 m 的因子，m 为素数。" },
            { category: "逻辑控制", question: "以下程序的功能是求二次方程ax^2+bx+c=0的根，用循环方法实现能重复输入系数a,b,c求方程的根，直到输入的系数均为0为止。请填空。", code: "main()\n{\n    double a,b,c,x1,x2,temp;\n    printf(\"输入二次方程的系数:\");\n    scanf(\"%lf%lf%lf\",&a,&b,&c);\n    while(___①___)\n    {\n        if(___②___)\n\t{\n\ttemp=b*b-4*a*c;\n           if(temp>=0)\n           {\n               x1=(-b+sqrt(temp))/(2*a);\n               x2=(-b-sqrt(temp))/(2*a);\n               printf(\"根为：%.2lf，%.2lf\\n \",x1,x2);\n           }\n\telse\n\t        printf(\"无实根。\\n\");\n\t}\n        printf(\"重新输入二次方程的系数:\");\n        ___③___;\n    }\n}", blanks: ["a!=0 || b!=0 || c!=0", "a!=0", "scanf(\"%lf%lf%lf\",&a,&b,&c)"], explanation: "1. 循环条件是只要 a, b, c 不全为 0 就继续（即至少有一个不为0）。<br>2. 二次方程要求二次项系数 a != 0。<br>3. 循环体内需要再次读取输入以决定是否继续循环。" },
            { category: "函数与循环", question: "以下函数的功能是：求x的y次方，请填空。", code: "double fun( double x, int y)\n{\nint i;\ndouble z;\nfor(i=1, z=x; i<y;i++) z=z*___①___;\nreturn z;\n}", blanks: ["x"], explanation: "计算 x 的 y 次方，即是将 x 连乘 y 次。z 初始化为 x，循环 y-1 次，每次乘 x。" },
            { category: "数组插入算法", question: "以下函数用来在w数组中插入x,w数组中的数已按由小到大顺序存放,n所指存储单元中存放数组中数据的个数,插入后数组中的数仍有序。请填空。", code: "void fun (char *w,char x,int *n)\n{\nint i,p; \np=0;\nwhile(x>w[p])\n\t___①___;\nfor(i=*n;i>p;i--)w[i]=\n___②___;\nw[p]=x;\n++*n;\n}", blanks: ["p++", "w[i-1]"], explanation: "1. while 循环用于找到 x 应该插入的位置 p。<br>2. 找到位置后，将 p 之后的元素整体后移一位，w[i] = w[i-1] 实现后移。" },
            { category: "字符串指针", question: "以下程序的功能是:从键盘上输入一行字符,存入一个字符数组中,然后输出该字符串,请填空。", code: "#include\"stdio.h\"\nmain()\n{\nchar str[81],*sptr;\nint i;\nfor(i=0;i<80;i++)\n{\nstr[i]=getchar();\nif(str[i]=='\\n')\nbreak;\n}\nstr[i]=___①___;\nsptr=str;\nwhile(*sptr)\nputchar(*sptr___②___);\n}", blanks: ["'\\0'", "++"], explanation: "1. 字符串输入结束后必须手动添加字符串结束符 '\\0'。<br>2. 输出字符后，指针需要后移指向下一个字符，使用后置自增 *sptr++。" },
            { category: "函数递归逻辑", question: "以下程序的功能是求a！+b！+c!的值，并输出结果。请填空。", code: "___①___;\nmain( )\n{ \nint a,b,c,i;\nprintf(\"input a,b,c:\");\nscanf(\"%d,%d,%d\",&a,&b,&c);\nprintf(\"sum=%ld\\n\",___②___);\n}\nlong rfact(int n)\n{\n\tlong t;\nint i;\nfor(t=1,i=1;i<=n;i++)\n___③___;\nreturn(t);\n}", blanks: ["long rfact(int n)", "rfact(a)+rfact(b)+rfact(c)", "t*=i"], explanation: "1. 函数原型声明。<br>2. 调用三次 rfact 函数分别求阶乘并相加。<br>3. 阶乘计算核心：t = t * i。" },
            { category: "数组统计", question: "以下程序的功能是从键盘输入10个无序的整数，去掉一个最大数和最小数，然后求其平均值。请填空。", code: "main( )\n{\n\tint  j,x,max,min,sum;\nfloat  ave;\nprintf(\"Enter 10  number:\\n\");\nscanf(\"%d\",&x);\nsum=max=min=x; \nfor(___①___;j<=10;j++)\n{ \n\t___②___;\n       sum+=x;  \n       if( x>max )  max=x;\n       else if(x<min) min=x;\n}\n\t___③___;\nave=sum/8.0;\nprintf(\"The average  is  %.2f\\n\",ave);\n} ", blanks: ["j=2", "scanf(\"%d\",&x)", "sum=sum-max-min"], explanation: "1. 第一个数已经在循环前读取，循环从第 2 个数开始，j=2。<br>2. 循环体内读取后续的数字。<br>3. 求平均前先从总和 sum 中减去最大值 max 和最小值 min。" },
            { category: "指针遍历", question: "以下程序的功能是使用指针变量指向元素的方法，输出数组的元素。请填空。", code: "main( )\n{\n\tint a[10],i;\n    int *p;\n___①___;\n    for(i=0;i<10;i++)    \n    *p++=i;\n___②___;\n    for(i=0;i<10;i++)\n    printf(\"a[%d]=%d\\n\",i, ___③___);\n}", blanks: ["p=a", "p=a", "*p++"], explanation: "1. 初始化指针 p 指向数组首地址 a。<br>2. 第一次循环后 p 已经指向末尾，需要重置 p=a。<br>3. 输出当前指针指向的值并后移指针。" },
            { category: "排序算法", question: "以下程序的功能是对a所指数组中的数据进行由大到小的排序。请填空。", code: "void sort(int a[],int n)\n{\n\tint i,j,t;\n\tfor(i=0;i<n-1;i++)\n\tfor(j=___①___;j<n;j++)\n\tif(a[j-1] ___②___a[j])\n\t{\n\tt=a[j-1];\n    a[j-1]=a[j];\n    a[j]=t;\n\t}\n}\nmain()\n{\n\tint aa[10]={1,2,3,4,5,6,7,8,9,10},i;\n\tsort(___③___,10);\n\tfor(i=0;i<10;i++)\n\tprintf(\"%d,\",aa[i]);\n\tprintf(\"\\n\");\n}", blanks: ["i+1", "<", "aa"], explanation: "1. 这是一种变体的冒泡/选择排序逻辑，内层循环从 j=i+1 开始。<br>2. 要求由大到小排序，如果前一个元素(a[j-1])小于后一个元素(a[j])，则交换。<br>3. 调用函数时传入数组名 aa。" },
            { category: "指针参数", question: "以下fun函数的功能是：累加数组元素的值。n为数组中元素的个数。累加的和值放入x所指的存储单元中。请填空。", code: "fun(int b[ ],int n,int *x)\n{\nint k, r=0;\n\tfor(k=0;k<n;k++)\nr=___①___;\n\t___②___=r;\n}", blanks: ["r+b[k]", "*x"], explanation: "1. 累加数组元素：r = r + b[k]。<br>2. 结果存入指针 x 指向的内存单元，使用 *x = r。" },
            { category: "字符串长度", question: "mystrlen函数的功能是计算str所指字符串的长度,并作为函数值返回。请填空。", code: "int  mystrlen(char *str)\n{\nint  i;\nfor(i=0;___①___!='\\0';i++);\nreturn(___②___);\n}", blanks: ["*(str+i)", "i"], explanation: "1. 访问字符串第 i 个字符，可以使用 str[i] 或 *(str+i)。<br>2. 循环结束后，i 即为字符串的长度。" },
            { category: "二维数组操作", question: "以下程序的功能是输入a数组的20个元素进行奇偶性分类，并把偶数存储在二维数组b的0行，奇数存储在二维数组b的1行。请填空。", code: "main( )\n{\n\tint a[20],b[2][10];\nint i,j,col1=0,col2=0;\nprintf(\"请输入数据：\\n\");\nfor(i=0;i<20;i++)\n\tscanf(\"%d\",&a[i]);\nfor(i=0;i<20;i++)\n{\n\tif(___①___)\n    ___②___;\n    else\n        ___③___;   \n}    \n\tfor(i=0;i<2;i++)\n{\n\tfor(j=0;j<10;j++)\n    printf(\"%6d\",b[i][j]);\n    printf(\"\\n\");    \n}\n}", blanks: ["a[i]%2==0", "b[0][col1++]=a[i]", "b[1][col2++]=a[i]"], explanation: "1. 判断偶数条件：a[i]%2==0。<br>2. 偶数存入 b[0] 行，使用 col1 计数并自增。<br>3. 奇数存入 b[1] 行，使用 col2 计数并自增。" },
            { category: "部分排序", question: "下面程序的功能是：将字符数组a中下标值为偶数的元素从小到大排列,其它元素不变。请填空。", code: "#include<stdio.h>\n#include<string.h>\nmain()\n{\nchar a[]=\"clanguage\",t;\nint i,j,k;\nk=strlen(a);\nfor(i=0;i<=k-2;i+=2)\nfor(j=i+2;j<k;___①___)\n\tif (___②___)  { t=a[i]; a[i]=a[j]; a[j]=t;}\nputs(a);\nprintf(\"\\n\");\n}", blanks: ["j+=2", "a[i]>a[j]"], explanation: "1. 因为只处理偶数下标，内层循环变量 j 每次也需要增加 2 (j+=2)。<br>2. 从小到大排序，如果前面的元素 a[i] 大于 后面的元素 a[j]，则交换。" },
            { category: "字符串删除", question: "以下程序的功能是用以删除字符串所有的空格。请填空。", code: "main()\n{\n\tchar s[100]={\"Our teacher teach C language!\"};\n\tint i,j;\n\tfor(i=j=0;s[i]!=___①___;i++)\n\tif(s[i]!= ' ') \n\t{\n\ts[j]=s[i];\n\t___②___;\n\t}\n\ts[j]= ___③___;\n\tprintf(\"%s\\n\",s);\n}", blanks: ["'\\0'", "j++", "'\\0'"], explanation: "1. 循环结束条件是遇到字符串结束符 '\\0'。<br>2. 当字符不是空格时，将其复制到 s[j] 位置，并将 j 自增。<br>3. 处理完毕后，需要在新字符串末尾手动添加结束符 '\\0'。" }
        ];

        // 填空题数组
        const blankQuestions = [
            { category: "C语言基础", question: "C程序是由___①___构成的，一个C程序中至少包含___②___。", code: "", blanks: ["函数", "main（）"] },
            { category: "输入输出", question: "C语言的输入输出操作是由___①___和___②___函数来实现的。", code: "", blanks: ["printf()", "scanf()"] },
            { category: "函数", question: "函数有___①___出口。", code: "", blanks: ["一个"] },
            { category: "数据类型", question: "在C语言中，实数有两种表示形式，即___①___和___②___。", code: "", blanks: ["float", "double"] },
            { category: "数据类型", question: "在C语言中，一个字符数据既能以___①___输出，也能以___②___输出。", code: "", blanks: ["字符型数据", "整型数据"] },
            { category: "类型转换", question: "若有语句 double x=17; int y; 当执行 y=(int)(x/5)%2; 之后y的值是___①___。", code: "", blanks: ["1"] },
            { category: "运算符", question: "若有定义语句：int a=5; 则表达式 a++ 的值是___①___。", code: "", blanks: ["5"] },
            { category: "运算符", question: "在C语言中，运算符的优先级最小的是___①___运算符。", code: "", blanks: ["逗号"] },
            { category: "类型转换", question: "若有语句 double x=17; int y; 当执行 y=(int)(x/5)%2; 之后y的值是___①___。", code: "", blanks: ["1"] },
            { category: "类型转换", question: "设有以下变量定义，并已赋确定的值：char w； int x； float y ； double z；，则表达式：w*x＋z－y所求得值的数据类型为___①___。", code: "", blanks: ["double"] },
            { category: "分支结构", question: "为了避免嵌套条件语句的二义性,C语言规定else与其前面最近的___①___语句配对。", code: "", blanks: ["if"] },
            { category: "循环结构", question: "若输入字符串：abcde<回车>,则以下while循环体将执行___①___次。", code: "while((ch=getchar())=='e')\nprintf(\"*\");", blanks: ["0"] },
            { category: "循环结构", question: "若有int i=1,a=0,s=1;，执行语句do{a=a+s*i; s=-s; i++;}while(i<=10);后，a=___①___。", code: "", blanks: ["-5"] },
            { category: "文件操作", question: "fopen函数如果调用成功，返回相应文件的___①___，否则，返回___②___。", code: "", blanks: ["指针", "NULL"] },
            { category: "二维数组", question: "若有定义int i,j,a[3][3];下列语句执行后，a[1][2]和a[2][1]的值为___①___和___②___。", code: "for(i=0;i<3;i++)\nfor(j=0;j<=i;j++)\na[i][j]=i*j;", blanks: ["不定值", "2"] },
            { category: "位运算", question: "设int a=10;a<<2的值是___①___。", code: "", blanks: ["40"] },
            { category: "指针", question: "指针变量的值是它所指向的变量的___①___。", code: "", blanks: ["地址"] },
            { category: "指针与数组", question: "设有变量定义：int a[]={1,2,3,4,5,6},*p=a+2; 试计算表达式 *(p+2) 的值是___①___。", code: "", blanks: ["5"] },
            { category: "数组", question: "array是一个一维整型数组,有10个元素,前6个元素的初值是9,4,7,49,32,-5，写出正确的说明语句___①___。", code: "", blanks: ["int array[10]={9,4,7,49,32,-5}"] },
            { category: "字符串", question: "若有定义char s[]=\"\\\\141\\141abc\\t\";,则strlen(s)=___①___。", code: "", blanks: ["9"] },
            { category: "数组", question: "若有以下数组a,数组元素:a[0]~a[9],其值为:9、4、12、8、2、10、7、5、1、3，该数组的元素中,数值最小的元素的下标值是___①___。", code: "", blanks: ["8"] },
            { category: "二维数组", question: "若有定义int i,x[3][3]={9,8,7,6,5,4,3,2,1};，则x[1][2]=___①___。", code: "", blanks: ["4"] },
            { category: "数组存储", question: "若二维数组a有m列，则计算任一元素a[i][j]在数组中位置的公式为___①___。（假设a[0][0]位于数组的第一个位置上。）", code: "", blanks: ["i*m+j+1"] },
            { category: "函数", question: "若自定义函数要求返回一个值，则应在该函数体中有一条___①___语句，若自定义函数要求不返回一个值，则应在该函数说明时加一个类型符___②___。", code: "", blanks: ["return", "void"] },
            { category: "函数调用", question: "有如下函数调用语句 func(rec1,rec2+rec3,(rec4,rec5));该函数调用语句中，含有的实参个数是___①___个。", code: "", blanks: ["3"] },
            { category: "函数参数", question: "参数是函数调用时进行信息传递的载体，函数的参数分为___①___和___②___两种。", code: "", blanks: ["形参", "实参"] },
            { category: "函数调用", question: "所谓___①___就是在调用函数时，将实参变量的地址传递给对应的形参，使其指向同样的存储区域。", code: "", blanks: ["地址传递"] },
            { category: "函数调用", question: "如果是调用无参函数，则实参列表可以没有，但___①___不能省略。", code: "", blanks: ["括号"] },
            { category: "预处理", question: "用C语言标准库函数，一般要用___①___预处理命令将其头文件包含进来。", code: "", blanks: ["文件包含（或#include）"] },
            { category: "函数分类", question: "从用户使用的角度看，C语言中的函数可以分为___①___和___②___两大类。", code: "", blanks: ["库函数", "用户自定义函数"] },
            { category: "存储类型", question: "变量的存储类型说明有四种：auto、register、___①___、___②___。", code: "", blanks: ["extern", "static"] },
            { category: "内存", question: "计算机系统为每个内存单元进行编号，内存单元的编号也叫做___①___。", code: "", blanks: ["地址"] },
            { category: "指针运算", question: "p为一指针变量，试写出表达式___①___，用以实现：取p所指向单元的数据作为表达式的值，然后使p指向后一个单元。", code: "", blanks: ["*p++"] },
            { category: "指针参数", question: "下面函数用来求出两个整数之和,并通过形参传回两数相加之和值,请填空。", code: "int add(int x,int y, ___①___ )\n{ ___②___ =x+y;}", blanks: ["int *z", "*z"] },
            { category: "结构体", question: "设int占2个字节，char占1个字节，若有以下定义和语句,则a占用字节数是___①___ ,而b占用字节数是___②___ 。", code: "struct { int day;\nchar mouth; int year;}a;*b;\nb=&a;", blanks: ["5", "2"] },
            { category: "结构体指针", question: "已知有职工结构体定义...用printf函数输出指针p所指向职工姓名的语句为___①___。", code: "struct employee\n{\n int num; /*工号*/\n char name[20];   /*姓名*/\n}\n*p={101,”wangfei”};", blanks: ["printf(“%s”,p->name);"] },
            { category: "结构体", question: "对结构体类型变量初始化时，初始化数据和结构体成员在类型、___①___和___②___上必须保持一致。", code: "", blanks: ["个数", "顺序"] },
            { category: "文件操作", question: "在C语言中，所谓___①___就是由文件向内存输入数据，而___②___则是由内存向文件输出数据。", code: "", blanks: ["读文件", "写文件"] }    
            // 这里可以添加填空题，题目我会稍后添加
        ];

        const programQuestions = [
            { category: "基础运算", difficulty: "简单", title: "计算两个数的和", description: "编写程序，输入两个整数a和b，输出它们的和。", example: "输入: 3 5\n输出: 8", answer: "#include <stdio.h>\nint main() {\n    int a, b;\n    scanf(\"%d %d\", &a, &b);\n    printf(\"%d\\n\", a + b);\n    return 0;\n}" },
            { category: "条件判断", difficulty: "简单", title: "判断奇偶数", description: "输入一个整数，判断它是奇数还是偶数。", example: "输入: 7\n输出: odd", answer: "#include <stdio.h>\nint main() {\n    int n;\n    scanf(\"%d\", &n);\n    if(n % 2 == 0) printf(\"even\\n\");\n    else printf(\"odd\\n\");\n    return 0;\n}" },
            { category: "循环", difficulty: "简单", title: "计算1到N的和", description: "输入一个正整数N，计算1+2+3+...+N的和。", example: "输入: 10\n输出: 55", answer: "#include <stdio.h>\nint main() {\n    int n, sum = 0;\n    scanf(\"%d\", &n);\n    for(int i = 1; i <= n; i++) sum += i;\n    printf(\"%d\\n\", sum);\n    return 0;\n}" },
            { category: "循环", difficulty: "中等", title: "计算阶乘", description: "输入一个非负整数N，计算N的阶乘。", example: "输入: 5\n输出: 120", answer: "#include <stdio.h>\nint main() {\n    int n;\n    long long fact = 1;\n    scanf(\"%d\", &n);\n    for(int i = 1; i <= n; i++) fact *= i;\n    printf(\"%lld\\n\", fact);\n    return 0;\n}" },
            { category: "数组", difficulty: "中等", title: "找出数组最大值", description: "输入n个整数，找出其中的最大值。", example: "输入:\n5\n3 7 2 9 5\n输出: 9", answer: "#include <stdio.h>\nint main() {\n    int n, arr[100], max;\n    scanf(\"%d\", &n);\n    for(int i = 0; i < n; i++) scanf(\"%d\", &arr[i]);\n    max = arr[0];\n    for(int i = 1; i < n; i++) if(arr[i] > max) max = arr[i];\n    printf(\"%d\\n\", max);\n    return 0;\n}" },
            { category: "函数", difficulty: "中等", title: "判断素数", description: "编写函数判断一个数是否为素数。", example: "输入: 17\n输出: Yes", answer: "#include <stdio.h>\nint isPrime(int n) {\n    if(n < 2) return 0;\n    for(int i = 2; i * i <= n; i++)\n        if(n % i == 0) return 0;\n    return 1;\n}\nint main() {\n    int n;\n    scanf(\"%d\", &n);\n    printf(isPrime(n) ? \"Yes\\n\" : \"No\\n\");\n    return 0;\n}" },
            { category: "递归", difficulty: "中等", title: "斐波那契数列", description: "使用递归计算斐波那契数列的第n项。", example: "输入: 10\n输出: 55", answer: "#include <stdio.h>\nint fib(int n) {\n    if(n <= 2) return 1;\n    return fib(n-1) + fib(n-2);\n}\nint main() {\n    int n;\n    scanf(\"%d\", &n);\n    printf(\"%d\\n\", fib(n));\n    return 0;\n}" },
            { category: "排序", difficulty: "中等", title: "冒泡排序", description: "使用冒泡排序对n个整数进行升序排序。", example: "输入:\n5\n5 2 8 1 9\n输出: 1 2 5 8 9", answer: "#include <stdio.h>\nint main() {\n    int n, arr[100];\n    scanf(\"%d\", &n);\n    for(int i = 0; i < n; i++) scanf(\"%d\", &arr[i]);\n    for(int i = 0; i < n-1; i++)\n        for(int j = 0; j < n-1-i; j++)\n            if(arr[j] > arr[j+1]) {\n                int t = arr[j]; arr[j] = arr[j+1]; arr[j+1] = t;\n            }\n    for(int i = 0; i < n; i++) printf(\"%d \", arr[i]);\n    return 0;\n}" },
            { category: "指针", difficulty: "中等", title: "使用指针交换变量", description: "编写swap函数，使用指针交换两个整数的值。", example: "输入: 5 10\n输出: 10 5", answer: "#include <stdio.h>\nvoid swap(int *a, int *b) {\n    int t = *a; *a = *b; *b = t;\n}\nint main() {\n    int x, y;\n    scanf(\"%d %d\", &x, &y);\n    swap(&x, &y);\n    printf(\"%d %d\\n\", x, y);\n    return 0;\n}" },
            { category: "字符串", difficulty: "中等", title: "字符串反转", description: "输入一个字符串，输出其反转后的结果。", example: "输入: Hello\n输出: olleH", answer: "#include <stdio.h>\n#include <string.h>\nint main() {\n    char s[100];\n    scanf(\"%s\", s);\n    int len = strlen(s);\n    for(int i = 0; i < len/2; i++) {\n        char t = s[i]; s[i] = s[len-1-i]; s[len-1-i] = t;\n    }\n    printf(\"%s\\n\", s);\n    return 0;\n}" },
            { category: "分支结构", difficulty: "简单", title: "成绩等级转换", description: "根据输入的百分制成绩（score），要求输出成绩等级（grade）A、B、C、D、E。90分以上为A，80~89分为B，70~79分为C，60~69分为D，60分以下为E。", example: "输入: 85\n输出: The grade is B.", answer: "#include <stdio.h>\nint main()\n{\n    int score;\n    char grade;\n    printf(\"Please input a score(0~100):\");\n    scanf(\"%d\", &score);\n    if (score >= 90)\n        grade = 'A';\n    else if (score >= 80)\n        grade = 'B';\n    else if (score >= 70)\n        grade = 'C';\n    else if (score >= 60)\n        grade = 'D';\n    else\n        grade = 'E';\n    printf(\"The grade is %c.\\n\", grade);\n    return 0;\n}" },
            { category: "循环与数学", difficulty: "中等", title: "求水仙花数", description: "编写一个程序求所有的“水仙花数”（是指一个三位数，其各位数字的立方和恰好等于该数本身）。", example: "输出: 153\n370\n371\n407", answer: "#include <stdio.h>\nint main()\n{\n    int i, a, b, c;\n    for (i = 100; i <= 999; i++)\n    {\n        a = i / 100;\n        b = i / 10 % 10;\n        c = i % 10;\n        if (i == a * a * a + b * b * b + c * c * c)\n            printf(\"%d\\n\", i);\n    }\n    return 0;\n}" },
            { category: "数组与排序", difficulty: "中等", title: "N个数排序", description: "N个数进行从小到大排序（N由键盘输入）。", example: "输入: 5\n4 2 8 5 1\n输出: 12458", answer: "#include <stdio.h>\nint main()\n{\n    int a[100], i, j, n, t;\n    printf(\"输入所需要排序的数据个数:\\n\");\n    scanf(\"%d\", &n);\n    printf(\"输入所要排序的各个数据:\\n\");\n    for (i = 1; i <= n; i++)\n        scanf(\"%d\", &a[i]);\n    for (i = 1; i <= n - 1; i++)\n        for (j = 1; j <= n - i; j++)\n            if (a[j] > a[j + 1])\n            {\n                t = a[j];\n                a[j] = a[j + 1];\n                a[j + 1] = t;\n            }\n    for (i = 1; i <= n; i++)\n        printf(\"%d\", a[i]);\n    return 0;\n}" },
            { category: "算法与逻辑", difficulty: "中等", title: "求100-200间的素数", description: "求100至200间的全部素数,并把素数按5个一行输出。", example: "输出: 101 103 107 109 113\n...", answer: "#include <stdio.h>\n#include <math.h>\nint main()\n{\n    int m, i, k, n = 0;\n    for (m = 101; m <= 200; m = m + 2)\n    {\n        k = sqrt(m);\n        for (i = 2; i <= k; i++)\n            if (m % i == 0) break;\n        if (i >= k + 1)\n        {\n            printf(\"%d \", m);\n            n = n + 1;\n        }\n        if (n % 5 == 0 && n != 0)\n            printf(\"\\n\");\n    }\n    printf(\"\\n\");\n    return 0;\n}" },
            { category: "函数与循环", difficulty: "中等", title: "数列求和", description: "求s=a+aa+aaa+…+aa…a的和。比如：a=6，m=4则s=6+66+666+6666。", example: "输入: 6 4\n输出: 7404", answer: "#include <stdio.h>\nlong sum(int m, int a);\nint main()\n{\n    long y;\n    int m, a;\n    scanf(\"%d%d\", &a, &m);\n    y = sum(m, a);\n    printf(\"%ld\", y);\n    return 0;\n}\nlong sum(int m, int a)\n{\n    long s = 0, t = 0;\n    int i;\n    for (i = 1; i <= m; i++)\n    {\n        t = t * 10 + a;\n        s = s + t;\n    }\n    return s;\n}" },
            { category: "穷举法", difficulty: "中等", title: "寻找特定四位数", description: "求满足下列条件的四位数：该数是完全平方数；第一、三位数字之和为10，第二、四位数字之积为12。", example: "输出: 满足条件的四位数", answer: "#include <stdio.h>\nint main()\n{\n    int i, j, a, b, c, d;\n    for (i = 32; i <= 99; i++)\n    {\n        j = i * i;\n        a = j / 1000;\n        b = j / 100 - a * 10;\n        c = j / 10 % 10;\n        d = j % 10;\n        if (a + c == 10 && b * d == 12)\n            printf(\" %d \", j);\n    }\n    return 0;\n}" },
            { category: "数学计算", difficulty: "简单", title: "计算三角形面积", description: "输入三角形的三条边a、b、c，计算并输出该三角形的面积area。", example: "输入: 3 4 5\n输出: 6.00", answer: "#include <math.h>\n#include <stdio.h>\nint main()\n{\n    float a, b, c, p, area;\n    printf(\"Input three edges:\");\n    scanf(\"%f%f%f\", &a, &b, &c);\n    p = (a + b + c) / 2;\n    area = sqrt(p * (p - a) * (p - b) * (p - c));\n    printf(\"Three edges are: %.2f, %.2f, %.2f\\n\", a, b, c);\n    printf(\"The area is: %.2f\\n\", area);\n    return 0;\n}" },
            { category: "二维数组", difficulty: "中等", title: "学生成绩统计", description: "有5名学生，3门课程（C语言、英语、高数），编写程序输出每个人的平均分和各科平均分。", example: "输出: 学号 平均分 ...", answer: "#include <stdio.h>\nint main()\n{\n    int a[5][3] = {{70, 65, 81}, {82, 90, 87}, {61, 55, 73}, {72, 88, 91}, {95, 92, 89}};\n    int i, j, s = 0;\n    float student[5], subject[3];\n    for (j = 0; j < 3; j++)\n    {\n        s = 0;\n        for (i = 0; i < 5; i++)\n            s += a[i][j];\n        subject[j] = s / 5.0;\n    }\n    for (i = 0; i < 5; i++)\n    {\n        s = 0;\n        for (j = 0; j < 3; j++)\n            s += a[i][j];\n        student[i] = s / 3.0;\n    }\n    printf(\"学号\\t平均分\\n\");\n    for (i = 0; i < 5; i++)\n        printf(\"%-8d%-8.2f\\n\", i + 1, student[i]);\n    printf(\"C语言\\t英语\\t高数\\n\");\n    for (i = 0; i < 3; i++)\n        printf(\"%-8.2f\", subject[i]);\n    return 0;\n}" },
            { category: "穷举法", difficulty: "中等", title: "百钱买百鸡", description: "鸡翁一值钱五，鸡母一值钱三，鸡雏三值钱一。百钱买百鸡，问鸡翁、鸡母、鸡雏各几何？", example: "输出: 方案列表", answer: "#include <stdio.h>\nint main()\n{\n    int x, y;\n    for (x = 0; x <= 20; x++)\n        for (y = 0; y <= 33; y++)\n            if (5 * x + 3 * y + (100 - x - y) / 3.0 == 100)\n                printf(\"%5d%5d%5d\\n\", x, y, 100 - x - y);\n    return 0;\n}" },
            { category: "循环结构", difficulty: "简单", title: "打印九九乘法表", description: "输出9*9口诀。", example: "输出: 1*1=1 ...", answer: "#include <stdio.h>\nint main()\n{\n    int i, j;\n    for (i = 1; i < 10; i++)\n    {\n        for (j = 1; j <= i; j++)\n            printf(\"%d*%d=%-3d\", i, j, i * j);\n        printf(\"\\n\");\n    }\n    return 0;\n}" },
            { category: "算法与逻辑", difficulty: "中等", title: "斐波那契数列", description: "列举出前n项fibonacci数，要求每显示5项换一行输出，其中n为用户输入值。", example: "输入: 10\n输出: 1 1 2 3 5\n8 13 21 34 55", answer: "#include <stdio.h>\nint main()\n{\n    long f, f1 = 1, f2 = 1;\n    int i, n;\n    printf(\"请输入项数n：\");\n    scanf(\"%d\", &n);\n    printf(\"%-8ld%-8ld\", f1, f2);\n    for (i = 3; i <= n; i++)\n    {\n        f = f1 + f2;\n        f1 = f2;\n        f2 = f;\n        printf(\"%-8ld\", f);\n        if (i % 5 == 0)\n            printf(\"\\n\");\n    }\n    printf(\"\\n\");\n    return 0;\n}" },
            { category: "数组与指针", difficulty: "中等", title: "数组元素反置", description: "编写函数将一维数组元素反置。主函数中输出该数组反置前后的结果。", example: "输出: 原始数组... 转换后数组...", answer: "#include <stdio.h>\nvoid inv(int a[], int n);\nint main()\n{\n    int i, data[10] = {3, 7, 9, 11, 0, 6, 7, 5, 4, 2};\n    printf(\"原始数组:\\n\");\n    for (i = 0; i < 10; i++)\n        printf(\"%d,\", data[i]);\n    printf(\"\\n\");\n    inv(data, 10);\n    printf(\"转换后数组:\\n\");\n    for (i = 0; i < 10; i++)\n        printf(\"%d,\", data[i]);\n    printf(\"\\n\");\n    return 0;\n}\nvoid inv(int a[], int n)\n{\n    int temp, i, m = (n - 1) / 2;\n    int *p1 = a;\n    int *p2 = &a[n - 1];\n    for (i = 0; i <= m; i++)\n    {\n        temp = *p1;\n        *p1++ = *p2;\n        *p2-- = temp;\n    }\n}" },
            { category: "循环与判断", difficulty: "简单", title: "统计正负数个数", description: "从读入的整数数据中,统计大于零的整数个数和小于零的整数个数。输入零结束。", example: "输入: 5 -2 3 0\n输出: i=2,j=1", answer: "#include <stdio.h>\nint main()\n{\n    int n, i, j;\n    printf(\"输入非零的整数(输入零结束程序)\");\n    i = j = 0;\n    scanf(\"%d\", &n);\n    while (n != 0)\n    {\n        if (n > 0)\n            i++;\n        if (n < 0)\n            j++;\n        scanf(\"%d\", &n);\n    }\n    printf(\"i=%d,j=%d\\n\", i, j);\n    return 0;\n}" },
            { category: "字符处理", difficulty: "简单", title: "字符分类统计", description: "输入一行字符（以回车键结束），统计其中英文字符，数字字符和空格字符出现的次数。", example: "输入: A 1 b\n输出: b=1,c=2,d=1", answer: "#include <stdio.h>\nint main()\n{\n    char a;\n    int b, c, d;\n    printf(\"Enter: \");\n    scanf(\"%c\", &a);\n    b = c = d = 0;\n    while (a != '\\n')\n    {\n        if (a >= '0' && a <= '9')\n            b++;\n        if ((a >= 'A' && a <= 'Z') || (a >= 'a' && a <= 'z'))\n            c++;\n        if (a == ' ')\n            d++;\n        scanf(\"%c\", &a);\n    }\n    printf(\"digits=%d, chars=%d, spaces=%d\", b, c, d);\n    return 0;\n}" },
            { category: "字符串处理", difficulty: "中等", title: "单词个数统计", description: "输入一行字符，统计其中单词的个数。", example: "输入: Hello World\n输出: 单词的个数=2", answer: "#include <stdio.h>\nint main()\n{\n    char text[100];\n    int word, i;\n    printf(\"输入一字符串\");\n    gets(text);\n    if (text[0] == ' ')\n        word = 0;\n    else if (text[0] != '\\0')\n        word = 1;\n    i = 1;\n    while (text[i] != '\\0')\n    {\n        if (text[i - 1] == ' ' && text[i] != ' ')\n            word++;\n        i++;\n    }\n    printf(\"单词的个数=%d\\n\", word);\n    return 0;\n}" },
            { category: "数组与统计", difficulty: "简单", title: "竞赛成绩统计", description: "录入10名学生的计算机语言C的竞赛成绩，计算竞赛成绩的最高分，最低分和平均分。", example: "输入: 10个分数\n输出: 最高分... 最低分... 平均分...", answer: "#include <stdio.h>\nint main()\n{\n    int arr[10];\n    int i, sum, max, min;\n    sum = 0;\n    printf(\"请输入十个数:\\n\");\n    for (i = 0; i < 10; i++)\n        scanf(\"%d\", &arr[i]);\n    max = min = arr[0];\n    for (i = 0; i < 10; i++)\n    {\n        if (arr[i] > max)\n            max = arr[i];\n        if (arr[i] < min)\n            min = arr[i];\n        sum += arr[i];\n    }\n    printf(\"最高分=%d 最低分=%d 平均分=%f\\n\", max, min, sum / 10.0);\n    return 0;\n}" }
        ];

        // 程序阅读题
        const readingQuestions = [
    { id: 1, question: "以下程序运行后的输出结果是_______________。", code: "main() \n { \n int a=1,b=2,c=3,d=0; \n\t if(a==1) \n\t\t if(b!=2) \n\t\t\t if(c==3) \n d=1; \n else d=2; \n    \t else \n if(c!=3) \n d=3; \n    \t\t else d=4; \n    else d=5; \n    printf(\"%d\n\",d); \n }", answer: "4", explanation: "程序考察 if-else 的配对关系（就近原则）。<br>1. a==1 为真，进入第一个 if。<br>2. b!=2 (2!=2) 为假，跳过内层 if(c==3)。<br>3. 寻找与 if(b!=2) 配对的 else，进入该 else 分支。<br>4. 判断 c!=3 (3!=3) 为假，进入内层 else。<br>5. 执行 d=4。<br>6. 输出 4。" },
    { id: 2, question: "下列程序的输出结果是____________。", code: "#include <stdio.h>\nmain()\n{\n    int a[4][5]={1,2,4,-4,5,-9,3};\n    int b=0,i,j,i1,j1,n=-9;\n    for (i=0;i<4;i++)\n    {\n         for (j=0;j<5;j++)\n             if (a[i][j]==n)\n             {\n                 i1=i;j1=j;b=1;\n                 break;\n             }\n         if (b)\n             break;\n   }\n   printf(\"%d是第%d个元素\\n\",n,i1*5+j1+1);\n}", answer: "-9是第6个元素", explanation: "程序在二维数组中查找值 -9。数组初始化时按行存储：第一行 {1,2,4,-4,5} (5个)，第二行 {-9,3...}。当 i=1, j=0 时找到 -9。计算位置：i1*5 + j1 + 1 = 1*5 + 0 + 1 = 6。输出“-9是第6个元素”。" },
    { id: 3, question: "下列程序的输出结果是_____________。", code: "#include <stdio.h>\nmain()\n{\n    int i,j,c[3][4];\n    int a[3][4]={{3,5,7,4},{8,3,6,7},{0,9,7,6}};\n    int b[3][4]={{1,6,7,9},{2,8,3,0},{3,4,7,3}};\n    for(i=0;i<3;i++)\n    {\n        for(j=0;j<4;j++)\n        {\n           c[i][j]=a[i][j]+b[i][j];\n           if(j==i) \n              printf(\"%d\",c[i][j]);\n        }\n    }\n}", answer: "41114", explanation: "程序计算矩阵加法，并输出主对角线上的元素（i==j）。<br>1. c[0][0] = 3+1 = 4<br>2. c[1][1] = 3+8 = 11<br>3. c[2][2] = 7+7 = 14<br>无分隔符连接输出，结果为 41114。" },
    { id: 4, question: "以下程序的输出结果是 _______________。", code: "#include <stdio.h>\nvoid swap(int *a,int *b)\n{\n\tint *t;\n\tt=a;a=b;b=t;\n}\nmain()\n{\n\tint i=3,j=5,*p=&i,*q=&j;\n\tswap(p,q);printf(\"%d %d\\n\",*p,*q);\n}", answer: "3 5", explanation: "swap 函数中交换的是形参指针 a 和 b 的指向（即交换了局部变量的地址值），并没有修改 main 函数中实参 p 和 q 指向的变量的值。因此 i 和 j 保持不变，输出 3 5。" },
    { id: 5, question: "下列程序的输出结果是_____________。", code: "#include<stdio.h>\nmain()\n{ \n\tint a=1, b=2;\n\ta=a+b; b=a-b; a=a-b;\n\tprintf(\"%d,%d\\n\", a, b ); \n}", answer: "2,1", explanation: "不借用临时变量交换数值算法：<br>1. a = 1+2 = 3<br>2. b = 3-2 = 1 (原a的值)<br>3. a = 3-1 = 2 (原b的值)<br>输出 2,1。" },
    { id: 6, question: "下列程序的输出结果是_____________。", code: "#include <stdio.h>\nmain()\n{\n    int i,sum=0,a[3][3]={{1,2,3},{4,5,6},{7,8,9}};\n    for(i=0;i<3;i++) \n        sum+=a[i][i]+a[i][3-i-1];\n    printf(\"%d\\n\",sum);\n}", answer: "30", explanation: "程序累加矩阵的主对角线和副对角线元素。<br>i=0: sum += a[0][0](1) + a[0][2](3) = 4<br>i=1: sum += a[1][1](5) + a[1][1](5) = 14<br>i=2: sum += a[2][2](9) + a[2][0](7) = 30<br>结果为 30。" },
    { id: 7, question: "有以下程序,程序运行后的输出结果是_____________。", code: "main()\n{   int s,i;\n    for(s=0,i=1;i<3;i++,s+=i);\n    printf(\"%d\\n\",s);\n}", answer: "5", explanation: "考察 for 循环的执行顺序和逗号表达式。<br>1. Init: s=0, i=1。<br>2. Check: 1<3 (True). Body: 空。<br>3. Post: i++(i变为2), s+=i(s+=2, s=2)。<br>4. Check: 2<3 (True). Body: 空。<br>5. Post: i++(i变为3), s+=i(s+=3, s=5)。<br>6. Check: 3<3 (False). End.<br>输出 5。" },
    { id: 8, question: "下列程序的运行结果是_____________。", code: "int f(int a[ ],int n)\n{\nif(n>1)\nreturn a[0]+f(a+1,n-1);\nelse\nreturn a[0];\n}\nmain()\n{\nint aa[10]={1,2,3,4,5,6,7,8,9,10},s;\ns=f(aa+2,4);\nprintf(\"%d\\n\",s);\n}", answer: "18", explanation: "递归函数 f 计算数组前 n 个元素的和。<br>调用 f(aa+2, 4)，即从 aa[2]=3 开始，计算 4 个元素的和。<br>计算 3 + 4 + 5 + 6 = 18。" },
    { id: 9, question: "有以下程序,程序的运行结果是___________。", code: "void fun(int a, int b)\n{\nint t;\nt=a;\na=b; b=t;\n}\nmain()\n{\nint c[10]={1,2,3,4,5,6,7,8,9,0}, i;\nfor (i=0; i<10; i+=2) fun(c[i], c[i+1]);\nfor (i=0; i<10; i++) printf(\"%d,\", c[i]);\nprintf(\"\\n\");\n}", answer: "1,2,3,4,5,6,7,8,9,0,", explanation: "fun 函数采用值传递（int a, int b），函数内部的交换操作只会影响形参，不会影响 main 函数中的数组 c。因此数组内容保持不变。" },
    { id: 10, question: "下面程序的输出结果是______________。", code: "#define MAX 3\nint a[MAX];\nmain( )\n{ fun1( ); fun2(a);\nprintf(\"\\n\");}\nfun1( )\n{ int k,t=0;\nfor(k=0;k<MAX;k++,t++)\na[k]=t+t;\n}\nfun2(int b[])\n{ int k;\nfor(k=0;k<MAX;k++)printf(\"%d\",*(b+k));\n}", answer: "024", explanation: "a 是全局数组。<br>fun1 中：<br>k=0, t=0 -> a[0] = 0+0 = 0<br>k=1, t=1 -> a[1] = 1+1 = 2<br>k=2, t=2 -> a[2] = 2+2 = 4<br>fun2 输出数组元素，结果 024。" },
    { id: 11, question: "有以下程序,程序运行后的输出结果是_____________。", code: "main()\n{\n\tint t=1,i=5;\n for(;i>=0;i--)  t*=i;\n printf(\"%d\\n\",t);\n}", answer: "0", explanation: "循环变量 i 从 5 递减到 0。当 i=0 时，执行 t *= 0，导致 t 变为 0。后续输出结果自然为 0。" },
    { id: 12, question: "以下程序运行后的输出结果是_______________。", code: "main()\n{\n\tint a=2,b=7,c=5;\n\tswitch(a>0)\n\t{\n\tcase 1: switch(b<0)\n\t          { \n\t            case 1:printf( \" @ \" );break;\n                case 2:printf( \" ! \" );break;\n              }\n\tcase 0: switch(c==5)\n              { \n\t            case 0: printf(\" * \"); break;\n                case 1: printf(\" # \"); break;\n                case 2: printf(\" $ \"); break;\n              }\n\tdefault: printf(\"&\");\n\t}\n\tprintf(\"\\n\");\n}", answer: " # &", explanation: "1. a>0 为真(1)，进入外层 case 1。<br>2. b<0 为假(0)，内层 switch 没有 case 0，不执行任何 print。<br>3. 外层 case 1 没有 break，发生穿透 (fallthrough)，执行 case 0。<br>4. c==5 为真(1)，进入内层 case 1，打印 \" # \"，并 break 内层 switch。<br>5. 外层 case 0 也没有 break，继续穿透到 default。<br>6. 执行 default，打印 \"&\"。<br>最终结果：\" # &\"" },
    { id: 13, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\n#define  N  10\nmain( )\n{\n    int i,a[N]={65,98,38,55,79,45,77,54,88,82};\n    int m=a[0];\n    for(i=0;i<N;i++)\n        if(a[i]<m) m=a[i];\n    printf(\"%d\",m);\n}", answer: "38", explanation: "这是标准的寻找数组最小值的程序。遍历数组，如果发现比当前 m 更小的数则更新 m。数组中最小值为 38。" },
    { id: 14, question: "下列程序的输出结果是_____________", code: "f(int b[ ],int m,int n)\n{\n\tint i,s=0;\n  for(i=m;i<n;i=i+2)  \n\ts=s+b[i];\n  return s;\n}\nmain( )\n{\n\tint x,a[ ]={1,2,3,4,5,6,7,8,9};\n  x=f(a,3,7);\n printf(\"%d\\n\",x);\n}", answer: "10", explanation: "函数 f 从索引 m 开始累加，步长为 2，直到小于 n。<br>调用 f(a, 3, 7):<br>i=3: 加 a[3]=4 (s=4)<br>i=5: 加 a[5]=6 (s=10)<br>i=7: 循环结束。<br>结果返回 10。" },
    { id: 15, question: "有以下程序,程序运行后的输出结果是_____________", code: "main()\n{ int i,m=0,n=0,k=0;\n\tfor(i=9; i<=11;i++)\n\tswitch(i/10)\n\t{ case 0: m++;n++;break;\n\tcase 10: n++; break;\n\tdefault: k++;n++;\n\t}\n\tprintf(\"%d %d %d\\n\",m,n,k);\n}", answer: "1 3 2", explanation: "i=9: 9/10=0。Case 0: m=1, n=1。<br>i=10: 10/10=1。无 Case 1，走 Default: k=1, n=2。<br>i=11: 11/10=1。Default: k=2, n=3。<br>输出：1 3 2。" },
    { id: 16, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\n#define  N  5\nmain( )\n{\n       int i,a[N];\n       for(i=0;i<N;i++)\n              a[i]=i;\n       for(i=N-1;i>0;i--)\n       {\n              if(a[i]%2==0)\n              printf(\"%d\",a[i]);\n       }\n}", answer: "42", explanation: "数组初始化为 {0,1,2,3,4}。<br>反向遍历 i 从 4 到 1 (i>0)：<br>i=4 (4): 偶数，打印 4。<br>i=3 (3): 奇数。<br>i=2 (2): 偶数，打印 2。<br>i=1 (1): 奇数。<br>输出 42。" },
    { id: 17, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>　\n#include <string.h>　\nmain()\n{\n    char arr[2][4];\n    strcpy(arr[0],\"you\");\n    strcpy(arr[1],\"me\");\n    arr[0][3]='&';\n    printf(\"%s \\n\",arr);\n}", answer: "you&me", explanation: "arr[0] 存放 \"you\\0\"。strcpy 也是拷入 \"me\\0\"。二维数组内存是连续的。<br>arr[0][3] 本来是字符串结束符 '\\0'，被改写为 '&'。字符串 arr[0] 失去了结束符，printf 会一直打印直到遇到下一个 '\\0'。<br>紧接 arr[0][3] 的是 arr[1][0] ('m')。<br>因此打印出 \"you&me\"。" },
    { id: 18, question: "有以下程序，输出结果是______________", code: "int fun(int x,int y,int *cp,int *dp)\n{ *cp=x+y; *dp=x-y; }\nmain()\n{ int a, b, c, d;\na=30; b=50;\nfun(a,b,&c,&d);\nprintf(\"%d,%d\\n\",c,d);\n}", answer: "80,-20", explanation: "fun 函数通过指针修改了实参 c 和 d 的值。<br>c = a+b = 30+50 = 80。<br>d = a-b = 30-50 = -20。" },
    { id: 19, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\nmain( )\n{\n    int i,j,t;\n    int a[3][3]={1,2,3,4,5,6,7,8,9};\n    for(i=0;i<2;i++)\n        for(j=i+1;j<3;j++)\n        {\n           t=a[i][j];\n           a[i][j]=a[j][i];\n           a[j][i]=t;\n           printf(\"%d\",a[i][j]);\n        }\n}", answer: "478", explanation: "这是一个矩阵转置的操作，同时打印交换后放入 a[i][j] 的值。<br>1. i=0, j=1: 交换 a[0][1](2) 和 a[1][0](4)。a[0][1] 变为 4。打印 4。<br>2. i=0, j=2: 交换 a[0][2](3) 和 a[2][0](7)。a[0][2] 变为 7。打印 7。<br>3. i=1, j=2: 交换 a[1][2](6) 和 a[2][1](8)。a[1][2] 变为 8。打印 8。<br>结果：478。" },
    { id: 20, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\nmain()\n{\n    char str[]=\"1a2b3c\";\n    int i;\n    for (i=0;str[i]!='\\0';i++)\n         if (str[i]>='0'&&str[i]<='9')\n             printf(\"%c\",str[i]);\n    printf(\"\\n\");\n}", answer: "123", explanation: "遍历字符串，只打印数字字符 ('0'-'9')。字符串中的数字是 1, 2, 3。输出 123。" },
    { id: 21, question: "有以下程序,程序运行后的输出结果是________________", code: "void fun(char *c,int d)\n{*c=*c+1;d=d+1;\nprintf(\"%c,%c,\",*c,d);\n}\nmain()\n{char a='A',b='a';\nfun(&b,a); printf(\"%c,%c\\n\",a,b);\n}", answer: "b,B,A,b", explanation: "fun(&b, a): 形参 c 指向 b ('a')，形参 d 是 a ('A') 的副本。<br>函数内：*c 加 1 变为 'b' (实参 b 被修改)。d 加 1 变为 'B' (实参 a 未受影响)。printf 输出 \"b,B,\"。<br>回到 main：printf 输出 a (仍为 'A') 和 b (已变为 'b')，即 \"A,b\"。<br>总输出：b,B,A,b" },
    { id: 22, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\n#define  N  5\nmain( )\n{\n    int i,j,t,a[N]={1,6,3,5,7};\n    for(i=1;i<=N-1;i++)\n        for(j=0;j<N-i;j++)\n           if(a[j]<a[j+1])\n           {\n               t=a[j];a[j]=a[j+1];a[j+1]=t;\n           }\n    for(j=0;j<N;j++)\n        printf(\"%d\",a[j]);\n}", answer: "76531", explanation: "这是一个冒泡排序，但判断条件是 `if(a[j] < a[j+1])`，即如果前面的数比后面小就交换。这会将小数往后沉，大数往前浮。即**降序排序**。<br>原数组 {1,6,3,5,7} 排序后变为 {7,6,5,3,1}。" },
    { id: 23, question: "设有以下程序: 程序运行后，如果从键盘上输入1298；则输出结果为_____________", code: "main()\n{ int n1,n2;\n\tscanf(\"%d\",&n2);\n\twhile(n2!=0)\n\t{ n1=n2%10;\n\tn2=n2/10;\n\tprintf(\"%d\",n1);\n\t}\n}", answer: "8921", explanation: "程序不断取模(%)得到个位数并打印，然后整除(/)10去掉个位数。<br>输入 1298。<br>1. 打印 8，余 129。<br>2. 打印 9，余 12。<br>3. 打印 2，余 1。<br>4. 打印 1，余 0 (结束)。<br>实现数字倒序输出。" },
    { id: 24, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\nmain( )\n{\n    int i;\n    static int f[10]={1,1};\n    for(i=2;i<10;i++)\n        f[i]=f[i-1]+f[i-2];\n    for(i=0;i<6;i++)\n    {\n        if(f[i]%2==0)\n        printf(\"%d\",f[i]);\n    }\n}", answer: "28", explanation: "计算斐波那契数列前10项：1, 1, 2, 3, 5, 8, 13, 21, 34, 55。<br>循环 i 从 0 到 5 (前6项)：1, 1, 2, 3, 5, 8。<br>打印其中的偶数：2 和 8。<br>输出 28。" },
    { id: 25, question: "有以下程序,程序运行后的输出结果是_____________", code: "main()\n{\n\tint a=4,b=3,c=5,t=0;\n\tif(a<b)t=a;a=b;b=t;\n\tif(a<c)t=a;a=c;c=t;\n\tprintf(\"%d %d %d\\n\",a,b,c);\n}", answer: "5 0 3", explanation: "代码逻辑陷阱：if 语句只包含 `t=a;`，后面的赋值语句在 if 之外。<br>1. Init: a=4, b=3, c=5, t=0。<br>2. if(a<b) (4<3 False): 不执行 t=a (t仍为0)。<br>   执行 a=b -> a=3。<br>   执行 b=t -> b=0。<br>   此时: a=3, b=0, c=5。<br>3. if(a<c) (3<5 True): 执行 t=a -> t=3。<br>   执行 a=c -> a=5。<br>   执行 c=t -> c=3。<br>   此时: a=5, b=0, c=3。<br>输出：5 0 3" },
    { id: 26, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\nmain()\n{\n    int a[4][5]={1,2,4,-4,5,-9,3,6,-3,2,7,8,4};\n    int i,j,n;\n    n=9;\n    i=n/5; \n    j=n-i*5-1;\n    printf(\"第%d个元素(%d,%d)值是%d\\n\",n,i,j,a[i][j]);\n}", answer: "第9个元素(1,3)值是-3", explanation: "1. n=9。<br>2. i = 9/5 = 1。<br>3. j = 9 - 5 - 1 = 3。<br>访问 a[1][3]。<br>数组初始化：<br>Row 0: 1, 2, 4, -4, 5 (索引 0-4)<br>Row 1: -9, 3, 6, -3, 2 (索引 5-9)<br>a[1][3] 是第二行第四个元素，即 -3 (也是展平后的第9个元素，索引8)。<br>输出：第9个元素(1,3)值是-3" },
    { id: 27, question: "下列程序的输出结果是_____________", code: "#include <stdio.h>\nmain( )\n{\n    int i,a[6]={1,2,3,4,5};\n    for(i=0;i<6;i++)\n    {\n        if(i%2!=0)\n        printf(\"%d\",a[i]);\n    }\n}", answer: "240", explanation: "数组初始化为 {1,2,3,4,5,0} (未指定的自动补0)。<br>打印索引为奇数的元素 (i=1, 3, 5)：<br>a[1]=2<br>a[3]=4<br>a[5]=0<br>输出 240。" },
    { id: 28, question: "下列程序的输出结果是_____________", code: "int ff(int n)\n{ \n\tstatic int f=1;\n\tf=f*n;\n\treturn f;\n}\nmain()\n{ \n\tint i;\n\tfor(i=1;i<=5;i++)\n\t\tprintf(\"%d\\n\",ff(i));\n}", answer: "1\n2\n6\n24\n120", explanation: "static 变量 f 在函数调用间保持值（阶乘累积）。<br>i=1: f = 1*1 = 1<br>i=2: f = 1*2 = 2<br>i=3: f = 2*3 = 6<br>i=4: f = 6*4 = 24<br>i=5: f = 24*5 = 120<br>每行输出一个数。" }
    ]

        // ==================== 状态管理 ====================
        let currentChoiceIndex = 0;
        let currentFillIndex = 0;
        let currentBlankIndex = 0;
        let currentProgramIndex = 0;
        let currentReadingIndex = 0;
        let selectedChoiceAnswer = -1;
        let totalScore = 0;
        let apiKey = localStorage.getItem('deepseek_api_key') || 'sk-a3102a4fbc964a72875934ae7d8f5ea0';
        let favorites = JSON.parse(localStorage.getItem('favorites')) || {
            choice: [],
            fill: [],
            blank: [],
            program: [],
            reading: []
        };

        // ==================== 收藏功能 ====================
        
        function saveFavorites() {
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }
        
        function toggleFavorite(pageName, index) {
            const favoritesArray = favorites[pageName] || [];
            const idx = favoritesArray.indexOf(index);
            if (idx > -1) {
                favoritesArray.splice(idx, 1);
            } else {
                favoritesArray.push(index);
            }
            favorites[pageName] = favoritesArray;
            saveFavorites();
            updateFavoriteButton(pageName, index);
        }
        
        function isFavorite(pageName, index) {
            const favoritesArray = favorites[pageName] || [];
            return favoritesArray.indexOf(index) > -1;
        }
        
        function updateFavoriteButton(pageName = null, index = null) {
            const currentPage = document.querySelector('.page.active').id.replace('page-', '');
            const currentIndex = {
                choice: currentChoiceIndex,
                fill: currentFillIndex,
                blank: currentBlankIndex,
                program: currentProgramIndex,
                reading: currentReadingIndex
            }[currentPage];
            
            const btn = document.getElementById(`favorite${currentPage.charAt(0).toUpperCase() + currentPage.slice(1)}Btn`);
            if (btn) {
                const isFav = isFavorite(currentPage, currentIndex);
                btn.innerHTML = isFav ? '<i class="ri-star-fill mr-1 text-yellow-400"></i>已收藏' : '<i class="ri-star-line mr-1"></i>收藏';
                btn.classList.toggle('bg-yellow-500/20', isFav);
                btn.classList.toggle('text-yellow-400', isFav);
            }
        }

        // ==================== 自动补全数据 ====================
        
        // C语言关键字
        const cKeywords = [
            'auto', 'break', 'case', 'char', 'const', 'continue', 'default', 'do',
            'double', 'else', 'enum', 'extern', 'float', 'for', 'goto', 'if',
            'int', 'long', 'register', 'return', 'short', 'signed', 'sizeof', 'static',
            'struct', 'switch', 'typedef', 'union', 'unsigned', 'void', 'volatile', 'while'
        ];
        
        // C语言标准库函数
        const cFunctions = [
            'printf', 'scanf', 'fprintf', 'fscanf', 'sprintf', 'sscanf',
            'getchar', 'putchar', 'gets', 'puts', 'fgets', 'fputs',
            'fopen', 'fclose', 'fread', 'fwrite', 'fseek', 'ftell', 'rewind',
            'malloc', 'calloc', 'realloc', 'free',
            'strlen', 'strcpy', 'strncpy', 'strcat', 'strncat', 'strcmp', 'strncmp', 'strchr', 'strstr',
            'memset', 'memcpy', 'memmove', 'memcmp',
            'atoi', 'atof', 'atol', 'strtol', 'strtod',
            'abs', 'labs', 'fabs', 'sqrt', 'pow', 'sin', 'cos', 'tan', 'log', 'exp',
            'rand', 'srand', 'time', 'clock',
            'exit', 'system', 'getenv',
            'isalpha', 'isdigit', 'isalnum', 'isspace', 'isupper', 'islower', 'toupper', 'tolower',
            'qsort', 'bsearch'
        ];
        
        // 头文件
        const cHeaders = [
            'stdio.h', 'stdlib.h', 'string.h', 'math.h', 'time.h', 'ctype.h',
            'limits.h', 'float.h', 'stdbool.h', 'stdint.h', 'errno.h', 'assert.h'
        ];
        
        // 代码片段
        const cSnippets = {
            'include': { text: '#include <stdio.h>', desc: '包含头文件' },
            'main': { text: 'int main() {\n    \n    return 0;\n}', desc: 'main函数' },
            'for': { text: 'for (int i = 0; i < n; i++) {\n    \n}', desc: 'for循环' },
            'while': { text: 'while (condition) {\n    \n}', desc: 'while循环' },
            'if': { text: 'if (condition) {\n    \n}', desc: 'if语句' },
            'ifelse': { text: 'if (condition) {\n    \n} else {\n    \n}', desc: 'if-else语句' },
            'switch': { text: 'switch (expr) {\n    case 1:\n        break;\n    default:\n        break;\n}', desc: 'switch语句' },
            'struct': { text: 'struct Name {\n    \n};', desc: '结构体定义' },
            'func': { text: 'void functionName() {\n    \n}', desc: '函数定义' },
            'printf': { text: 'printf("\\n");', desc: '格式化输出' },
            'scanf': { text: 'scanf("%d", &var);', desc: '格式化输入' },
            'array': { text: 'int arr[SIZE];', desc: '数组声明' },
            'pointer': { text: 'int *ptr = NULL;', desc: '指针声明' },
            'malloc': { text: 'int *ptr = (int*)malloc(n * sizeof(int));', desc: '动态内存分配' }
        };
        
        // 所有补全项
        function getAllCompletions() {
            const items = [];
            
            // 添加关键字
            cKeywords.forEach(kw => {
                items.push({ type: 'keyword', value: kw, display: kw, desc: 'C关键字', priority: 1 });
            });
            
            // 添加函数
            cFunctions.forEach(fn => {
                items.push({ type: 'function', value: fn, display: fn + '()', desc: '标准库函数', priority: 2 });
            });
            
            // 添加头文件
            cHeaders.forEach(h => {
                items.push({ type: 'header', value: h, display: '<' + h + '>', desc: '头文件', priority: 3 });
            });
            
            // 添加代码片段
            Object.keys(cSnippets).forEach(key => {
                items.push({ type: 'snippet', value: key, display: key, desc: cSnippets[key].desc, snippet: cSnippets[key].text, priority: 4 });
            });
            
            return items;
        }
        
        const allCompletions = getAllCompletions();
        let autocompleteVisible = false;
        let selectedAutocompleteIndex = 0;
        let autocompleteItems = [];
        let currentSuggestion = '';

        // ==================== 语法高亮 ====================
        
        function highlightCode(code) {
            if (!code) return '';
            
            // HTML转义
            let escaped = code
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            
            // 字符串 (需要先处理，避免被其他规则干扰)
            escaped = escaped.replace(/"([^"\\]|\\.)*"/g, '<span class="hl-string">$&</span>');
            escaped = escaped.replace(/'([^'\\]|\\.)*'/g, '<span class="hl-string">$&</span>');
            
            // 单行注释
            escaped = escaped.replace(/(\/\/.*$)/gm, '<span class="hl-comment">$1</span>');
            
            // 多行注释
            escaped = escaped.replace(/(\/\*[\s\S]*?\*\/)/g, '<span class="hl-comment">$1</span>');
            
            // 预处理指令
            escaped = escaped.replace(/(#\s*(?:include|define|ifdef|ifndef|endif|if|else|elif|undef|pragma|error|warning)\b.*$)/gm, '<span class="hl-preprocessor">$1</span>');
            
            // 数字
            escaped = escaped.replace(/\b(\d+\.?\d*[fFlLuU]*)\b/g, '<span class="hl-number">$1</span>');
            escaped = escaped.replace(/\b(0x[0-9a-fA-F]+[lLuU]*)\b/g, '<span class="hl-number">$1</span>');
            
            // 关键字
            const keywordPattern = /\b(auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|union|unsigned|void|volatile|while|NULL|true|false)\b/g;
            escaped = escaped.replace(keywordPattern, '<span class="hl-keyword">$1</span>');
            
            // 类型
            escaped = escaped.replace(/\b(int|char|float|double|void|long|short|unsigned|signed|size_t|FILE)\b(?!\s*\()/g, '<span class="hl-type">$1</span>');
            
            // 函数调用
            escaped = escaped.replace(/\b([a-zA-Z_][a-zA-Z0-9_]*)\s*(?=\()/g, '<span class="hl-function">$1</span>');
            
            // 常量
            escaped = escaped.replace(/\b(NULL|EOF|stdin|stdout|stderr)\b/g, '<span class="hl-constant">$1</span>');
            
            return escaped;
        }
        
        function updateSyntaxHighlight() {
            const textarea = document.getElementById('simCodeInput');
            const highlight = document.getElementById('syntaxHighlight');
            if (!textarea || !highlight) return;
            
            const code = textarea.value;
            highlight.innerHTML = highlightCode(code) + '\n'; // 添加换行确保滚动正常
            
            // 同步滚动
            highlight.scrollTop = textarea.scrollTop;
            highlight.scrollLeft = textarea.scrollLeft;
        }

        // ==================== 页面切换 ====================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            const targetPage = document.getElementById('page-' + pageName);
            if (targetPage) targetPage.classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('bg-white/10'));
            const activeNav = document.getElementById('nav-' + pageName);
            if (activeNav) activeNav.classList.add('bg-white/10');
            
            if (pageName === 'choice') {
                loadChoiceQuestion();
                updateFavoriteButton();
            }
            if (pageName === 'fill') {
                loadFillQuestion();
                updateFavoriteButton();
            }
            if (pageName === 'blank') {
                loadBlankQuestion();
                updateFavoriteButton();
            }
            if (pageName === 'program') {
                loadProgramQuestion();
                updateFavoriteButton();
            }
            if (pageName === 'simulator') initSimulator();
            if (pageName === 'reading') {
                loadReadingQuestion();
                updateFavoriteButton();
            }
            if (pageName === 'favorites') {
                loadFavorites();
            }
            
            window.scrollTo(0, 0);
        }
        
        // ==================== 收藏页面功能 ====================
        
        function loadFavorites() {
            // 清空所有收藏列表
            ['choice', 'fill', 'blank', 'program', 'reading'].forEach(pageName => {
                const listEl = document.getElementById(`${pageName}FavoritesList`);
                const countEl = document.getElementById(`${pageName}FavoritesCount`);
                if (listEl && countEl) {
                    const favoritesArray = favorites[pageName] || [];
                    countEl.textContent = `(${favoritesArray.length}题)`;
                    
                    if (favoritesArray.length === 0) {
                        listEl.innerHTML = '<p class="text-gray-500">暂无收藏题目</p>';
                    } else {
                        listEl.innerHTML = '';
                        favoritesArray.forEach(index => {
                            const question = getQuestion(pageName, index);
                            if (question) {
                                const itemEl = document.createElement('div');
                                itemEl.className = 'bg-black/30 rounded-xl p-4 hover:bg-black/40 transition cursor-pointer';
                                itemEl.addEventListener('click', () => {
                                    showPage(pageName);
                                    setCurrentIndex(pageName, index);
                                });
                                
                                let questionContent = '';
                                if (pageName === 'choice') {
                                    questionContent = question.question;
                                } else if (pageName === 'fill' || pageName === 'program' || pageName === 'reading') {
                                    questionContent = question.question || question.title || '编程题';
                                } else if (pageName === 'blank') {
                                    questionContent = question.question;
                                }
                                
                                itemEl.innerHTML = `
                                    <div class="flex items-center justify-between">
                                        <div class="flex-1">
                                            <p class="font-medium truncate">${questionContent}</p>
                                            <p class="text-sm text-gray-500 mt-1">${getPageTitle(pageName)} · 第${index + 1}题</p>
                                        </div>
                                        <button class="ml-4 p-2 bg-white/10 rounded-lg hover:bg-white/20 transition" onclick="event.stopPropagation(); toggleFavorite('${pageName}', ${index}); loadFavorites();">
                                            <i class="ri-star-fill text-yellow-400"></i>
                                        </button>
                                    </div>
                                `;
                                listEl.appendChild(itemEl);
                            }
                        });
                    }
                }
            });
        }
        
        function getQuestion(pageName, index) {
            const questions = {
                choice: choiceQuestions,
                fill: fillQuestions,
                blank: blankQuestions,
                program: programQuestions,
                reading: readingQuestions
            }[pageName] || [];
            return questions[index];
        }
        
        function setCurrentIndex(pageName, index) {
            switch(pageName) {
                case 'choice': currentChoiceIndex = index; break;
                case 'fill': currentFillIndex = index; break;
                case 'blank': currentBlankIndex = index; break;
                case 'program': currentProgramIndex = index; break;
                case 'reading': currentReadingIndex = index; break;
            }
        }
        
        function getPageTitle(pageName) {
            const titles = {
                choice: '选择题',
                fill: '程序填空题',
                blank: '填空题',
                program: '编程题',
                reading: '程序阅读题'
            };
            return titles[pageName] || pageName;
        }

        // ==================== 程序阅读题功能 ====================
        
        function loadReadingQuestion() {
            const q = readingQuestions[currentReadingIndex];
            document.getElementById('readingCurrentNum').textContent = currentReadingIndex + 1;
            document.getElementById('readingTotalNum').textContent = readingQuestions.length;
            document.getElementById('readingProgress').style.width = ((currentReadingIndex + 1) / readingQuestions.length * 100) + '%';
            
            document.getElementById('readingQuestionText').textContent = q.question;
            document.getElementById('readingCode').textContent = q.code;
            document.getElementById('readingAnswer').value = '';
            
            document.getElementById('readingResult').style.display = 'none';
            document.getElementById('readingAiSection').style.display = 'none';
        }
        
        function checkReadingAnswer() {
            const answer = document.getElementById('readingAnswer').value.trim();
            if (!answer) {
                alert('请先输入答案！');
                return;
            }
            
            const q = readingQuestions[currentReadingIndex];
            const resultDiv = document.getElementById('readingResult');
            resultDiv.style.display = 'block';
            
            const isCorrect = answer === q.answer;
            
            if (isCorrect) {
                resultDiv.innerHTML = '<div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center"><i class="ri-check-line text-2xl text-green-400"></i></div><span class="text-xl font-bold text-green-400">答案正确！</span></div>';
                totalScore += 15;
                document.getElementById('totalScore').textContent = totalScore;
            } else {
                resultDiv.innerHTML = '<div class="flex items-center gap-3 mb-4"><div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center"><i class="ri-close-line text-2xl text-red-400"></i></div><span class="text-xl font-bold text-red-400">答案错误</span></div><div class="text-gray-300">正确答案：<span class="text-green-400 font-bold">' + q.answer + '</span></div>';
            }
        }
        
        function showRandomReadingQuestion() {
            currentReadingIndex = Math.floor(Math.random() * readingQuestions.length);
            loadReadingQuestion();
        }
        
        function nextReadingQuestion() {
            if (currentReadingIndex < readingQuestions.length - 1) {
                currentReadingIndex++;
                loadReadingQuestion();
            }
        }
        
        function prevReadingQuestion() {
            if (currentReadingIndex > 0) {
                currentReadingIndex--;
                loadReadingQuestion();
            }
        }

        // ==================== 填空题功能 ====================
        function loadBlankQuestion() {
            // 如果填空题数组为空，显示提示
            if (blankQuestions.length === 0) {
                document.getElementById('blankQuestionText').textContent = '暂无题目，请稍后添加';
                document.getElementById('blankInputs').innerHTML = '<p class="text-gray-400">题目正在添加中...</p>';
                document.getElementById('blankCurrentNum').textContent = '0';
                document.getElementById('blankTotalNum').textContent = '0';
                document.getElementById('blankProgress').style.width = '0%';
                return;
            }
            
            const q = blankQuestions[currentBlankIndex];
            document.getElementById('blankCurrentNum').textContent = currentBlankIndex + 1;
            document.getElementById('blankTotalNum').textContent = blankQuestions.length;
            document.getElementById('blankProgress').style.width = ((currentBlankIndex + 1) / blankQuestions.length * 100) + '%';
            document.getElementById('blankCategory').textContent = q.category || '基础概念';
            document.getElementById('blankQuestionText').textContent = q.question;
            
            const symbols = ['①', '②', '③', '④', '⑤'];
            let inputsHtml = '';
            q.blanks.forEach((_, i) => {
                inputsHtml += `<div class="flex items-center gap-4"><span class="w-8 h-8 rounded-lg bg-blue-500/20 text-blue-400 flex items-center justify-center font-bold">${symbols[i]}</span><input type="text" id="blankInput${i}" class="flex-1 px-4 py-3 bg-black/30 rounded-xl border border-white/10 focus:border-blue-500 focus:outline-none code-font" placeholder="填写第${i+1}空的答案"></div>`;
            });
            document.getElementById('blankInputs').innerHTML = inputsHtml;
            
            document.getElementById('blankResult').style.display = 'none';
            document.getElementById('blankAiSection').style.display = 'none';
        }

        function checkBlankAnswer() {
            if (blankQuestions.length === 0) {
                alert('暂无题目可答！');
                return;
            }
            
            const q = blankQuestions[currentBlankIndex];
            let allCorrect = true;
            let results = [];
            
            q.blanks.forEach((answer, i) => {
                const input = document.getElementById('blankInput' + i);
                const userAnswer = input.value.trim();
                const isCorrect = userAnswer === answer;
                results.push({ userAnswer, correctAnswer: answer, isCorrect });
                
                input.classList.remove('border-red-500', 'border-green-500');
                input.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                if (!isCorrect) allCorrect = false;
            });
            
            const resultDiv = document.getElementById('blankResult');
            resultDiv.style.display = 'block';
            
            if (allCorrect) {
                totalScore += 15;
                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('blankResultHeader').innerHTML = '<div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center"><i class="ri-check-line text-2xl text-green-400"></i></div><span class="text-xl font-bold text-green-400">全部正确！+15分</span>';
            } else {
                let resultsText = results.map((r, i) => `空${i+1}: 你的答案"${r.userAnswer || '(空)'}" ${r.isCorrect ? '✓' : '✗ 正确答案: ' + r.correctAnswer}`).join('<br>');
                document.getElementById('blankResultHeader').innerHTML = '<div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center"><i class="ri-close-line text-2xl text-red-400"></i></div><span class="text-xl font-bold text-red-400">部分错误</span>';
                document.getElementById('blankExplanation').innerHTML = resultsText;
            }
            document.getElementById('blankExplanation').innerHTML += '<br><br><strong>解析：</strong>' + q.explanation;
        }

        function showRandomBlankQuestion() {
            if (blankQuestions.length > 0) {
                currentBlankIndex = Math.floor(Math.random() * blankQuestions.length);
                loadBlankQuestion();
            }
        }

        function nextBlankQuestion() {
            if (currentBlankIndex < blankQuestions.length - 1) {
                currentBlankIndex++;
                loadBlankQuestion();
            }
        }

        function prevBlankQuestion() {
            if (currentBlankIndex > 0) {
                currentBlankIndex--;
                loadBlankQuestion();
            }
        }

        // ==================== 选择题功能 ====================
        function loadChoiceQuestion() {
            const q = choiceQuestions[currentChoiceIndex];
            document.getElementById('choiceCurrentNum').textContent = currentChoiceIndex + 1;
            document.getElementById('choiceTotalNum').textContent = choiceQuestions.length;
            document.getElementById('choiceProgress').style.width = ((currentChoiceIndex + 1) / choiceQuestions.length * 100) + '%';
            document.getElementById('choiceCategory').textContent = q.category;
            document.getElementById('choiceDifficulty').textContent = q.difficulty;
            document.getElementById('choiceQuestionText').textContent = q.question;
            
            let optionsHtml = '';
            q.options.forEach((opt, i) => {
                optionsHtml += `<div class="option-card p-4 rounded-xl border border-white/10 cursor-pointer hover:border-indigo-500/50 transition bg-black/20" data-index="${i}">
                    <div class="flex items-center gap-3">
                    <span class="w-8 h-8 rounded-lg bg-white/10 flex items-center justify-center font-semibold">${String.fromCharCode(65 + i)}</span>
                    <span>${opt}</span>
                    </div></div>`;
            });
            document.getElementById('choiceOptions').innerHTML = optionsHtml;
            
            document.querySelectorAll('.option-card').forEach(card => {
                card.addEventListener('click', function() {
                    selectChoiceOption(parseInt(this.dataset.index));
                });
            });
            
            document.getElementById('choiceResult').style.display = 'none';
            document.getElementById('choiceAiSection').style.display = 'none';
            selectedChoiceAnswer = -1;
        }

        function selectChoiceOption(index) {
            selectedChoiceAnswer = index;
            document.querySelectorAll('.option-card').forEach((card, i) => {
                card.classList.remove('border-indigo-500', 'bg-indigo-500/20');
                if (i === index) card.classList.add('border-indigo-500', 'bg-indigo-500/20');
            });
        }

        function checkChoiceAnswer() {
            if (selectedChoiceAnswer === -1) {
                alert('请先选择一个答案！');
                return;
            }
            const q = choiceQuestions[currentChoiceIndex];
            const isCorrect = selectedChoiceAnswer === q.answer;
            
            const resultDiv = document.getElementById('choiceResult');
            resultDiv.style.display = 'block';
            
            if (isCorrect) {
                totalScore += 10;
                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('choiceResultHeader').innerHTML = '<div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center"><i class="ri-check-line text-2xl text-green-400"></i></div><span class="text-xl font-bold text-green-400">回答正确！+10分</span>';
                resultDiv.className = 'card-gradient rounded-2xl p-6 border border-green-500/30 mb-6 glow-green';
            } else {
                document.getElementById('choiceResultHeader').innerHTML = `<div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center"><i class="ri-close-line text-2xl text-red-400"></i></div><span class="text-xl font-bold text-red-400">回答错误</span><span class="text-gray-400">正确答案: ${String.fromCharCode(65 + q.answer)}</span>`;
                resultDiv.className = 'card-gradient rounded-2xl p-6 border border-red-500/30 mb-6 glow-red';
            }
            document.getElementById('choiceExplanation').innerHTML = '<strong>解析：</strong>' + q.explanation;
            
            document.querySelectorAll('.option-card').forEach((card, i) => {
                card.classList.remove('border-indigo-500', 'bg-indigo-500/20');
                if (i === q.answer) card.classList.add('border-green-500', 'bg-green-500/20');
                else if (i === selectedChoiceAnswer && !isCorrect) card.classList.add('border-red-500', 'bg-red-500/20');
            });
        }

        // ==================== 填空题功能 ====================
        function loadFillQuestion() {
            const q = fillQuestions[currentFillIndex];
            document.getElementById('fillCurrentNum').textContent = currentFillIndex + 1;
            document.getElementById('fillTotalNum').textContent = fillQuestions.length;
            document.getElementById('fillProgress').style.width = ((currentFillIndex + 1) / fillQuestions.length * 100) + '%';
            document.getElementById('fillCategory').textContent = q.category;
            document.getElementById('fillQuestionText').textContent = q.question;
            
            let codeHtml = highlightCode(q.code)
                .replace(/___①___/g, '<span class="bg-yellow-500/30 px-2 py-1 rounded text-yellow-300">___①___</span>')
                .replace(/___②___/g, '<span class="bg-yellow-500/30 px-2 py-1 rounded text-yellow-300">___②___</span>');
            document.getElementById('fillCode').innerHTML = codeHtml;
            
            const symbols = ['①', '②', '③', '④', '⑤'];
            let inputsHtml = '';
            q.blanks.forEach((_, i) => {
                inputsHtml += `<div class="flex items-center gap-4"><span class="w-8 h-8 rounded-lg bg-yellow-500/20 text-yellow-400 flex items-center justify-center font-bold">${symbols[i]}</span><input type="text" id="fillInput${i}" class="flex-1 px-4 py-3 bg-black/30 rounded-xl border border-white/10 focus:border-yellow-500 focus:outline-none code-font" placeholder="填写第${i+1}空的答案"></div>`;
            });
            document.getElementById('fillInputs').innerHTML = inputsHtml;
            
            document.getElementById('fillResult').style.display = 'none';
            document.getElementById('fillAiSection').style.display = 'none';
        }

        function checkFillAnswer() {
            const q = fillQuestions[currentFillIndex];
            let allCorrect = true;
            let results = [];
            
            q.blanks.forEach((answer, i) => {
                const input = document.getElementById('fillInput' + i);
                const userAnswer = input.value.trim();
                const isCorrect = userAnswer === answer;
                results.push({ userAnswer, correctAnswer: answer, isCorrect });
                
                input.classList.remove('border-red-500', 'border-green-500');
                input.classList.add(isCorrect ? 'border-green-500' : 'border-red-500');
                if (!isCorrect) allCorrect = false;
            });
            
            const resultDiv = document.getElementById('fillResult');
            resultDiv.style.display = 'block';
            
            if (allCorrect) {
                totalScore += 15;
                document.getElementById('totalScore').textContent = totalScore;
                document.getElementById('fillResultHeader').innerHTML = '<div class="w-10 h-10 bg-green-500/20 rounded-xl flex items-center justify-center"><i class="ri-check-line text-2xl text-green-400"></i></div><span class="text-xl font-bold text-green-400">全部正确！+15分</span>';
            } else {
                let resultsText = results.map((r, i) => `空${i+1}: 你的答案"${r.userAnswer || '(空)'}" ${r.isCorrect ? '✓' : '✗ 正确答案: ' + r.correctAnswer}`).join('<br>');
                document.getElementById('fillResultHeader').innerHTML = '<div class="w-10 h-10 bg-red-500/20 rounded-xl flex items-center justify-center"><i class="ri-close-line text-2xl text-red-400"></i></div><span class="text-xl font-bold text-red-400">部分错误</span>';
                document.getElementById('fillExplanation').innerHTML = resultsText;
            }
            document.getElementById('fillExplanation').innerHTML += '<br><br><strong>解析：</strong>' + q.explanation;
        }

        // ==================== 编程题功能 ====================
        function loadProgramQuestion() {
            const q = programQuestions[currentProgramIndex];
            document.getElementById('programCurrentNum').textContent = currentProgramIndex + 1;
            document.getElementById('programTotalNum').textContent = programQuestions.length;
            document.getElementById('programCategory').textContent = q.category;
            document.getElementById('programDifficulty').textContent = q.difficulty;
            document.getElementById('programTitle').textContent = q.title;
            document.getElementById('programDescription').textContent = q.description;
            document.getElementById('programExample').textContent = q.example;
            
            document.getElementById('programCodeInput').value = '#include <stdio.h>\n\nint main() {\n    // 在这里编写你的代码\n    \n    return 0;\n}';
            document.getElementById('programInput').value = '';
            updateProgramLineNumbers();
            
            document.getElementById('programOutput').style.display = 'none';
            document.getElementById('programAiSection').style.display = 'none';
        }

        function updateProgramLineNumbers() {
            const textarea = document.getElementById('programCodeInput');
            const lineNumbers = document.getElementById('programLineNumbers');
            if (!textarea || !lineNumbers) return;
            
            const lines = (textarea.value || '').split('\n').length || 1;
            lineNumbers.innerHTML = Array.from({length: lines}, (_, i) => `<div class="leading-6">${i + 1}</div>`).join('');
        }

        function showProgramAnswer() {
            const q = programQuestions[currentProgramIndex];
            document.getElementById('programCodeInput').value = q.answer;
            updateProgramLineNumbers();
        }

        // ==================== 模拟器功能 ====================
        
        function initSimulator() {
            updateSimLineNumbers();
            updateSyntaxHighlight();
            setupCodeEditor();
        }
        
        function setupCodeEditor() {
            const textarea = document.getElementById('simCodeInput');
            if (!textarea || textarea.dataset.initialized) return;
            textarea.dataset.initialized = 'true';
            
            let predictionTimer = null;
            
            // 输入事件
            textarea.addEventListener('input', function() {
                updateSimLineNumbers();
                updateSyntaxHighlight();
                showAutocomplete(this);
                
                // 重置预测定时器
                if (predictionTimer) {
                    clearTimeout(predictionTimer);
                }
                
                // 3秒无输入后自动预测
                predictionTimer = setTimeout(() => {
                    predictNextCode(this);
                }, 3000);
            });
            
            // 键盘事件
            textarea.addEventListener('keydown', function(e) {
                handleKeyDown(e, this);
            });
            
            // 滚动同步
            textarea.addEventListener('scroll', function() {
                const lineNumbers = document.getElementById('simLineNumbers');
                const highlight = document.getElementById('syntaxHighlight');
                if (lineNumbers) lineNumbers.scrollTop = this.scrollTop;
                if (highlight) {
                    highlight.scrollTop = this.scrollTop;
                    highlight.scrollLeft = this.scrollLeft;
                }
            });
            
            // 点击隐藏菜单
            textarea.addEventListener('click', hideAutocomplete);
            textarea.addEventListener('blur', () => setTimeout(hideAutocomplete, 150));
        }
        
        function handleKeyDown(e, textarea) {
            const { selectionStart, selectionEnd, value } = textarea;
            
            // Ctrl+Enter - 编译运行
            if (e.key === 'Enter' && e.ctrlKey) {
                e.preventDefault();
                runWithAI();
                return;
            }
            
            // Tab - 补全
            if (e.key === 'Tab' && !e.ctrlKey) {
                e.preventDefault();
                
                if (currentSuggestion) {
                    insertText(textarea, currentSuggestion);
                    hideAiSuggestion();
                    currentSuggestion = '';
                    return;
                }
                
                if (autocompleteVisible && autocompleteItems.length > 0) {
                    applyAutocomplete(textarea, autocompleteItems[selectedAutocompleteIndex]);
                    return;
                }
                
                // 尝试补全当前单词
                const textBefore = value.substring(0, selectionStart);
                const match = textBefore.match(/([a-zA-Z_#][a-zA-Z0-9_.]*)$/);
                if (match) {
                    const word = match[1];
                    const filtered = allCompletions.filter(c => 
                        c.value.toLowerCase().startsWith(word.toLowerCase()) && c.value !== word
                    ).sort((a, b) => a.priority - b.priority);
                    
                    if (filtered.length > 0) {
                        applyAutocomplete(textarea, filtered[0]);
                        return;
                    }
                }
                
                insertText(textarea, '    ');
                return;
            }
            
            // Shift+Tab - AI预测
            if (e.key === 'Tab' && e.shiftKey) {
                e.preventDefault();
                predictNextCode(textarea);
                return;
            }
            
            // Enter - 自动缩进
            if (e.key === 'Enter' && !autocompleteVisible) {
                e.preventDefault();
                handleEnterKey(textarea);
                return;
            }
            
            // 自动补全菜单导航
            if (autocompleteVisible) {
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    selectedAutocompleteIndex = Math.min(selectedAutocompleteIndex + 1, autocompleteItems.length - 1);
                    updateAutocompleteSelection();
                    return;
                }
                if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    selectedAutocompleteIndex = Math.max(selectedAutocompleteIndex - 1, 0);
                    updateAutocompleteSelection();
                    return;
                }
                if (e.key === 'Enter') {
                    e.preventDefault();
                    applyAutocomplete(textarea, autocompleteItems[selectedAutocompleteIndex]);
                    return;
                }
                if (e.key === 'Escape') {
                    hideAutocomplete();
                    return;
                }
            }
            
            // Ctrl+/ - 注释
            if (e.key === '/' && e.ctrlKey) {
                e.preventDefault();
                toggleComment(textarea);
                return;
            }
            
            // 自动补全括号
            const pairs = { '(': ')', '[': ']', '{': '}', '"': '"', "'": "'" };
            if (pairs[e.key] && selectionStart === selectionEnd) {
                e.preventDefault();
                textarea.value = value.substring(0, selectionStart) + e.key + pairs[e.key] + value.substring(selectionEnd);
                textarea.setSelectionRange(selectionStart + 1, selectionStart + 1);
                updateSimLineNumbers();
                updateSyntaxHighlight();
                return;
            }
        }
        
        function handleEnterKey(textarea) {
            const { selectionStart, value } = textarea;
            const lineStart = value.lastIndexOf('\n', selectionStart - 1) + 1;
            const currentLine = value.substring(lineStart, selectionStart);
            let indent = currentLine.match(/^(\s*)/)[1] || '';
            
            const charBefore = value[selectionStart - 1];
            const charAfter = value[selectionStart];
            
            let newText = '\n' + indent;
            
            if (charBefore === '{') {
                if (charAfter === '}') {
                    newText = '\n' + indent + '    \n' + indent;
                    textarea.value = value.substring(0, selectionStart) + newText + value.substring(selectionStart);
                    textarea.setSelectionRange(selectionStart + indent.length + 5, selectionStart + indent.length + 5);
                } else {
                    newText = '\n' + indent + '    ';
                    textarea.value = value.substring(0, selectionStart) + newText + value.substring(selectionStart);
                    textarea.setSelectionRange(selectionStart + newText.length, selectionStart + newText.length);
                }
            } else {
                textarea.value = value.substring(0, selectionStart) + newText + value.substring(selectionStart);
                textarea.setSelectionRange(selectionStart + newText.length, selectionStart + newText.length);
            }
            
            updateSimLineNumbers();
            updateSyntaxHighlight();
        }
        
        function insertText(textarea, text) {
            const { selectionStart, selectionEnd, value } = textarea;
            textarea.value = value.substring(0, selectionStart) + text + value.substring(selectionEnd);
            const newPos = selectionStart + text.length;
            textarea.setSelectionRange(newPos, newPos);
            textarea.focus();
            updateSimLineNumbers();
            updateSyntaxHighlight();
        }
        
        function showAutocomplete(textarea) {
            const { selectionStart, value } = textarea;
            const textBefore = value.substring(0, selectionStart);
            
            // 检查是否在#include后输入头文件
            const includeMatch = textBefore.match(/#include\s*<([a-zA-Z_.]*)$/);
            if (includeMatch) {
                const prefix = includeMatch[1].toLowerCase();
                autocompleteItems = cHeaders
                    .filter(h => h.toLowerCase().startsWith(prefix))
                    .map(h => ({ type: 'header', value: h, display: '<' + h + '>', desc: '头文件' }));
                
                if (autocompleteItems.length > 0) {
                    showAutocompleteMenu(textarea);
                    return;
                }
            }
            
            // 普通单词补全
            const match = textBefore.match(/([a-zA-Z_#][a-zA-Z0-9_]*)$/);
            if (!match || match[1].length < 1) {
                hideAutocomplete();
                return;
            }
            
            const word = match[1].toLowerCase();
            autocompleteItems = allCompletions
                .filter(c => c.value.toLowerCase().startsWith(word) && c.value.toLowerCase() !== word)
                .sort((a, b) => a.priority - b.priority)
                .slice(0, 10);
            
            if (autocompleteItems.length === 0) {
                hideAutocomplete();
                return;
            }
            
            showAutocompleteMenu(textarea);
        }
        
        function showAutocompleteMenu(textarea) {
            selectedAutocompleteIndex = 0;
            
            const menu = document.getElementById('autocompleteMenu');
            menu.innerHTML = autocompleteItems.map((item, i) => {
                let icon = 'K', iconClass = 'bg-blue-500/30 text-blue-400';
                if (item.type === 'function') { icon = 'F'; iconClass = 'bg-purple-500/30 text-purple-400'; }
                else if (item.type === 'header') { icon = 'H'; iconClass = 'bg-green-500/30 text-green-400'; }
                else if (item.type === 'snippet') { icon = 'S'; iconClass = 'bg-yellow-500/30 text-yellow-400'; }
                
                return `<div class="autocomplete-item px-3 py-2 cursor-pointer flex items-center gap-2 ${i === 0 ? 'selected' : ''}" data-index="${i}">
                    <span class="w-5 h-5 rounded text-xs flex items-center justify-center flex-shrink-0 ${iconClass}">${icon}</span>
                    <span class="text-sm text-white font-medium">${item.display}</span>
                    <span class="text-xs text-gray-500 ml-auto">${item.desc}</span>
                </div>`;
            }).join('');
            
            menu.querySelectorAll('.autocomplete-item').forEach(el => {
                el.addEventListener('mousedown', function(e) {
                    e.preventDefault();
                    applyAutocomplete(textarea, autocompleteItems[parseInt(this.dataset.index)]);
                });
            });
            
            // 定位菜单
            const lines = textarea.value.substring(0, textarea.selectionStart).split('\n');
            const top = Math.min(lines.length * 24, 300);
            const left = Math.min(50 + lines[lines.length - 1].length * 8, 400);
            menu.style.top = top + 'px';
            menu.style.left = left + 'px';
            
            menu.classList.remove('hidden');
            autocompleteVisible = true;
        }
        
        function hideAutocomplete() {
            const menu = document.getElementById('autocompleteMenu');
            if (menu) menu.classList.add('hidden');
            autocompleteVisible = false;
        }
        
        function updateAutocompleteSelection() {
            const menu = document.getElementById('autocompleteMenu');
            menu.querySelectorAll('.autocomplete-item').forEach((el, i) => {
                el.classList.toggle('selected', i === selectedAutocompleteIndex);
                if (i === selectedAutocompleteIndex) el.scrollIntoView({ block: 'nearest' });
            });
        }
        
        function applyAutocomplete(textarea, item) {
            const { selectionStart, value } = textarea;
            const textBefore = value.substring(0, selectionStart);
            
            // 处理头文件补全
            const includeMatch = textBefore.match(/#include\s*<([a-zA-Z_.]*)$/);
            if (includeMatch) {
                const beforeMatch = value.substring(0, selectionStart - includeMatch[1].length);
                const afterCursor = value.substring(selectionStart);
                const insertValue = item.value + '>';
                textarea.value = beforeMatch + insertValue + afterCursor;
                const newPos = beforeMatch.length + insertValue.length;
                textarea.setSelectionRange(newPos, newPos);
            } else {
                // 普通补全
                const match = textBefore.match(/([a-zA-Z_#][a-zA-Z0-9_]*)$/);
                const currentWord = match ? match[1] : '';
                const beforeWord = value.substring(0, selectionStart - currentWord.length);
                const afterCursor = value.substring(selectionStart);
                
                let insertValue = item.snippet || item.value;
                
                // 处理代码片段缩进
                if (item.snippet) {
                    const lineStart = value.lastIndexOf('\n', selectionStart - 1) + 1;
                    const currentLine = value.substring(lineStart, selectionStart);
                    const indent = currentLine.match(/^(\s*)/)[1] || '';
                    insertValue = item.snippet.split('\n').map((line, i) => i === 0 ? line : indent + line).join('\n');
                }
                
                textarea.value = beforeWord + insertValue + afterCursor;
                const newPos = beforeWord.length + insertValue.length;
                textarea.setSelectionRange(newPos, newPos);
            }
            
            textarea.focus();
            hideAutocomplete();
            updateSimLineNumbers();
            updateSyntaxHighlight();
        }
        
        function toggleComment(textarea) {
            const { selectionStart, selectionEnd, value } = textarea;
            const lineStart = value.lastIndexOf('\n', selectionStart - 1) + 1;
            const lineEnd = value.indexOf('\n', selectionEnd);
            const actualLineEnd = lineEnd === -1 ? value.length : lineEnd;
            const line = value.substring(lineStart, actualLineEnd);
            
            let newLine = line.trimStart().startsWith('//')
                ? line.replace(/^(\s*)\/\/\s?/, '$1')
                : line.replace(/^(\s*)/, '$1// ');
            
            textarea.value = value.substring(0, lineStart) + newLine + value.substring(actualLineEnd);
            textarea.setSelectionRange(lineStart, lineStart + newLine.length);
            updateSimLineNumbers();
            updateSyntaxHighlight();
        }
        
        function updateSimLineNumbers() {
            const textarea = document.getElementById('simCodeInput');
            const lineNumbers = document.getElementById('simLineNumbers');
            if (!textarea || !lineNumbers) return;
            
            const lines = (textarea.value || '').split('\n').length || 1;
            lineNumbers.innerHTML = Array.from({length: lines}, (_, i) => `<div class="leading-6">${i + 1}</div>`).join('');
        }
        
        // ==================== AI功能 ====================
        
        async function runWithAI() {
            const code = document.getElementById('simCodeInput').value;
            const input = document.getElementById('simInput').value;
            
            if (!code.trim()) {
                alert('请先输入代码！');
                return;
            }
            

            
            const output = document.getElementById('simOutput');
            const status = document.getElementById('compileStatus');
            const outputStatus = document.getElementById('outputStatus');
            
            status.innerHTML = '<span class="text-yellow-400 compiling"><i class="ri-loader-4-line"></i> 编译中...</span>';
            output.innerHTML = '<span class="text-gray-400">正在编译并运行代码...</span>';
            
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + apiKey
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { 
                                role: 'system', 
                                content: `你是一个C语言编译器和运行时模拟器。请分析用户的C代码，模拟编译和运行过程。

如果代码有语法错误，请返回类似GCC的错误信息，格式如下：
main.c:行号:列号: error: 错误描述

如果代码有警告，格式如下：
main.c:行号:列号: warning: 警告描述

如果代码正确，请模拟运行并返回输出结果。
对于scanf输入，使用用户提供的stdin数据。

请用JSON格式返回结果：
{
  "success": true或false,
  "errors": ["错误信息数组"],
  "warnings": ["警告信息数组"],
  "output": "程序输出结果",
  "returnCode": 返回码数字
}

只返回JSON，不要其他内容。` 
                            },
                            { 
                                role: 'user', 
                                content: `C代码:\n\`\`\`c\n${code}\n\`\`\`\n\nstdin输入:\n${input || '(无输入)'}`
                            }
                        ],
                        stream: false
                    })
                });
                
                const data = await response.json();
                
                if (data.choices && data.choices[0]) {
                    let content = data.choices[0].message.content.trim();
                    // 尝试解析JSON
                    try {
                        // 移除可能的markdown代码块
                        content = content.replace(/^```json?\n?/i, '').replace(/\n?```$/i, '');
                        const result = JSON.parse(content);
                        
                        let html = '';
                        
                        // 显示错误
                        if (result.errors && result.errors.length > 0) {
                            html += '<div class="error-log p-3 rounded mb-2">';
                            html += '<div class="text-red-400 font-bold mb-1"><i class="ri-error-warning-line mr-1"></i>编译错误</div>';
                            result.errors.forEach(err => {
                                html += `<div class="text-red-300 text-sm">${escapeHtml(err)}</div>`;
                            });
                            html += '</div>';
                            status.innerHTML = '<span class="text-red-400"><i class="ri-close-circle-line"></i> 编译失败</span>';
                            outputStatus.innerHTML = '<span class="text-red-400">Error</span>';
                        }
                        
                        // 显示警告
                        if (result.warnings && result.warnings.length > 0) {
                            html += '<div class="warning-log p-3 rounded mb-2">';
                            html += '<div class="text-yellow-400 font-bold mb-1"><i class="ri-alert-line mr-1"></i>警告</div>';
                            result.warnings.forEach(warn => {
                                html += `<div class="text-yellow-300 text-sm">${escapeHtml(warn)}</div>`;
                            });
                            html += '</div>';
                        }
                        
                        // 显示输出
                        if (result.success && result.output !== undefined) {
                            html += '<div class="success-log p-3 rounded">';
                            html += '<div class="text-green-400 font-bold mb-1"><i class="ri-checkbox-circle-line mr-1"></i>程序输出</div>';
                            html += `<pre class="text-green-300 whitespace-pre-wrap">${escapeHtml(result.output)}</pre>`;
                            if (result.returnCode !== undefined) {
                                html += `<div class="text-gray-500 text-xs mt-2">返回码: ${result.returnCode}</div>`;
                            }
                            html += '</div>';
                            status.innerHTML = '<span class="text-green-400"><i class="ri-checkbox-circle-line"></i> 运行成功</span>';
                            outputStatus.innerHTML = '<span class="text-green-400">Success</span>';
                        }
                        
                        output.innerHTML = html || '<span class="text-gray-400">无输出</span>';
                        
                    } catch (e) {
                        // 如果不是JSON，直接显示
                        output.innerHTML = `<pre class="text-green-400 whitespace-pre-wrap">${escapeHtml(content)}</pre>`;
                        status.innerHTML = '<span class="text-green-400"><i class="ri-checkbox-circle-line"></i> 完成</span>';
                    }
                } else if (data.error) {
                    output.innerHTML = `<div class="error-log p-3 rounded"><span class="text-red-400">API错误: ${escapeHtml(data.error.message)}</span></div>`;
                    status.innerHTML = '<span class="text-red-400"><i class="ri-close-circle-line"></i> 错误</span>';
                }
            } catch (error) {
                output.innerHTML = `<div class="error-log p-3 rounded"><span class="text-red-400">请求失败: ${escapeHtml(error.message)}</span></div>`;
                status.innerHTML = '<span class="text-red-400"><i class="ri-close-circle-line"></i> 错误</span>';
            }
        }
        
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        async function analyzeSimCode() {
            const code = document.getElementById('simCodeInput').value;
            if (!code.trim()) {
                alert('请先输入代码！');
                return;
            }
            
            await callDeepSeekAPI(
                `请详细分析以下C语言代码，检查：
1. 语法错误
2. 逻辑问题
3. 潜在的内存问题
4. 代码优化建议
5. 代码风格建议

代码：
\`\`\`c
${code}
\`\`\``,
                'simAiSection',
                'simAiContent'
            );
        }
        
        async function generateCodeFromPrompt() {
            const prompt = document.getElementById('aiPromptInput').value.trim();
            if (!prompt) {
                alert('请输入代码需求描述');
                return;
            }
            
            if (!apiKey) {
                alert('请先在设置中配置DeepSeek API Key');
                document.getElementById('apiModal').style.display = 'flex';
                return;
            }
            
            // 显示生成中的状态
            const simCodeInput = document.getElementById('simCodeInput');
            const originalValue = simCodeInput.value;
            simCodeInput.value = '// AI正在生成代码...\n' + originalValue;
            updateSimLineNumbers();
            updateSyntaxHighlight();
            
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + apiKey
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: '你是一个C语言编程专家。根据用户的需求生成完整的、可运行的C语言代码。只输出代码，不要任何解释和markdown格式。代码要包含必要的头文件和main函数。' },
                            { role: 'user', content: prompt }
                        ],
                        stream: false
                    })
                });
                
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    let code = data.choices[0].message.content.trim();
                    code = code.replace(/^```c?\n?/i, '').replace(/\n?```$/i, '');
                    document.getElementById('simCodeInput').value = code;
                    updateSimLineNumbers();
                    updateSyntaxHighlight();
                } else if (data.error) {
                    alert('生成失败: ' + data.error.message);
                    simCodeInput.value = originalValue;
                    updateSimLineNumbers();
                    updateSyntaxHighlight();
                }
            } catch (error) {
                alert('请求失败: ' + error.message);
                simCodeInput.value = originalValue;
                updateSimLineNumbers();
                updateSyntaxHighlight();
            }
        }
        
        async function predictNextCode(textarea) {
            if (!apiKey) {
                return;
            }
            
            const code = textarea.value;
            const cursorPos = textarea.selectionStart;
            const codeBefore = code.substring(0, cursorPos);
            
            const suggestionBox = document.getElementById('aiSuggestionBox');
            const suggestionContent = document.getElementById('aiSuggestionContent');
            
            // 定位到光标位置
            const rect = textarea.getBoundingClientRect();
            const lines = codeBefore.split('\n');
            const lastLine = lines[lines.length - 1];
            const lineHeight = 24; // 行高
            const charWidth = 8; // 字符宽度
            
            const topPos = Math.min(lines.length * lineHeight, 300);
            const leftPos = Math.min(lastLine.length * charWidth + 50, 400);
            
            suggestionBox.classList.remove('hidden');
            suggestionBox.style.top = topPos + 'px';
            suggestionBox.style.left = leftPos + 'px';
            suggestionContent.innerHTML = '<div class="typing-indicator flex gap-1"><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span></div>';
            
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + apiKey
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: '你是一个C语言代码补全助手。请根据代码上下文智能预测接下来的内容：\n1. 结合上下文语法结构，生成符合语法的代码\n2. 正确处理空格，该空格时空格，不需要时不添加\n3. 避免生成重复的语句或内容\n4. 输出简短，通常1-5个单词或符号\n5. 只输出预测的代码内容，不要解释，不要markdown格式' },
                            { role: 'user', content: '预测接下来的代码单词：\n\n' + codeBefore }
                        ],
                        stream: false,
                        max_tokens: 50
                    })
                });
                
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    currentSuggestion = data.choices[0].message.content.trim();
                    // 只保留有效内容，去除任何格式
                    currentSuggestion = currentSuggestion.replace(/^```[\s\S]*?```$/g, '').trim();
                    if (currentSuggestion) {
                        suggestionContent.textContent = currentSuggestion;
                    } else {
                        hideAiSuggestion();
                    }
                } else {
                    hideAiSuggestion();
                }
            } catch (error) {
                hideAiSuggestion();
            }
        }
        
        function hideAiSuggestion() {
            const box = document.getElementById('aiSuggestionBox');
            if (box) box.classList.add('hidden');
            currentSuggestion = '';
        }
        
        async function callDeepSeekAPI(prompt, sectionId, contentId) {
            if (!apiKey) {
                alert('请先在设置中配置DeepSeek API Key');
                document.getElementById('apiModal').style.display = 'flex';
                return;
            }
            
            document.getElementById(sectionId).style.display = 'block';
            document.getElementById(contentId).innerHTML = '<div class="typing-indicator flex gap-1"><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span></div>';
            
            try {
                const response = await fetch('https://api.deepseek.com/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + apiKey
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            { role: 'system', content: '你是一位专业的C语言教师，擅长讲解C语言基础知识。请用通俗易懂的语言进行讲解。' },
                            { role: 'user', content: prompt }
                        ],
                        stream: false
                    })
                });
                
                const data = await response.json();
                if (data.choices && data.choices[0]) {
                    document.getElementById(contentId).textContent = data.choices[0].message.content;
                } else if (data.error) {
                    document.getElementById(contentId).innerHTML = '<span class="text-red-400">错误: ' + data.error.message + '</span>';
                }
            } catch (error) {
                document.getElementById(contentId).innerHTML = '<span class="text-red-400">请求失败: ' + error.message + '</span>';
            }
        }
        
        function loadTemplate() {
            const template = document.getElementById('codeTemplate').value;
            const templates = {
                hello: '#include <stdio.h>\n\nint main() {\n    printf("Hello, World!\\n");\n    return 0;\n}',
                input: '#include <stdio.h>\n\nint main() {\n    int a, b;\n    printf("请输入两个整数: ");\n    scanf("%d %d", &a, &b);\n    printf("它们的和是: %d\\n", a + b);\n    return 0;\n}',
                loop: '#include <stdio.h>\n\nint main() {\n    for (int i = 1; i <= 10; i++) {\n        printf("%d ", i);\n    }\n    printf("\\n");\n    return 0;\n}',
                array: '#include <stdio.h>\n\nint main() {\n    int arr[5] = {3, 1, 4, 1, 5};\n    int n = 5;\n    \n    printf("数组元素: ");\n    for (int i = 0; i < n; i++) {\n        printf("%d ", arr[i]);\n    }\n    printf("\\n");\n    \n    return 0;\n}',
                function: '#include <stdio.h>\n\nint add(int a, int b) {\n    return a + b;\n}\n\nint main() {\n    int x = 3, y = 5;\n    printf("%d + %d = %d\\n", x, y, add(x, y));\n    return 0;\n}',
                pointer: '#include <stdio.h>\n\nvoid swap(int *a, int *b) {\n    int temp = *a;\n    *a = *b;\n    *b = temp;\n}\n\nint main() {\n    int x = 10, y = 20;\n    printf("交换前: x=%d, y=%d\\n", x, y);\n    swap(&x, &y);\n    printf("交换后: x=%d, y=%d\\n", x, y);\n    return 0;\n}',
                struct: '#include <stdio.h>\n\nstruct Student {\n    char name[50];\n    int age;\n    float score;\n};\n\nint main() {\n    struct Student s = {"张三", 18, 95.5};\n    printf("姓名: %s\\n", s.name);\n    printf("年龄: %d\\n", s.age);\n    printf("成绩: %.1f\\n", s.score);\n    return 0;\n}',
                string: '#include <stdio.h>\n#include <string.h>\n\nint main() {\n    char str1[50] = "Hello";\n    char str2[50] = "World";\n    \n    printf("str1: %s (长度: %lu)\\n", str1, strlen(str1));\n    strcat(str1, " ");\n    strcat(str1, str2);\n    printf("拼接后: %s\\n", str1);\n    \n    return 0;\n}',
                file: '#include <stdio.h>\n\nint main() {\n    FILE *fp = fopen("test.txt", "w");\n    if (fp == NULL) {\n        printf("无法打开文件\\n");\n        return 1;\n    }\n    \n    fprintf(fp, "Hello, File!\\n");\n    fclose(fp);\n    \n    printf("文件写入成功\\n");\n    return 0;\n}'
            };
            
            if (templates[template]) {
                document.getElementById('simCodeInput').value = templates[template];
                updateSimLineNumbers();
                updateSyntaxHighlight();
            }
        }
        
        function clearSimulator() {
            document.getElementById('simCodeInput').value = '';
            document.getElementById('simInput').value = '';
            document.getElementById('simOutput').innerHTML = '<span class="text-gray-500">// 点击"编译并运行"查看输出...</span>';
            document.getElementById('simAiSection').style.display = 'none';
            document.getElementById('codeTemplate').value = '';
            document.getElementById('aiPromptInput').value = '';
            document.getElementById('compileStatus').innerHTML = '';
            document.getElementById('outputStatus').innerHTML = '';
            hideAutocomplete();
            hideAiSuggestion();
            updateSimLineNumbers();
            updateSyntaxHighlight();
        }

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            // 仅在元素存在时更新计数
            const choiceCountEl = document.getElementById('choiceCount');
            if (choiceCountEl) choiceCountEl.textContent = choiceQuestions.length;
            
            const fillCountEl = document.getElementById('fillCount');
            if (fillCountEl) fillCountEl.textContent = fillQuestions.length;
            
            const blankCountEl = document.getElementById('blankCount');
            if (blankCountEl) blankCountEl.textContent = blankQuestions.length;
            
            const programCountEl = document.getElementById('programCount');
            if (programCountEl) programCountEl.textContent = programQuestions.length;
            
            const readingCountEl = document.getElementById('readingCount');
            if (readingCountEl) readingCountEl.textContent = readingQuestions.length;
            
            // 导航
            const navHomeEl = document.getElementById('nav-home');
            if (navHomeEl) navHomeEl.addEventListener('click', () => showPage('home'));
            
            const navChoiceEl = document.getElementById('nav-choice');
            if (navChoiceEl) navChoiceEl.addEventListener('click', () => showPage('choice'));
            
            const navFillEl = document.getElementById('nav-fill');
            if (navFillEl) navFillEl.addEventListener('click', () => showPage('fill'));
            
            const navProgramEl = document.getElementById('nav-program');
            if (navProgramEl) navProgramEl.addEventListener('click', () => showPage('program'));
            
            const navSimulatorEl = document.getElementById('nav-simulator');
            if (navSimulatorEl) navSimulatorEl.addEventListener('click', () => showPage('simulator'));
            
            const navReadingEl = document.getElementById('nav-reading');
            if (navReadingEl) navReadingEl.addEventListener('click', () => showPage('reading'));
            
            // 程序阅读题
            const prevReadingBtnEl = document.getElementById('prevReadingBtn');
            if (prevReadingBtnEl) prevReadingBtnEl.addEventListener('click', prevReadingQuestion);
            
            const nextReadingBtnEl = document.getElementById('nextReadingBtn');
            if (nextReadingBtnEl) nextReadingBtnEl.addEventListener('click', nextReadingQuestion);
            
            const randomReadingBtnEl = document.getElementById('randomReadingBtn');
            if (randomReadingBtnEl) randomReadingBtnEl.addEventListener('click', showRandomReadingQuestion);
            
            const submitReadingBtnEl = document.getElementById('submitReadingBtn');
            if (submitReadingBtnEl) submitReadingBtnEl.addEventListener('click', checkReadingAnswer);
            
            const aiExplainReadingBtnEl = document.getElementById('aiExplainReadingBtn');
            if (aiExplainReadingBtnEl) aiExplainReadingBtnEl.addEventListener('click', () => {
                const q = readingQuestions[currentReadingIndex];
                callDeepSeekAPI(`请详细讲解以下C语言代码的输出结果：\n\n代码：\n\`\`\`c\n${q.code}\n\`\`\`\n\n请解释代码的执行流程和最终输出。`, 'readingAiSection', 'readingAiContent');
            });
            
            // 填空题导航
            const navBlankEl = document.getElementById('nav-blank');
            if (navBlankEl) navBlankEl.addEventListener('click', () => showPage('blank'));
            
            // 填空题
            const prevBlankBtnEl = document.getElementById('prevBlankBtn');
            if (prevBlankBtnEl) prevBlankBtnEl.addEventListener('click', prevBlankQuestion);
            
            const nextBlankBtnEl = document.getElementById('nextBlankBtn');
            if (nextBlankBtnEl) nextBlankBtnEl.addEventListener('click', nextBlankQuestion);
            
            const randomBlankBtnEl = document.getElementById('randomBlankBtn');
            if (randomBlankBtnEl) randomBlankBtnEl.addEventListener('click', showRandomBlankQuestion);
            
            const submitBlankBtnEl = document.getElementById('submitBlankBtn');
            if (submitBlankBtnEl) submitBlankBtnEl.addEventListener('click', checkBlankAnswer);
            
            const aiExplainBlankBtnEl = document.getElementById('aiExplainBlankBtn');
            if (aiExplainBlankBtnEl) aiExplainBlankBtnEl.addEventListener('click', () => {
                if (blankQuestions.length > 0) {
                    const q = blankQuestions[currentBlankIndex];
                    callDeepSeekAPI(`请详细讲解这道C语言填空题：\n\n题目：${q.question}\n\n正确答案：\n${q.blanks.map((b, i) => `空${i+1}: ${b}`).join('\n')}\n\n请讲解每个空的填写依据和相关知识点。`, 'blankAiSection', 'blankAiContent');
                }
            });
            
            // 主页
            const startPracticeBtnEl = document.getElementById('startPracticeBtn');
            if (startPracticeBtnEl) startPracticeBtnEl.addEventListener('click', () => showPage('choice'));
            
            const openSimulatorBtnEl = document.getElementById('openSimulatorBtn');
            if (openSimulatorBtnEl) openSimulatorBtnEl.addEventListener('click', () => showPage('simulator'));
            
            const openSimulatorBtn2El = document.getElementById('openSimulatorBtn2');
            if (openSimulatorBtn2El) openSimulatorBtn2El.addEventListener('click', () => showPage('simulator'));
            
            // 选择题
            const prevChoiceBtnEl = document.getElementById('prevChoiceBtn');
            if (prevChoiceBtnEl) prevChoiceBtnEl.addEventListener('click', () => { if (currentChoiceIndex > 0) { currentChoiceIndex--; loadChoiceQuestion(); } });
            
            const nextChoiceBtnEl = document.getElementById('nextChoiceBtn');
            if (nextChoiceBtnEl) nextChoiceBtnEl.addEventListener('click', () => { if (currentChoiceIndex < choiceQuestions.length - 1) { currentChoiceIndex++; loadChoiceQuestion(); } });
            
            const randomChoiceBtnEl = document.getElementById('randomChoiceBtn');
            if (randomChoiceBtnEl) randomChoiceBtnEl.addEventListener('click', () => { currentChoiceIndex = Math.floor(Math.random() * choiceQuestions.length); loadChoiceQuestion(); });
            
            const submitChoiceBtnEl = document.getElementById('submitChoiceBtn');
            if (submitChoiceBtnEl) submitChoiceBtnEl.addEventListener('click', checkChoiceAnswer);
            
            const aiExplainChoiceBtnEl = document.getElementById('aiExplainChoiceBtn');
            if (aiExplainChoiceBtnEl) aiExplainChoiceBtnEl.addEventListener('click', () => {
                const q = choiceQuestions[currentChoiceIndex];
                callDeepSeekAPI(`请详细讲解这道C语言选择题：\n\n题目：${q.question}\n选项：\nA. ${q.options[0]}\nB. ${q.options[1]}\nC. ${q.options[2]}\nD. ${q.options[3]}\n正确答案：${String.fromCharCode(65 + q.answer)}\n\n请讲解知识点和为什么选这个答案。`, 'choiceAiSection', 'choiceAiContent');
            });
            
            // 填空题
            const prevFillBtnEl = document.getElementById('prevFillBtn');
            if (prevFillBtnEl) prevFillBtnEl.addEventListener('click', () => { if (currentFillIndex > 0) { currentFillIndex--; loadFillQuestion(); } });
            
            const nextFillBtnEl = document.getElementById('nextFillBtn');
            if (nextFillBtnEl) nextFillBtnEl.addEventListener('click', () => { if (currentFillIndex < fillQuestions.length - 1) { currentFillIndex++; loadFillQuestion(); } });
            
            const randomFillBtnEl = document.getElementById('randomFillBtn');
            if (randomFillBtnEl) randomFillBtnEl.addEventListener('click', () => { currentFillIndex = Math.floor(Math.random() * fillQuestions.length); loadFillQuestion(); });
            
            const submitFillBtnEl = document.getElementById('submitFillBtn');
            if (submitFillBtnEl) submitFillBtnEl.addEventListener('click', checkFillAnswer);
            
            const aiExplainFillBtnEl = document.getElementById('aiExplainFillBtn');
            if (aiExplainFillBtnEl) aiExplainFillBtnEl.addEventListener('click', () => {
                const q = fillQuestions[currentFillIndex];
                callDeepSeekAPI(`请详细讲解这道C语言填空题：\n\n题目：${q.question}\n代码：\n${q.code}\n\n正确答案：\n空1: ${q.blanks[0]}\n空2: ${q.blanks[1]}\n\n请讲解代码功能和为什么这样填。`, 'fillAiSection', 'fillAiContent');
            });
            
            // 编程题
            const prevProgramBtnEl = document.getElementById('prevProgramBtn');
            if (prevProgramBtnEl) prevProgramBtnEl.addEventListener('click', () => { if (currentProgramIndex > 0) { currentProgramIndex--; loadProgramQuestion(); } });
            
            const nextProgramBtnEl = document.getElementById('nextProgramBtn');
            if (nextProgramBtnEl) nextProgramBtnEl.addEventListener('click', () => { if (currentProgramIndex < programQuestions.length - 1) { currentProgramIndex++; loadProgramQuestion(); } });
            
            const randomProgramBtnEl = document.getElementById('randomProgramBtn');
            if (randomProgramBtnEl) randomProgramBtnEl.addEventListener('click', () => { currentProgramIndex = Math.floor(Math.random() * programQuestions.length); loadProgramQuestion(); });
            
            const runProgramBtnEl = document.getElementById('runProgramBtn');
            if (runProgramBtnEl) runProgramBtnEl.addEventListener('click', async () => {
                const codeInputEl = document.getElementById('programCodeInput');
                if (!codeInputEl) return;
                
                const code = codeInputEl.value.trim();
                if (!code) {
                    alert('请先输入代码！');
                    return;
                }
                
                const outputDiv = document.getElementById('programOutput');
                const outputContent = document.getElementById('programOutputContent');
                if (outputDiv && outputContent) {
                    outputDiv.style.display = 'block';
                    outputContent.innerHTML = '<span class="text-gray-400">正在编译并运行代码...</span>';
                }
                

                
                try {
                    const input = document.getElementById('programInput').value;
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + apiKey
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                {
                                    role: 'system',
                                    content: `你是一个C语言编译器和运行时模拟器。请分析用户的C代码，模拟编译和运行过程。

如果代码有语法错误，请返回类似GCC的错误信息，格式如下：
main.c:行号:列号: error: 错误描述

如果代码有警告，格式如下：
main.c:行号:列号: warning: 警告描述

如果代码正确，请模拟运行并返回输出结果。
对于scanf输入，使用用户提供的stdin数据。

请用JSON格式返回结果：
{
  "success": true或false,
  "errors": ["错误信息数组"],
  "warnings": ["警告信息数组"],
  "output": "程序输出结果",
  "returnCode": 返回码数字
}

只返回JSON，不要其他内容。`
                                },
                                {
                                    role: 'user',
                                    content: `C代码:\n\`\`\`c\n${code}\n\`\`\`\n\nstdin输入:\n${input || '(无输入)'}`
                                }
                            ],
                            stream: false
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (data.choices && data.choices[0]) {
                        let content = data.choices[0].message.content.trim();
                        // 尝试解析JSON
                        try {
                            // 移除可能的markdown代码块
                            content = content.replace(/^```json?\n?/i, '').replace(/\n?```$/i, '');
                            const result = JSON.parse(content);
                            
                            let html = '';
                            
                            // 显示错误
                            if (result.errors && result.errors.length > 0) {
                                html += '<div class="error-log p-3 rounded mb-2">';
                                html += '<div class="text-red-400 font-bold mb-1"><i class="ri-error-warning-line mr-1"></i>编译错误</div>';
                                result.errors.forEach(err => {
                                    html += `<div class="text-red-300 text-sm">${escapeHtml(err)}</div>`;
                                });
                                html += '</div>';
                            }
                            
                            // 显示警告
                            if (result.warnings && result.warnings.length > 0) {
                                html += '<div class="warning-log p-3 rounded mb-2">';
                                html += '<div class="text-yellow-400 font-bold mb-1"><i class="ri-alert-line mr-1"></i>警告</div>';
                                result.warnings.forEach(warn => {
                                    html += `<div class="text-yellow-300 text-sm">${escapeHtml(warn)}</div>`;
                                });
                                html += '</div>';
                            }
                            
                            // 显示输出
                            if (result.success && result.output !== undefined) {
                                html += '<div class="success-log p-3 rounded">';
                                html += '<div class="text-green-400 font-bold mb-1"><i class="ri-checkbox-circle-line mr-1"></i>程序输出</div>';
                                html += `<pre class="text-green-300 whitespace-pre-wrap">${escapeHtml(result.output)}</pre>`;
                                if (result.returnCode !== undefined) {
                                    html += `<div class="text-gray-500 text-xs mt-2">返回码: ${result.returnCode}</div>`;
                                }
                                html += '</div>';
                            }
                            
                            outputContent.innerHTML = html || '<span class="text-gray-400">无输出</span>';
                            
                        } catch (e) {
                            // 如果不是JSON，直接显示
                            outputContent.innerHTML = `<pre class="text-green-400 whitespace-pre-wrap">${escapeHtml(content)}</pre>`;
                        }
                    } else if (data.error) {
                        outputContent.innerHTML = `<div class="error-log p-3 rounded"><span class="text-red-400">API错误: ${escapeHtml(data.error.message)}</span></div>`;
                    }
                } catch (error) {
                    outputContent.innerHTML = `<div class="error-log p-3 rounded"><span class="text-red-400">请求失败: ${escapeHtml(error.message)}</span></div>`;
                }
            });
            // 查看答案按钮 - 改为AI判断
            const showAnswerBtnEl = document.getElementById('showAnswerBtn');
            if (showAnswerBtnEl) {
                showAnswerBtnEl.addEventListener('click', () => {
                    const codeInputEl = document.getElementById('programCodeInput');
                    if (!codeInputEl) return;
                    
                    const code = codeInputEl.value;
                    const q = programQuestions[currentProgramIndex];
                    callDeepSeekAPI(`请判断以下C语言代码是否正确解决了给定问题，按照以下步骤分析：

1. 首先明确问题要求：${q.description}

2. 分析用户代码：
${code}

3. 直接给出判断：正确或错误

4. 如果错误，指出具体问题并给出修正建议

5. 如果正确，确认代码符合要求并给出优化建议

请用简洁明了的语言回答，不要添加任何额外格式。`, 'programAiSection', 'programAiContent');
                });
            }
            
            const aiAnalyzeProgramBtnEl = document.getElementById('aiAnalyzeProgramBtn');
            if (aiAnalyzeProgramBtnEl) {
                aiAnalyzeProgramBtnEl.addEventListener('click', () => {
                    const codeInputEl = document.getElementById('programCodeInput');
                    if (!codeInputEl) return;
                    
                    const code = codeInputEl.value;
                    const q = programQuestions[currentProgramIndex];
                    callDeepSeekAPI(`请分析以下C语言代码：\n\n问题描述：${q.description}\n\n用户代码：\n${code}\n\n请分析代码逻辑是否正确，有无语法错误，并给出建议。`, 'programAiSection', 'programAiContent');
                });
            }
            
            // 编程题代码编辑器
            const programTextarea = document.getElementById('programCodeInput');
            if (programTextarea) {
                programTextarea.addEventListener('input', updateProgramLineNumbers);
                programTextarea.addEventListener('scroll', function() {
                    const lineNumbers = document.getElementById('programLineNumbers');
                    if (lineNumbers) lineNumbers.scrollTop = this.scrollTop;
                });
            }
            
            // 模拟器
            const codeTemplateEl = document.getElementById('codeTemplate');
            if (codeTemplateEl) codeTemplateEl.addEventListener('change', loadTemplate);
            
            const clearSimBtnEl = document.getElementById('clearSimBtn');
            if (clearSimBtnEl) clearSimBtnEl.addEventListener('click', clearSimulator);
            
            const runSimBtnEl = document.getElementById('runSimBtn');
            if (runSimBtnEl) runSimBtnEl.addEventListener('click', runWithAI);
            
            const analyzeSimBtnEl = document.getElementById('analyzeSimBtn');
            if (analyzeSimBtnEl) analyzeSimBtnEl.addEventListener('click', analyzeSimCode);
            
            const generateCodeBtnEl = document.getElementById('generateCodeBtn');
            if (generateCodeBtnEl) generateCodeBtnEl.addEventListener('click', generateCodeFromPrompt);
            
            const aiPromptInputEl = document.getElementById('aiPromptInput');
            if (aiPromptInputEl) aiPromptInputEl.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && e.ctrlKey) { e.preventDefault(); generateCodeFromPrompt(); }
            });
            

            
            // AI问答弹窗功能
            const openQAModalBtnEl = document.getElementById('openQAModalBtn');
            if (openQAModalBtnEl) openQAModalBtnEl.addEventListener('click', () => {
                const qaModalEl = document.getElementById('qaModal');
                if (qaModalEl) qaModalEl.style.display = 'flex';
            });
            
            // 首页AI问答按钮
            const openQAModalBtnHomeEl = document.getElementById('openQAModalBtnHome');
            if (openQAModalBtnHomeEl) openQAModalBtnHomeEl.addEventListener('click', () => {
                const qaModalEl = document.getElementById('qaModal');
                if (qaModalEl) qaModalEl.style.display = 'flex';
            });
            
            // 收藏页面导航
            const navFavoritesEl = document.getElementById('nav-favorites');
            if (navFavoritesEl) navFavoritesEl.addEventListener('click', () => {
                showPage('favorites');
            });
            
            const closeQAModalBtnEl = document.getElementById('closeQAModalBtn');
            if (closeQAModalBtnEl) closeQAModalBtnEl.addEventListener('click', () => {
                const qaModalEl = document.getElementById('qaModal');
                if (qaModalEl) qaModalEl.style.display = 'none';
            });
            
            const qaModalEl = document.getElementById('qaModal');
            if (qaModalEl) qaModalEl.addEventListener('click', function(e) {
                if (e.target.id === 'qaModal') {
                    qaModalEl.style.display = 'none';
                }
            });
            
            // 清空聊天记录按钮事件监听
            const clearChatBtnEl = document.getElementById('clearChatBtn');
            if (clearChatBtnEl) clearChatBtnEl.addEventListener('click', () => {
                const qaChatAreaEl = document.getElementById('qaChatArea');
                const qaCommonQuestionsEl = document.getElementById('qaCommonQuestions');
                
                // 清空聊天记录，只保留系统欢迎消息
                if (qaChatAreaEl) {
                    qaChatAreaEl.innerHTML = `
                        <div class="flex gap-4">
                            <div class="w-10 h-10 bg-indigo-500/30 rounded-full flex items-center justify-center flex-shrink-0">
                                <i class="ri-robot-line text-indigo-400"></i>
                            </div>
                            <div class="flex-1">
                                <div class="card-gradient p-4 rounded-xl">
                                    <p class="text-gray-300">你好！我是你的C语言学习助手，有什么问题可以问我。</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
                
                // 恢复常见问题到初始状态
                if (qaCommonQuestionsEl) {
                    qaCommonQuestionsEl.innerHTML = `
                        <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">什么是变量？</button>
                        <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">如何声明数组？</button>
                        <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">指针是什么？</button>
                        <button class="px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question">如何定义函数？</button>
                    `;
                }
            });
            
            // 收藏按钮事件监听
            const favoriteButtons = [
                { id: 'favoriteChoiceBtn', page: 'choice', currentIndex: () => currentChoiceIndex },
                { id: 'favoriteFillBtn', page: 'fill', currentIndex: () => currentFillIndex },
                { id: 'favoriteBlankBtn', page: 'blank', currentIndex: () => currentBlankIndex },
                { id: 'favoriteProgramBtn', page: 'program', currentIndex: () => currentProgramIndex },
                { id: 'favoriteReadingBtn', page: 'reading', currentIndex: () => currentReadingIndex }
            ];
            
            favoriteButtons.forEach(({ id, page, currentIndex }) => {
                const btn = document.getElementById(id);
                if (btn) {
                    btn.addEventListener('click', () => {
                        toggleFavorite(page, currentIndex());
                    });
                }
            });
            
            // 发送问答消息事件监听
            const sendQABtnEl = document.getElementById('sendQABtn');
            if (sendQABtnEl) sendQABtnEl.addEventListener('click', sendQAMessage);
            
            const qaInputEl = document.getElementById('qaInput');
            if (qaInputEl) qaInputEl.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendQAMessage();
                }
            });
            
            // 常见问题点击事件
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('common-question')) {
                    const qaInput = document.getElementById('qaInput');
                    if (qaInput) {
                        qaInput.value = e.target.textContent;
                        sendQAMessage();
                    }
                }
            });
            
            // 发送问答消息函数
            async function sendQAMessage() {
                const input = document.getElementById('qaInput');
                const message = input.value.trim();
                if (!message) return;
                
                // 清空输入框
                input.value = '';
                
                // 添加用户消息
                addQAMessage('user', message);
                
                // 检查API Key
                if (!apiKey) {
                    alert('请先在设置中配置DeepSeek API Key');
                    document.getElementById('apiModal').style.display = 'flex';
                    return;
                }
                
                // 添加AI正在输入的消息
                const aiTypingDiv = addQAMessage('ai', '<div class="typing-indicator flex gap-1"><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span><span class="w-2 h-2 bg-indigo-400 rounded-full"></span></div>');
                
                try {
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + apiKey
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                { role: 'system', content: '你是一位专业的C语言教师，擅长讲解C语言基础知识。请用通俗易懂的语言进行讲解，针对学生的问题给出清晰准确的回答。' },
                                { role: 'user', content: message }
                            ],
                            stream: false
                        })
                    });
                    
                    const data = await response.json();
                    if (data.choices && data.choices[0]) {
                        let aiResponse = data.choices[0].message.content;
                        // 添加代码高亮
                        aiResponse = aiResponse.replace(/```c([\s\S]*?)```/g, '<pre class="bg-black/30 p-3 rounded-xl text-green-400 overflow-x-auto"><code class="language-c">$1</code></pre>');
                        aiResponse = aiResponse.replace(/```([\s\S]*?)```/g, '<pre class="bg-black/30 p-3 rounded-xl text-gray-300 overflow-x-auto"><code>$1</code></pre>');
                        aiResponse = aiResponse.replace(/\n/g, '<br>');
                        // 更新AI消息
                        aiTypingDiv.querySelector('.card-gradient').innerHTML = aiResponse;
                        
                        // 更新常见问题（基于AI回答内容生成相关问题）
                        updateCommonQuestions(data.choices[0].message.content);
                    }
                } catch (error) {
                    aiTypingDiv.querySelector('.card-gradient').innerHTML = `<p class="text-red-400">请求失败: ${error.message}</p>`;
                }
            }
            
            // 添加问答消息
            function addQAMessage(sender, content) {
                const chatArea = document.getElementById('qaChatArea');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'flex gap-4';
                
                if (sender === 'user') {
                    messageDiv.innerHTML = `
                        <div class="flex-1 flex justify-end">
                            <div class="card-gradient p-4 rounded-xl max-w-[80%]">
                                <p class="text-gray-300">${content}</p>
                            </div>
                        </div>
                        <div class="w-10 h-10 bg-blue-500/30 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="ri-user-line text-blue-400"></i>
                        </div>
                    `;
                } else {
                    messageDiv.innerHTML = `
                        <div class="w-10 h-10 bg-indigo-500/30 rounded-full flex items-center justify-center flex-shrink-0">
                            <i class="ri-robot-line text-indigo-400"></i>
                        </div>
                        <div class="flex-1">
                            <div class="card-gradient p-4 rounded-xl">
                                ${content}
                            </div>
                        </div>
                    `;
                }
                
                chatArea.appendChild(messageDiv);
                chatArea.scrollTop = chatArea.scrollHeight;
                return messageDiv;
            }
            
            // 更新常见问题
            async function updateCommonQuestions(aiResponse) {
                if (!apiKey) return;
                
                try {
                    const response = await fetch('https://api.deepseek.com/chat/completions', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + apiKey
                        },
                        body: JSON.stringify({
                            model: 'deepseek-chat',
                            messages: [
                                { 
                                    role: 'system', 
                                    content: '请根据用户和AI的对话内容，生成4个相关的C语言学习问题，要求：1. 问题要与对话内容相关；2. 问题要具体明确；3. 问题要适合C语言初学者；4. 只返回问题列表，每个问题占一行，不要其他内容。' 
                                },
                                { role: 'user', content: aiResponse }
                            ],
                            stream: false
                        })
                    });
                    
                    const data = await response.json();
                    if (data.choices && data.choices[0]) {
                        const questions = data.choices[0].message.content.trim().split('\n').filter(q => q.trim());
                        const questionsContainer = document.getElementById('qaCommonQuestions');
                        questionsContainer.innerHTML = '';
                        
                        questions.slice(0, 4).forEach(question => {
                            const btn = document.createElement('button');
                            btn.className = 'px-4 py-2 bg-white/10 rounded-lg text-sm hover:bg-white/20 transition common-question';
                            btn.textContent = question;
                            questionsContainer.appendChild(btn);
                        });
                    }
                } catch (error) {
                    console.error('更新常见问题失败:', error);
                }
            }
        });
    </script>
</body>
</html>